
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
      <link rel="icon" href="../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.6.0, mkdocs-material-8.5.10">
    
    
      
        <title>modules - centraal-client-flow</title>
      
    
    
      <link rel="stylesheet" href="../assets/stylesheets/main.975780f9.min.css">
      
        
        <link rel="stylesheet" href="../assets/stylesheets/palette.2505c338.min.css">
        
      
      

    
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
      <link rel="stylesheet" href="../assets/_mkdocstrings.css">
    
    <script>__md_scope=new URL("..",location),__md_hash=e=>[...e].reduce((e,_)=>(e<<5)-e+_.charCodeAt(0),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
  </head>
  
  
    
    
      
    
    
    
    
    <body dir="ltr" data-md-color-scheme="default" data-md-color-primary="" data-md-color-accent="">
  
    
    
      <script>var palette=__md_get("__palette");if(palette&&"object"==typeof palette.color)for(var key of Object.keys(palette.color))document.body.setAttribute("data-md-color-"+key,palette.color[key])</script>
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#centraal_client_flow" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
      <div data-md-component="outdated" hidden>
        
      </div>
    
    
      

  

<header class="md-header md-header--lifted" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href=".." title="centraal-client-flow" class="md-header__button md-logo" aria-label="centraal-client-flow" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54Z"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2Z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            centraal-client-flow
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              modules
            
          </span>
        </div>
      </div>
    </div>
    
      <form class="md-header__option" data-md-component="palette">
        
          
          
          
          <input class="md-option" data-md-color-media="(prefers-color-scheme: light)" data-md-color-scheme="default" data-md-color-primary="" data-md-color-accent=""  aria-label="Switch to dark mode"  type="radio" name="__palette" id="__palette_1">
          
            <label class="md-header__button md-icon" title="Switch to dark mode" for="__palette_2" hidden>
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="m17.75 4.09-2.53 1.94.91 3.06-2.63-1.81-2.63 1.81.91-3.06-2.53-1.94L12.44 4l1.06-3 1.06 3 3.19.09m3.5 6.91-1.64 1.25.59 1.98-1.7-1.17-1.7 1.17.59-1.98L15.75 11l2.06-.05L18.5 9l.69 1.95 2.06.05m-2.28 4.95c.83-.08 1.72 1.1 1.19 1.85-.32.45-.66.87-1.08 1.27C15.17 23 8.84 23 4.94 19.07c-3.91-3.9-3.91-10.24 0-14.14.4-.4.82-.76 1.27-1.08.75-.53 1.93.36 1.85 1.19-.27 2.86.69 5.83 2.89 8.02a9.96 9.96 0 0 0 8.02 2.89m-1.64 2.02a12.08 12.08 0 0 1-7.8-3.47c-2.17-2.19-3.33-5-3.49-7.82-2.81 3.14-2.7 7.96.31 10.98 3.02 3.01 7.84 3.12 10.98.31Z"/></svg>
            </label>
          
        
          
          
          
          <input class="md-option" data-md-color-media="(prefers-color-scheme: dark)" data-md-color-scheme="slate" data-md-color-primary="" data-md-color-accent=""  aria-label="Switch to light mode"  type="radio" name="__palette" id="__palette_2">
          
            <label class="md-header__button md-icon" title="Switch to light mode" for="__palette_1" hidden>
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 7a5 5 0 0 1 5 5 5 5 0 0 1-5 5 5 5 0 0 1-5-5 5 5 0 0 1 5-5m0 2a3 3 0 0 0-3 3 3 3 0 0 0 3 3 3 3 0 0 0 3-3 3 3 0 0 0-3-3m0-7 2.39 3.42C13.65 5.15 12.84 5 12 5c-.84 0-1.65.15-2.39.42L12 2M3.34 7l4.16-.35A7.2 7.2 0 0 0 5.94 8.5c-.44.74-.69 1.5-.83 2.29L3.34 7m.02 10 1.76-3.77a7.131 7.131 0 0 0 2.38 4.14L3.36 17M20.65 7l-1.77 3.79a7.023 7.023 0 0 0-2.38-4.15l4.15.36m-.01 10-4.14.36c.59-.51 1.12-1.14 1.54-1.86.42-.73.69-1.5.83-2.29L20.64 17M12 22l-2.41-3.44c.74.27 1.55.44 2.41.44.82 0 1.63-.17 2.37-.44L12 22Z"/></svg>
            </label>
          
        
      </form>
    
    
    
      <label class="md-header__button md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
      </label>
      <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41Z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
      <div class="md-header__source">
        <a href="https://github.com/centraal-api/centraal_client_flow" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.2.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg>
  </div>
  <div class="md-source__repository">
    centraal_client_flow
  </div>
</a>
      </div>
    
  </nav>
  
    
      
<nav class="md-tabs" aria-label="Tabs" data-md-component="tabs">
  <div class="md-tabs__inner md-grid">
    <ul class="md-tabs__list">
      
        
  
  


  <li class="md-tabs__item">
    <a href=".." class="md-tabs__link">
      home
    </a>
  </li>

      
        
  
  


  <li class="md-tabs__item">
    <a href="../installation/" class="md-tabs__link">
      installation
    </a>
  </li>

      
        
  
  


  <li class="md-tabs__item">
    <a href="../usage/" class="md-tabs__link">
      usage
    </a>
  </li>

      
        
  
  
    
  


  <li class="md-tabs__item">
    <a href="./" class="md-tabs__link md-tabs__link--active">
      modules
    </a>
  </li>

      
        
  
  


  <li class="md-tabs__item">
    <a href="../contributing/" class="md-tabs__link">
      contributing
    </a>
  </li>

      
        
  
  


  <li class="md-tabs__item">
    <a href="../authors/" class="md-tabs__link">
      authors
    </a>
  </li>

      
        
  
  


  <li class="md-tabs__item">
    <a href="../history/" class="md-tabs__link">
      history
    </a>
  </li>

      
    </ul>
  </div>
</nav>
    
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

  


<nav class="md-nav md-nav--primary md-nav--lifted" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href=".." title="centraal-client-flow" class="md-nav__button md-logo" aria-label="centraal-client-flow" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54Z"/></svg>

    </a>
    centraal-client-flow
  </label>
  
    <div class="md-nav__source">
      <a href="https://github.com/centraal-api/centraal_client_flow" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.2.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg>
  </div>
  <div class="md-source__repository">
    centraal_client_flow
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href=".." class="md-nav__link">
        home
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../installation/" class="md-nav__link">
        installation
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../usage/" class="md-nav__link">
        usage
      </a>
    </li>
  

    
      
      
      

  
  
    
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" data-md-toggle="toc" type="checkbox" id="__toc">
      
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          modules
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        modules
      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#centraal_client_flow" class="md-nav__link">
    centraal_client_flow
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#centraal_client_flow.connections" class="md-nav__link">
    connections
  </a>
  
    <nav class="md-nav" aria-label="connections">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#centraal_client_flow.connections.cosmosdb" class="md-nav__link">
    cosmosdb
  </a>
  
    <nav class="md-nav" aria-label="cosmosdb">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#centraal_client_flow.connections.cosmosdb.CosmosDBSingleton" class="md-nav__link">
    CosmosDBSingleton
  </a>
  
    <nav class="md-nav" aria-label="CosmosDBSingleton">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#centraal_client_flow.connections.cosmosdb.CosmosDBSingleton.__new__" class="md-nav__link">
    __new__()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#centraal_client_flow.connections.cosmosdb.CosmosDBSingleton.get_container_client" class="md-nav__link">
    get_container_client()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#centraal_client_flow.connections.cosmosdb.CosmosDBSingleton.set_mock_client" class="md-nav__link">
    set_mock_client()
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#centraal_client_flow.connections.service_bus" class="md-nav__link">
    service_bus
  </a>
  
    <nav class="md-nav" aria-label="service_bus">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#centraal_client_flow.connections.service_bus.IServiceBusClient" class="md-nav__link">
    IServiceBusClient
  </a>
  
    <nav class="md-nav" aria-label="IServiceBusClient">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#centraal_client_flow.connections.service_bus.IServiceBusClient.send_message_to_queue" class="md-nav__link">
    send_message_to_queue()
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#centraal_client_flow.connections.service_bus.ServiceBusClientSingleton" class="md-nav__link">
    ServiceBusClientSingleton
  </a>
  
    <nav class="md-nav" aria-label="ServiceBusClientSingleton">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#centraal_client_flow.connections.service_bus.ServiceBusClientSingleton.__new__" class="md-nav__link">
    __new__()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#centraal_client_flow.connections.service_bus.ServiceBusClientSingleton.close" class="md-nav__link">
    close()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#centraal_client_flow.connections.service_bus.ServiceBusClientSingleton.get_sender" class="md-nav__link">
    get_sender()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#centraal_client_flow.connections.service_bus.ServiceBusClientSingleton.send_message_to_queue" class="md-nav__link">
    send_message_to_queue()
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#centraal_client_flow.events" class="md-nav__link">
    events
  </a>
  
    <nav class="md-nav" aria-label="events">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#centraal_client_flow.events.EventProcessor" class="md-nav__link">
    EventProcessor
  </a>
  
    <nav class="md-nav" aria-label="EventProcessor">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#centraal_client_flow.events.EventProcessor.process_event" class="md-nav__link">
    process_event()
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#centraal_client_flow.events.PullProcessor" class="md-nav__link">
    PullProcessor
  </a>
  
    <nav class="md-nav" aria-label="PullProcessor">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#centraal_client_flow.events.PullProcessor.get_data" class="md-nav__link">
    get_data()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#centraal_client_flow.events.PullProcessor.process_event" class="md-nav__link">
    process_event()
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#centraal_client_flow.events.processor" class="md-nav__link">
    processor
  </a>
  
    <nav class="md-nav" aria-label="processor">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#centraal_client_flow.events.processor.EventProcessor" class="md-nav__link">
    EventProcessor
  </a>
  
    <nav class="md-nav" aria-label="EventProcessor">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#centraal_client_flow.events.processor.EventProcessor.process_event" class="md-nav__link">
    process_event()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#centraal_client_flow.events.processor.EventProcessor.send_to_queue" class="md-nav__link">
    send_to_queue()
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#centraal_client_flow.events.receiver" class="md-nav__link">
    receiver
  </a>
  
    <nav class="md-nav" aria-label="receiver">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#centraal_client_flow.events.receiver.EventFunctionBuilder" class="md-nav__link">
    EventFunctionBuilder
  </a>
  
    <nav class="md-nav" aria-label="EventFunctionBuilder">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#centraal_client_flow.events.receiver.EventFunctionBuilder.__init__" class="md-nav__link">
    __init__()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#centraal_client_flow.events.receiver.EventFunctionBuilder.build_function" class="md-nav__link">
    build_function()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#centraal_client_flow.events.receiver.EventFunctionBuilder.register_function" class="md-nav__link">
    register_function()
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#centraal_client_flow.events.receiver.Recieve" class="md-nav__link">
    Recieve
  </a>
  
    <nav class="md-nav" aria-label="Recieve">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#centraal_client_flow.events.receiver.Recieve.__init__" class="md-nav__link">
    __init__()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#centraal_client_flow.events.receiver.Recieve.register_function" class="md-nav__link">
    register_function()
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#centraal_client_flow.events.timer" class="md-nav__link">
    timer
  </a>
  
    <nav class="md-nav" aria-label="timer">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#centraal_client_flow.events.timer.Pull" class="md-nav__link">
    Pull
  </a>
  
    <nav class="md-nav" aria-label="Pull">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#centraal_client_flow.events.timer.Pull.__init__" class="md-nav__link">
    __init__()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#centraal_client_flow.events.timer.Pull.register_function" class="md-nav__link">
    register_function()
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#centraal_client_flow.events.timer.TimerFunctionBuilder" class="md-nav__link">
    TimerFunctionBuilder
  </a>
  
    <nav class="md-nav" aria-label="TimerFunctionBuilder">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#centraal_client_flow.events.timer.TimerFunctionBuilder.__init__" class="md-nav__link">
    __init__()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#centraal_client_flow.events.timer.TimerFunctionBuilder.build_function" class="md-nav__link">
    build_function()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#centraal_client_flow.events.timer.TimerFunctionBuilder.register_function" class="md-nav__link">
    register_function()
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#centraal_client_flow.helpers" class="md-nav__link">
    helpers
  </a>
  
    <nav class="md-nav" aria-label="helpers">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#centraal_client_flow.helpers.cosmos" class="md-nav__link">
    cosmos
  </a>
  
    <nav class="md-nav" aria-label="cosmos">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#centraal_client_flow.helpers.cosmos.save_model_to_cosmos" class="md-nav__link">
    save_model_to_cosmos()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#centraal_client_flow.helpers.cosmos.write_model_to_cosmos" class="md-nav__link">
    write_model_to_cosmos()
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#centraal_client_flow.helpers.logger" class="md-nav__link">
    logger
  </a>
  
    <nav class="md-nav" aria-label="logger">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#centraal_client_flow.helpers.logger.LoggerMixin" class="md-nav__link">
    LoggerMixin
  </a>
  
    <nav class="md-nav" aria-label="LoggerMixin">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#centraal_client_flow.helpers.logger.LoggerMixin.__init__" class="md-nav__link">
    __init__()
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#centraal_client_flow.helpers.pydantic" class="md-nav__link">
    pydantic
  </a>
  
    <nav class="md-nav" aria-label="pydantic">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#centraal_client_flow.helpers.pydantic.built_valid_json_str_with_aditional_info" class="md-nav__link">
    built_valid_json_str_with_aditional_info()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#centraal_client_flow.helpers.pydantic.serialize_validation_errors" class="md-nav__link">
    serialize_validation_errors()
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#centraal_client_flow.rules" class="md-nav__link">
    rules
  </a>
  
    <nav class="md-nav" aria-label="rules">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#centraal_client_flow.rules.NoHayReglas" class="md-nav__link">
    NoHayReglas
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#centraal_client_flow.rules.integration" class="md-nav__link">
    integration
  </a>
  
    <nav class="md-nav" aria-label="integration">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#centraal_client_flow.rules.integration.processor" class="md-nav__link">
    processor
  </a>
  
    <nav class="md-nav" aria-label="processor">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#centraal_client_flow.rules.integration.processor.IntegrationRule" class="md-nav__link">
    IntegrationRule
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#centraal_client_flow.rules.integration.processor.IntegrationRule.__init__" class="md-nav__link">
    __init__()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#centraal_client_flow.rules.integration.processor.IntegrationRule.run" class="md-nav__link">
    run()
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#centraal_client_flow.rules.integration.strategy" class="md-nav__link">
    strategy
  </a>
  
    <nav class="md-nav" aria-label="strategy">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#centraal_client_flow.rules.integration.strategy.IntegrationStrategy" class="md-nav__link">
    IntegrationStrategy
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#centraal_client_flow.rules.integration.strategy.IntegrationStrategy.__init__" class="md-nav__link">
    __init__()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#centraal_client_flow.rules.integration.strategy.IntegrationStrategy.integrate" class="md-nav__link">
    integrate()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#centraal_client_flow.rules.integration.strategy.IntegrationStrategy.modelo_unificado_mapping" class="md-nav__link">
    modelo_unificado_mapping()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#centraal_client_flow.rules.integration.strategy.OAuthConfigPassFlow" class="md-nav__link">
    OAuthConfigPassFlow
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#centraal_client_flow.rules.integration.strategy.OAuthTokenPass" class="md-nav__link">
    OAuthTokenPass
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#centraal_client_flow.rules.integration.strategy.RESTIntegration" class="md-nav__link">
    RESTIntegration
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#centraal_client_flow.rules.integration.strategy.RESTIntegration.__init__" class="md-nav__link">
    __init__()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#centraal_client_flow.rules.integration.strategy.RESTIntegration.integrate" class="md-nav__link">
    integrate()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#centraal_client_flow.rules.integration.strategy.RESTIntegration.modelo_unificado_mapping" class="md-nav__link">
    modelo_unificado_mapping()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#centraal_client_flow.rules.integration.strategy.RESTIntegration.set_response_processor" class="md-nav__link">
    set_response_processor()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#centraal_client_flow.rules.integration.strategy.StrategyResult" class="md-nav__link">
    StrategyResult
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#centraal_client_flow.rules.integration.v2" class="md-nav__link">
    v2
  </a>
  
    <nav class="md-nav" aria-label="v2">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#centraal_client_flow.rules.integration.v2.IntegrationResult" class="md-nav__link">
    IntegrationResult
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#centraal_client_flow.rules.integration.v2.IntegrationResult.__post_init__" class="md-nav__link">
    __post_init__()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#centraal_client_flow.rules.integration.v2.IntegrationRule" class="md-nav__link">
    IntegrationRule
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#centraal_client_flow.rules.integration.v2.IntegrationRule.__init__" class="md-nav__link">
    __init__()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#centraal_client_flow.rules.integration.v2.IntegrationRule.run" class="md-nav__link">
    run()
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#centraal_client_flow.rules.update" class="md-nav__link">
    update
  </a>
  
    <nav class="md-nav" aria-label="update">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#centraal_client_flow.rules.update.Rule" class="md-nav__link">
    Rule
  </a>
  
    <nav class="md-nav" aria-label="Rule">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#centraal_client_flow.rules.update.Rule.__post_init__" class="md-nav__link">
    __post_init__()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#centraal_client_flow.rules.update.Rule.process_rule" class="md-nav__link">
    process_rule()
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#centraal_client_flow.rules.update.RuleProcessor" class="md-nav__link">
    RuleProcessor
  </a>
  
    <nav class="md-nav" aria-label="RuleProcessor">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#centraal_client_flow.rules.update.RuleProcessor.detect_changes" class="md-nav__link">
    detect_changes()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#centraal_client_flow.rules.update.RuleProcessor.get_current_entrada" class="md-nav__link">
    get_current_entrada()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#centraal_client_flow.rules.update.RuleProcessor.publish_to_topics" class="md-nav__link">
    publish_to_topics()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#centraal_client_flow.rules.update.RuleProcessor.record_auditoria" class="md-nav__link">
    record_auditoria()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#centraal_client_flow.rules.update.RuleProcessor.save_unified_model" class="md-nav__link">
    save_unified_model()
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#centraal_client_flow.rules.update.RuleSelector" class="md-nav__link">
    RuleSelector
  </a>
  
    <nav class="md-nav" aria-label="RuleSelector">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#centraal_client_flow.rules.update.RuleSelector.get_topics_by_changes" class="md-nav__link">
    get_topics_by_changes()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#centraal_client_flow.rules.update.RuleSelector.register_rule" class="md-nav__link">
    register_rule()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#centraal_client_flow.rules.update.RuleSelector.select_rule" class="md-nav__link">
    select_rule()
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#centraal_client_flow.rules.update.UpdateProcessor" class="md-nav__link">
    UpdateProcessor
  </a>
  
    <nav class="md-nav" aria-label="UpdateProcessor">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#centraal_client_flow.rules.update.UpdateProcessor.process_message" class="md-nav__link">
    process_message()
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../contributing/" class="md-nav__link">
        contributing
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../authors/" class="md-nav__link">
        authors
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../history/" class="md-nav__link">
        history
      </a>
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#centraal_client_flow" class="md-nav__link">
    centraal_client_flow
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#centraal_client_flow.connections" class="md-nav__link">
    connections
  </a>
  
    <nav class="md-nav" aria-label="connections">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#centraal_client_flow.connections.cosmosdb" class="md-nav__link">
    cosmosdb
  </a>
  
    <nav class="md-nav" aria-label="cosmosdb">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#centraal_client_flow.connections.cosmosdb.CosmosDBSingleton" class="md-nav__link">
    CosmosDBSingleton
  </a>
  
    <nav class="md-nav" aria-label="CosmosDBSingleton">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#centraal_client_flow.connections.cosmosdb.CosmosDBSingleton.__new__" class="md-nav__link">
    __new__()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#centraal_client_flow.connections.cosmosdb.CosmosDBSingleton.get_container_client" class="md-nav__link">
    get_container_client()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#centraal_client_flow.connections.cosmosdb.CosmosDBSingleton.set_mock_client" class="md-nav__link">
    set_mock_client()
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#centraal_client_flow.connections.service_bus" class="md-nav__link">
    service_bus
  </a>
  
    <nav class="md-nav" aria-label="service_bus">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#centraal_client_flow.connections.service_bus.IServiceBusClient" class="md-nav__link">
    IServiceBusClient
  </a>
  
    <nav class="md-nav" aria-label="IServiceBusClient">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#centraal_client_flow.connections.service_bus.IServiceBusClient.send_message_to_queue" class="md-nav__link">
    send_message_to_queue()
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#centraal_client_flow.connections.service_bus.ServiceBusClientSingleton" class="md-nav__link">
    ServiceBusClientSingleton
  </a>
  
    <nav class="md-nav" aria-label="ServiceBusClientSingleton">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#centraal_client_flow.connections.service_bus.ServiceBusClientSingleton.__new__" class="md-nav__link">
    __new__()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#centraal_client_flow.connections.service_bus.ServiceBusClientSingleton.close" class="md-nav__link">
    close()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#centraal_client_flow.connections.service_bus.ServiceBusClientSingleton.get_sender" class="md-nav__link">
    get_sender()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#centraal_client_flow.connections.service_bus.ServiceBusClientSingleton.send_message_to_queue" class="md-nav__link">
    send_message_to_queue()
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#centraal_client_flow.events" class="md-nav__link">
    events
  </a>
  
    <nav class="md-nav" aria-label="events">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#centraal_client_flow.events.EventProcessor" class="md-nav__link">
    EventProcessor
  </a>
  
    <nav class="md-nav" aria-label="EventProcessor">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#centraal_client_flow.events.EventProcessor.process_event" class="md-nav__link">
    process_event()
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#centraal_client_flow.events.PullProcessor" class="md-nav__link">
    PullProcessor
  </a>
  
    <nav class="md-nav" aria-label="PullProcessor">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#centraal_client_flow.events.PullProcessor.get_data" class="md-nav__link">
    get_data()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#centraal_client_flow.events.PullProcessor.process_event" class="md-nav__link">
    process_event()
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#centraal_client_flow.events.processor" class="md-nav__link">
    processor
  </a>
  
    <nav class="md-nav" aria-label="processor">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#centraal_client_flow.events.processor.EventProcessor" class="md-nav__link">
    EventProcessor
  </a>
  
    <nav class="md-nav" aria-label="EventProcessor">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#centraal_client_flow.events.processor.EventProcessor.process_event" class="md-nav__link">
    process_event()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#centraal_client_flow.events.processor.EventProcessor.send_to_queue" class="md-nav__link">
    send_to_queue()
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#centraal_client_flow.events.receiver" class="md-nav__link">
    receiver
  </a>
  
    <nav class="md-nav" aria-label="receiver">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#centraal_client_flow.events.receiver.EventFunctionBuilder" class="md-nav__link">
    EventFunctionBuilder
  </a>
  
    <nav class="md-nav" aria-label="EventFunctionBuilder">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#centraal_client_flow.events.receiver.EventFunctionBuilder.__init__" class="md-nav__link">
    __init__()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#centraal_client_flow.events.receiver.EventFunctionBuilder.build_function" class="md-nav__link">
    build_function()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#centraal_client_flow.events.receiver.EventFunctionBuilder.register_function" class="md-nav__link">
    register_function()
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#centraal_client_flow.events.receiver.Recieve" class="md-nav__link">
    Recieve
  </a>
  
    <nav class="md-nav" aria-label="Recieve">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#centraal_client_flow.events.receiver.Recieve.__init__" class="md-nav__link">
    __init__()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#centraal_client_flow.events.receiver.Recieve.register_function" class="md-nav__link">
    register_function()
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#centraal_client_flow.events.timer" class="md-nav__link">
    timer
  </a>
  
    <nav class="md-nav" aria-label="timer">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#centraal_client_flow.events.timer.Pull" class="md-nav__link">
    Pull
  </a>
  
    <nav class="md-nav" aria-label="Pull">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#centraal_client_flow.events.timer.Pull.__init__" class="md-nav__link">
    __init__()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#centraal_client_flow.events.timer.Pull.register_function" class="md-nav__link">
    register_function()
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#centraal_client_flow.events.timer.TimerFunctionBuilder" class="md-nav__link">
    TimerFunctionBuilder
  </a>
  
    <nav class="md-nav" aria-label="TimerFunctionBuilder">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#centraal_client_flow.events.timer.TimerFunctionBuilder.__init__" class="md-nav__link">
    __init__()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#centraal_client_flow.events.timer.TimerFunctionBuilder.build_function" class="md-nav__link">
    build_function()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#centraal_client_flow.events.timer.TimerFunctionBuilder.register_function" class="md-nav__link">
    register_function()
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#centraal_client_flow.helpers" class="md-nav__link">
    helpers
  </a>
  
    <nav class="md-nav" aria-label="helpers">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#centraal_client_flow.helpers.cosmos" class="md-nav__link">
    cosmos
  </a>
  
    <nav class="md-nav" aria-label="cosmos">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#centraal_client_flow.helpers.cosmos.save_model_to_cosmos" class="md-nav__link">
    save_model_to_cosmos()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#centraal_client_flow.helpers.cosmos.write_model_to_cosmos" class="md-nav__link">
    write_model_to_cosmos()
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#centraal_client_flow.helpers.logger" class="md-nav__link">
    logger
  </a>
  
    <nav class="md-nav" aria-label="logger">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#centraal_client_flow.helpers.logger.LoggerMixin" class="md-nav__link">
    LoggerMixin
  </a>
  
    <nav class="md-nav" aria-label="LoggerMixin">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#centraal_client_flow.helpers.logger.LoggerMixin.__init__" class="md-nav__link">
    __init__()
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#centraal_client_flow.helpers.pydantic" class="md-nav__link">
    pydantic
  </a>
  
    <nav class="md-nav" aria-label="pydantic">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#centraal_client_flow.helpers.pydantic.built_valid_json_str_with_aditional_info" class="md-nav__link">
    built_valid_json_str_with_aditional_info()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#centraal_client_flow.helpers.pydantic.serialize_validation_errors" class="md-nav__link">
    serialize_validation_errors()
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#centraal_client_flow.rules" class="md-nav__link">
    rules
  </a>
  
    <nav class="md-nav" aria-label="rules">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#centraal_client_flow.rules.NoHayReglas" class="md-nav__link">
    NoHayReglas
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#centraal_client_flow.rules.integration" class="md-nav__link">
    integration
  </a>
  
    <nav class="md-nav" aria-label="integration">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#centraal_client_flow.rules.integration.processor" class="md-nav__link">
    processor
  </a>
  
    <nav class="md-nav" aria-label="processor">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#centraal_client_flow.rules.integration.processor.IntegrationRule" class="md-nav__link">
    IntegrationRule
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#centraal_client_flow.rules.integration.processor.IntegrationRule.__init__" class="md-nav__link">
    __init__()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#centraal_client_flow.rules.integration.processor.IntegrationRule.run" class="md-nav__link">
    run()
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#centraal_client_flow.rules.integration.strategy" class="md-nav__link">
    strategy
  </a>
  
    <nav class="md-nav" aria-label="strategy">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#centraal_client_flow.rules.integration.strategy.IntegrationStrategy" class="md-nav__link">
    IntegrationStrategy
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#centraal_client_flow.rules.integration.strategy.IntegrationStrategy.__init__" class="md-nav__link">
    __init__()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#centraal_client_flow.rules.integration.strategy.IntegrationStrategy.integrate" class="md-nav__link">
    integrate()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#centraal_client_flow.rules.integration.strategy.IntegrationStrategy.modelo_unificado_mapping" class="md-nav__link">
    modelo_unificado_mapping()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#centraal_client_flow.rules.integration.strategy.OAuthConfigPassFlow" class="md-nav__link">
    OAuthConfigPassFlow
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#centraal_client_flow.rules.integration.strategy.OAuthTokenPass" class="md-nav__link">
    OAuthTokenPass
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#centraal_client_flow.rules.integration.strategy.RESTIntegration" class="md-nav__link">
    RESTIntegration
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#centraal_client_flow.rules.integration.strategy.RESTIntegration.__init__" class="md-nav__link">
    __init__()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#centraal_client_flow.rules.integration.strategy.RESTIntegration.integrate" class="md-nav__link">
    integrate()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#centraal_client_flow.rules.integration.strategy.RESTIntegration.modelo_unificado_mapping" class="md-nav__link">
    modelo_unificado_mapping()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#centraal_client_flow.rules.integration.strategy.RESTIntegration.set_response_processor" class="md-nav__link">
    set_response_processor()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#centraal_client_flow.rules.integration.strategy.StrategyResult" class="md-nav__link">
    StrategyResult
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#centraal_client_flow.rules.integration.v2" class="md-nav__link">
    v2
  </a>
  
    <nav class="md-nav" aria-label="v2">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#centraal_client_flow.rules.integration.v2.IntegrationResult" class="md-nav__link">
    IntegrationResult
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#centraal_client_flow.rules.integration.v2.IntegrationResult.__post_init__" class="md-nav__link">
    __post_init__()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#centraal_client_flow.rules.integration.v2.IntegrationRule" class="md-nav__link">
    IntegrationRule
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#centraal_client_flow.rules.integration.v2.IntegrationRule.__init__" class="md-nav__link">
    __init__()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#centraal_client_flow.rules.integration.v2.IntegrationRule.run" class="md-nav__link">
    run()
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#centraal_client_flow.rules.update" class="md-nav__link">
    update
  </a>
  
    <nav class="md-nav" aria-label="update">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#centraal_client_flow.rules.update.Rule" class="md-nav__link">
    Rule
  </a>
  
    <nav class="md-nav" aria-label="Rule">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#centraal_client_flow.rules.update.Rule.__post_init__" class="md-nav__link">
    __post_init__()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#centraal_client_flow.rules.update.Rule.process_rule" class="md-nav__link">
    process_rule()
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#centraal_client_flow.rules.update.RuleProcessor" class="md-nav__link">
    RuleProcessor
  </a>
  
    <nav class="md-nav" aria-label="RuleProcessor">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#centraal_client_flow.rules.update.RuleProcessor.detect_changes" class="md-nav__link">
    detect_changes()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#centraal_client_flow.rules.update.RuleProcessor.get_current_entrada" class="md-nav__link">
    get_current_entrada()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#centraal_client_flow.rules.update.RuleProcessor.publish_to_topics" class="md-nav__link">
    publish_to_topics()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#centraal_client_flow.rules.update.RuleProcessor.record_auditoria" class="md-nav__link">
    record_auditoria()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#centraal_client_flow.rules.update.RuleProcessor.save_unified_model" class="md-nav__link">
    save_unified_model()
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#centraal_client_flow.rules.update.RuleSelector" class="md-nav__link">
    RuleSelector
  </a>
  
    <nav class="md-nav" aria-label="RuleSelector">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#centraal_client_flow.rules.update.RuleSelector.get_topics_by_changes" class="md-nav__link">
    get_topics_by_changes()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#centraal_client_flow.rules.update.RuleSelector.register_rule" class="md-nav__link">
    register_rule()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#centraal_client_flow.rules.update.RuleSelector.select_rule" class="md-nav__link">
    select_rule()
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#centraal_client_flow.rules.update.UpdateProcessor" class="md-nav__link">
    UpdateProcessor
  </a>
  
    <nav class="md-nav" aria-label="UpdateProcessor">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#centraal_client_flow.rules.update.UpdateProcessor.process_message" class="md-nav__link">
    process_message()
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  

  <a href="https://github.com/centraal-api/centraal_client_flow/edit/master/docs/api.md" title="Edit this page" class="md-content__button md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20.71 7.04c.39-.39.39-1.04 0-1.41l-2.34-2.34c-.37-.39-1.02-.39-1.41 0l-1.84 1.83 3.75 3.75M3 17.25V21h3.75L17.81 9.93l-3.75-3.75L3 17.25Z"/></svg>
  </a>


  <h1>modules</h1>

<div class="doc doc-object doc-module">

<a id="centraal_client_flow"></a>
    <div class="doc doc-contents first">

      <p>Top-level package for centraal-client-flow.</p>



  <div class="doc doc-children">













  <div class="doc doc-object doc-module">



<h2 id="centraal_client_flow.connections" class="doc doc-heading">
        <code>connections</code>


  <span class="doc doc-properties">
      <small class="doc doc-property doc-property-special"><code>special</code></small>
  </span>

<a href="#centraal_client_flow.connections" class="headerlink" title="Permanent link">&para;</a></h2>

    <div class="doc doc-contents ">




  <div class="doc doc-children">










  <div class="doc doc-object doc-module">



<h3 id="centraal_client_flow.connections.cosmosdb" class="doc doc-heading">
        <code>cosmosdb</code>



<a href="#centraal_client_flow.connections.cosmosdb" class="headerlink" title="Permanent link">&para;</a></h3>

    <div class="doc doc-contents ">

      <p>Modulo de conexión a cosmos.</p>



  <div class="doc doc-children">







  <div class="doc doc-object doc-class">



<h4 id="centraal_client_flow.connections.cosmosdb.CosmosDBSingleton" class="doc doc-heading">
        <code>
CosmosDBSingleton        </code>



<a href="#centraal_client_flow.connections.cosmosdb.CosmosDBSingleton" class="headerlink" title="Permanent link">&para;</a></h4>

    <div class="doc doc-contents ">

      <p>Singleton class for Cosmos DB client.</p>

        <details class="quote">
          <summary>Source code in <code>centraal_client_flow/connections/cosmosdb.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">class</span> <span class="nc">CosmosDBSingleton</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Singleton class for Cosmos DB client.&quot;&quot;&quot;</span>

    <span class="n">_instance</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="s2">&quot;CosmosDBSingleton&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="n">_lock</span><span class="p">:</span> <span class="n">Lock</span> <span class="o">=</span> <span class="n">Lock</span><span class="p">()</span>

    <span class="k">def</span> <span class="fm">__new__</span><span class="p">(</span>
        <span class="bp">cls</span><span class="p">,</span>
        <span class="n">connection_string</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">database_name</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="s2">&quot;CosmosDBSingleton&quot;</span><span class="p">:</span>
        <span class="k">if</span> <span class="bp">cls</span><span class="o">.</span><span class="n">_instance</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">with</span> <span class="bp">cls</span><span class="o">.</span><span class="n">_lock</span><span class="p">:</span>
                <span class="k">if</span> <span class="bp">cls</span><span class="o">.</span><span class="n">_instance</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="bp">cls</span><span class="o">.</span><span class="n">_instance</span> <span class="o">=</span> <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__new__</span><span class="p">(</span><span class="bp">cls</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">cls</span><span class="o">.</span><span class="n">_instance</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">connection_string</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">database_name</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s2">&quot;_initialized&quot;</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_initialized</span> <span class="o">=</span> <span class="kc">False</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">client</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">CosmosClient</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">database</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">CosmosClient</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">connection_string</span> <span class="o">=</span> <span class="n">connection_string</span> <span class="ow">or</span> <span class="n">os</span><span class="o">.</span><span class="n">getenv</span><span class="p">(</span>
                <span class="s2">&quot;COSMOS_CONNECTION_STRING&quot;</span>
            <span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">database_name</span> <span class="o">=</span> <span class="n">database_name</span> <span class="ow">or</span> <span class="n">os</span><span class="o">.</span><span class="n">getenv</span><span class="p">(</span><span class="s2">&quot;DATABASE_NAME&quot;</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_initialize</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Initialize the Cosmos DB client and database.&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">client</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">database</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">connection_string</span> <span class="ow">or</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">database_name</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Connection string and database name must be provided&quot;</span><span class="p">)</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">client</span> <span class="o">=</span> <span class="n">CosmosClient</span><span class="o">.</span><span class="n">from_connection_string</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">connection_string</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">database</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">client</span><span class="o">.</span><span class="n">get_database_client</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">database_name</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_initialized</span> <span class="o">=</span> <span class="kc">True</span>

    <span class="k">def</span> <span class="nf">get_container_client</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">container_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">ContainerProxy</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Get a container client.&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_initialize</span><span class="p">()</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">database</span><span class="o">.</span><span class="n">get_container_client</span><span class="p">(</span><span class="n">container_name</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">set_mock_client</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">mock_client</span><span class="p">:</span> <span class="n">CosmosClient</span><span class="p">,</span> <span class="n">mock_database</span><span class="p">:</span> <span class="n">CosmosClient</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Set a mock client and database for testing purposes.&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">client</span> <span class="o">=</span> <span class="n">mock_client</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">database</span> <span class="o">=</span> <span class="n">mock_database</span>
</code></pre></div>
        </details>



  <div class="doc doc-children">










  <div class="doc doc-object doc-method">



<h5 id="centraal_client_flow.connections.cosmosdb.CosmosDBSingleton.__new__" class="doc doc-heading">
<code class="highlight language-python"><span class="fm">__new__</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">connection_string</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">database_name</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>

  <span class="doc doc-properties">
      <small class="doc doc-property doc-property-special"><code>special</code></small>
      <small class="doc doc-property doc-property-staticmethod"><code>staticmethod</code></small>
  </span>

<a href="#centraal_client_flow.connections.cosmosdb.CosmosDBSingleton.__new__" class="headerlink" title="Permanent link">&para;</a></h5>

    <div class="doc doc-contents ">

      <p>Create and return a new object.  See help(type) for accurate signature.</p>

        <details class="quote">
          <summary>Source code in <code>centraal_client_flow/connections/cosmosdb.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="fm">__new__</span><span class="p">(</span>
    <span class="bp">cls</span><span class="p">,</span>
    <span class="n">connection_string</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">database_name</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="s2">&quot;CosmosDBSingleton&quot;</span><span class="p">:</span>
    <span class="k">if</span> <span class="bp">cls</span><span class="o">.</span><span class="n">_instance</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">with</span> <span class="bp">cls</span><span class="o">.</span><span class="n">_lock</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">cls</span><span class="o">.</span><span class="n">_instance</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="bp">cls</span><span class="o">.</span><span class="n">_instance</span> <span class="o">=</span> <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__new__</span><span class="p">(</span><span class="bp">cls</span><span class="p">)</span>
    <span class="k">return</span> <span class="bp">cls</span><span class="o">.</span><span class="n">_instance</span>
</code></pre></div>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-method">



<h5 id="centraal_client_flow.connections.cosmosdb.CosmosDBSingleton.get_container_client" class="doc doc-heading">
<code class="highlight language-python"><span class="n">get_container_client</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">container_name</span><span class="p">)</span></code>


<a href="#centraal_client_flow.connections.cosmosdb.CosmosDBSingleton.get_container_client" class="headerlink" title="Permanent link">&para;</a></h5>

    <div class="doc doc-contents ">

      <p>Get a container client.</p>

        <details class="quote">
          <summary>Source code in <code>centraal_client_flow/connections/cosmosdb.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="nf">get_container_client</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">container_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">ContainerProxy</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Get a container client.&quot;&quot;&quot;</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_initialize</span><span class="p">()</span>
    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">database</span><span class="o">.</span><span class="n">get_container_client</span><span class="p">(</span><span class="n">container_name</span><span class="p">)</span>
</code></pre></div>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-method">



<h5 id="centraal_client_flow.connections.cosmosdb.CosmosDBSingleton.set_mock_client" class="doc doc-heading">
<code class="highlight language-python"><span class="n">set_mock_client</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">mock_client</span><span class="p">,</span> <span class="n">mock_database</span><span class="p">)</span></code>


<a href="#centraal_client_flow.connections.cosmosdb.CosmosDBSingleton.set_mock_client" class="headerlink" title="Permanent link">&para;</a></h5>

    <div class="doc doc-contents ">

      <p>Set a mock client and database for testing purposes.</p>

        <details class="quote">
          <summary>Source code in <code>centraal_client_flow/connections/cosmosdb.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="nf">set_mock_client</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span> <span class="n">mock_client</span><span class="p">:</span> <span class="n">CosmosClient</span><span class="p">,</span> <span class="n">mock_database</span><span class="p">:</span> <span class="n">CosmosClient</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Set a mock client and database for testing purposes.&quot;&quot;&quot;</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">client</span> <span class="o">=</span> <span class="n">mock_client</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">database</span> <span class="o">=</span> <span class="n">mock_database</span>
</code></pre></div>
        </details>
    </div>

  </div>





  </div>

    </div>

  </div>







  </div>

    </div>

  </div>



  <div class="doc doc-object doc-module">



<h3 id="centraal_client_flow.connections.service_bus" class="doc doc-heading">
        <code>service_bus</code>



<a href="#centraal_client_flow.connections.service_bus" class="headerlink" title="Permanent link">&para;</a></h3>

    <div class="doc doc-contents ">

      <p>Conexiones a service bus.</p>



  <div class="doc doc-children">








  <div class="doc doc-object doc-class">



<h4 id="centraal_client_flow.connections.service_bus.IServiceBusClient" class="doc doc-heading">
        <code>
IServiceBusClient            (<span title="typing.Protocol">Protocol</span>)
        </code>



<a href="#centraal_client_flow.connections.service_bus.IServiceBusClient" class="headerlink" title="Permanent link">&para;</a></h4>

    <div class="doc doc-contents ">

      <p>Interfaz.</p>

        <details class="quote">
          <summary>Source code in <code>centraal_client_flow/connections/service_bus.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="nd">@runtime_checkable</span>
<span class="k">class</span> <span class="nc">IServiceBusClient</span><span class="p">(</span><span class="n">Protocol</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Interfaz.&quot;&quot;&quot;</span>

    <span class="n">client</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">ServiceBusClient</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="n">connection_str</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>

    <span class="k">def</span> <span class="nf">send_message_to_queue</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">message</span><span class="p">:</span> <span class="nb">dict</span><span class="p">,</span> <span class="n">session_id</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">queue_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Envía un mensaje a la cola de Service Bus especificada.</span>

<span class="sd">        Args:</span>
<span class="sd">            message: El mensaje a enviar representado como un diccionario.</span>
<span class="sd">            session_id: ID de sesión para el mensaje. Debe ser el id del modelo.</span>
<span class="sd">            queue_name: Nombre de la cola a la que se enviará el mensaje.</span>
<span class="sd">        &quot;&quot;&quot;</span>
</code></pre></div>
        </details>



  <div class="doc doc-children">













  <div class="doc doc-object doc-method">



<h5 id="centraal_client_flow.connections.service_bus.IServiceBusClient.send_message_to_queue" class="doc doc-heading">
<code class="highlight language-python"><span class="n">send_message_to_queue</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">message</span><span class="p">,</span> <span class="n">session_id</span><span class="p">,</span> <span class="n">queue_name</span><span class="p">)</span></code>


<a href="#centraal_client_flow.connections.service_bus.IServiceBusClient.send_message_to_queue" class="headerlink" title="Permanent link">&para;</a></h5>

    <div class="doc doc-contents ">

      <p>Envía un mensaje a la cola de Service Bus especificada.</p>

<p><strong>Parameters:</strong></p>
<table>
  <thead>
    <tr>
      <th>Name</th>
      <th>Type</th>
      <th>Description</th>
      <th>Default</th>
    </tr>
  </thead>
  <tbody>
      <tr>
        <td><code>message</code></td>
        <td><code>dict</code></td>
        <td><p>El mensaje a enviar representado como un diccionario.</p></td>
        <td><em>required</em></td>
      </tr>
      <tr>
        <td><code>session_id</code></td>
        <td><code>str</code></td>
        <td><p>ID de sesión para el mensaje. Debe ser el id del modelo.</p></td>
        <td><em>required</em></td>
      </tr>
      <tr>
        <td><code>queue_name</code></td>
        <td><code>str</code></td>
        <td><p>Nombre de la cola a la que se enviará el mensaje.</p></td>
        <td><em>required</em></td>
      </tr>
  </tbody>
</table>
        <details class="quote">
          <summary>Source code in <code>centraal_client_flow/connections/service_bus.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="nf">send_message_to_queue</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">message</span><span class="p">:</span> <span class="nb">dict</span><span class="p">,</span> <span class="n">session_id</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">queue_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Envía un mensaje a la cola de Service Bus especificada.</span>

<span class="sd">    Args:</span>
<span class="sd">        message: El mensaje a enviar representado como un diccionario.</span>
<span class="sd">        session_id: ID de sesión para el mensaje. Debe ser el id del modelo.</span>
<span class="sd">        queue_name: Nombre de la cola a la que se enviará el mensaje.</span>
<span class="sd">    &quot;&quot;&quot;</span>
</code></pre></div>
        </details>
    </div>

  </div>





  </div>

    </div>

  </div>



  <div class="doc doc-object doc-class">



<h4 id="centraal_client_flow.connections.service_bus.ServiceBusClientSingleton" class="doc doc-heading">
        <code>
ServiceBusClientSingleton            (<a title="centraal_client_flow.connections.service_bus.IServiceBusClient" href="#centraal_client_flow.connections.service_bus.IServiceBusClient">IServiceBusClient</a>)
        </code>



<a href="#centraal_client_flow.connections.service_bus.ServiceBusClientSingleton" class="headerlink" title="Permanent link">&para;</a></h4>

    <div class="doc doc-contents ">

      <p>Singleton para manejar la conexión a Azure Service Bus.</p>

        <details class="quote">
          <summary>Source code in <code>centraal_client_flow/connections/service_bus.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">class</span> <span class="nc">ServiceBusClientSingleton</span><span class="p">(</span><span class="n">IServiceBusClient</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Singleton para manejar la conexión a Azure Service Bus.&quot;&quot;&quot;</span>

    <span class="n">_instance</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="n">client</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">ServiceBusClient</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="n">connection_str</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="n">senders</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="n">MAX_RETRIES</span> <span class="o">=</span> <span class="mi">3</span>
    <span class="n">RETRY_DELAY</span> <span class="o">=</span> <span class="mi">1</span>

    <span class="k">def</span> <span class="fm">__new__</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">connection_str</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Crea una instancia única de ServiceBusClientSingleton si no existe.</span>

<span class="sd">        Args:</span>
<span class="sd">            connection_str: Cadena de conexión a Azure Service Bus.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">cls</span><span class="o">.</span><span class="n">_instance</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">cls</span><span class="o">.</span><span class="n">_instance</span> <span class="o">=</span> <span class="nb">super</span><span class="p">(</span><span class="n">ServiceBusClientSingleton</span><span class="p">,</span> <span class="bp">cls</span><span class="p">)</span><span class="o">.</span><span class="fm">__new__</span><span class="p">(</span><span class="bp">cls</span><span class="p">)</span>
            <span class="bp">cls</span><span class="o">.</span><span class="n">_instance</span><span class="o">.</span><span class="n">connection_str</span> <span class="o">=</span> <span class="n">connection_str</span>
            <span class="bp">cls</span><span class="o">.</span><span class="n">_instance</span><span class="o">.</span><span class="n">_initialize_client</span><span class="p">()</span>

        <span class="k">return</span> <span class="bp">cls</span><span class="o">.</span><span class="n">_instance</span>

    <span class="k">def</span> <span class="nf">_initialize_client</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Initialize the Service Bus client with retry logic.&quot;&quot;&quot;</span>
        <span class="k">for</span> <span class="n">attempt</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">MAX_RETRIES</span><span class="p">):</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">client</span> <span class="o">=</span> <span class="n">ServiceBusClient</span><span class="o">.</span><span class="n">from_connection_string</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">connection_str</span><span class="p">)</span>
                <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Successfully initialized Service Bus client&quot;</span><span class="p">)</span>
                <span class="k">return</span>
            <span class="k">except</span> <span class="p">(</span><span class="n">ServiceBusError</span><span class="p">,</span> <span class="n">ServiceBusConnectionError</span><span class="p">,</span> <span class="ne">AttributeError</span><span class="p">)</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">attempt</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">MAX_RETRIES</span> <span class="o">-</span> <span class="mi">1</span><span class="p">:</span>
                    <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span>
                        <span class="sa">f</span><span class="s2">&quot;Failed to initialize Service Bus client after </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">MAX_RETRIES</span><span class="si">}</span><span class="s2"> attempts: </span><span class="si">{</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
                    <span class="k">raise</span>
                <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span>
                    <span class="sa">f</span><span class="s2">&quot;Attempt </span><span class="si">{</span><span class="n">attempt</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="si">}</span><span class="s2"> failed to initialize Service Bus client: </span><span class="si">{</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
                <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">RETRY_DELAY</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_ensure_client_connection</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Ensure the client is connected and valid.&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">client</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_initialize_client</span><span class="p">()</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">client</span>

    <span class="k">def</span> <span class="nf">get_sender</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">queue_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Get or create a sender for the specified queue with retry logic.&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">queue_name</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">senders</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">attempt</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">MAX_RETRIES</span><span class="p">):</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="n">client</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_ensure_client_connection</span><span class="p">()</span>
                    <span class="k">if</span> <span class="n">queue_name</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">senders</span><span class="p">:</span>
                        <span class="k">try</span><span class="p">:</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">senders</span><span class="p">[</span><span class="n">queue_name</span><span class="p">]</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
                        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
                            <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Error closing existing sender: </span><span class="si">{</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

                    <span class="bp">self</span><span class="o">.</span><span class="n">senders</span><span class="p">[</span><span class="n">queue_name</span><span class="p">]</span> <span class="o">=</span> <span class="n">client</span><span class="o">.</span><span class="n">get_queue_sender</span><span class="p">(</span><span class="n">queue_name</span><span class="p">)</span>
                    <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Successfully created sender for queue: </span><span class="si">{</span><span class="n">queue_name</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
                    <span class="k">break</span>
                <span class="k">except</span> <span class="p">(</span><span class="n">ServiceBusError</span><span class="p">,</span> <span class="n">ServiceBusConnectionError</span><span class="p">,</span> <span class="ne">AttributeError</span><span class="p">)</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">attempt</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">MAX_RETRIES</span> <span class="o">-</span> <span class="mi">1</span><span class="p">:</span>
                        <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span>
                            <span class="sa">f</span><span class="s2">&quot;Failed to create sender for queue </span><span class="si">{</span><span class="n">queue_name</span><span class="si">}</span><span class="s2"> after </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">MAX_RETRIES</span><span class="si">}</span><span class="s2"> attempts: </span><span class="si">{</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
                        <span class="k">raise</span>
                    <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span>
                        <span class="sa">f</span><span class="s2">&quot;Attempt </span><span class="si">{</span><span class="n">attempt</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="si">}</span><span class="s2"> failed to create sender for queue </span><span class="si">{</span><span class="n">queue_name</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
                    <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">RETRY_DELAY</span><span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">_initialize_client</span><span class="p">()</span>  <span class="c1"># Try to reinitialize the client</span>

        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">senders</span><span class="p">[</span><span class="n">queue_name</span><span class="p">]</span>

    <span class="k">def</span> <span class="nf">send_message_to_queue</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">message</span><span class="p">:</span> <span class="nb">dict</span><span class="p">,</span> <span class="n">session_id</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">queue_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Envía un mensaje a la cola de Service Bus especificada con retry logic.&quot;&quot;&quot;</span>
        <span class="k">for</span> <span class="n">attempt</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">MAX_RETRIES</span><span class="p">):</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">sender</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_sender</span><span class="p">(</span><span class="n">queue_name</span><span class="p">)</span>

                <span class="n">msg</span> <span class="o">=</span> <span class="n">ServiceBusMessage</span><span class="p">(</span><span class="n">body</span><span class="o">=</span><span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">message</span><span class="p">))</span>
                <span class="n">msg</span><span class="o">.</span><span class="n">session_id</span> <span class="o">=</span> <span class="n">session_id</span>
                <span class="n">sender</span><span class="o">.</span><span class="n">send_messages</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
                <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span>
                    <span class="sa">f</span><span class="s2">&quot;Successfully sent message to queue </span><span class="si">{</span><span class="n">queue_name</span><span class="si">}</span><span class="s2"> with session_id </span><span class="si">{</span><span class="n">session_id</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
                <span class="k">return</span>
            <span class="k">except</span> <span class="p">(</span><span class="n">ServiceBusError</span><span class="p">,</span> <span class="n">ServiceBusConnectionError</span><span class="p">,</span> <span class="n">ServiceRequestError</span><span class="p">,</span> <span class="ne">AttributeError</span><span class="p">)</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">attempt</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">MAX_RETRIES</span> <span class="o">-</span> <span class="mi">1</span><span class="p">:</span>
                    <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span>
                        <span class="sa">f</span><span class="s2">&quot;Failed to send message to queue </span><span class="si">{</span><span class="n">queue_name</span><span class="si">}</span><span class="s2"> after </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">MAX_RETRIES</span><span class="si">}</span><span class="s2"> attempts: </span><span class="si">{</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
                    <span class="k">raise</span> <span class="n">e</span>
                <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span>
                    <span class="sa">f</span><span class="s2">&quot;Attempt </span><span class="si">{</span><span class="n">attempt</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="si">}</span><span class="s2"> failed to send message to queue </span><span class="si">{</span><span class="n">queue_name</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
                <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">RETRY_DELAY</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_initialize_client</span><span class="p">()</span>
                <span class="k">if</span> <span class="n">queue_name</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">senders</span><span class="p">:</span>
                    <span class="k">try</span><span class="p">:</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">senders</span><span class="p">[</span><span class="n">queue_name</span><span class="p">]</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
                    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">close_error</span><span class="p">:</span>
                        <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Error closing sender during retry: </span><span class="si">{</span><span class="nb">str</span><span class="p">(</span><span class="n">close_error</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
                    <span class="k">del</span> <span class="bp">self</span><span class="o">.</span><span class="n">senders</span><span class="p">[</span><span class="n">queue_name</span><span class="p">]</span>

    <span class="k">def</span> <span class="nf">close</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Cierra la conexión con Azure Service Bus.&quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">queue_name</span><span class="p">,</span> <span class="n">sender</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">senders</span><span class="o">.</span><span class="n">items</span><span class="p">()):</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="n">sender</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
                    <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Successfully closed sender for queue: </span><span class="si">{</span><span class="n">queue_name</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
                <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
                    <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Error closing sender for queue </span><span class="si">{</span><span class="n">queue_name</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">client</span><span class="p">:</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">client</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
                    <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Successfully closed Service Bus client&quot;</span><span class="p">)</span>
                <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
                    <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Error closing client: </span><span class="si">{</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">senders</span><span class="o">.</span><span class="n">clear</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">client</span> <span class="o">=</span> <span class="kc">None</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Successfully closed all Service Bus connections&quot;</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Error during Service Bus cleanup: </span><span class="si">{</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="k">raise</span>
</code></pre></div>
        </details>



  <div class="doc doc-children">














  <div class="doc doc-object doc-method">



<h5 id="centraal_client_flow.connections.service_bus.ServiceBusClientSingleton.__new__" class="doc doc-heading">
<code class="highlight language-python"><span class="fm">__new__</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">connection_str</span><span class="p">)</span></code>

  <span class="doc doc-properties">
      <small class="doc doc-property doc-property-special"><code>special</code></small>
      <small class="doc doc-property doc-property-staticmethod"><code>staticmethod</code></small>
  </span>

<a href="#centraal_client_flow.connections.service_bus.ServiceBusClientSingleton.__new__" class="headerlink" title="Permanent link">&para;</a></h5>

    <div class="doc doc-contents ">

      <p>Crea una instancia única de ServiceBusClientSingleton si no existe.</p>

<p><strong>Parameters:</strong></p>
<table>
  <thead>
    <tr>
      <th>Name</th>
      <th>Type</th>
      <th>Description</th>
      <th>Default</th>
    </tr>
  </thead>
  <tbody>
      <tr>
        <td><code>connection_str</code></td>
        <td><code>str</code></td>
        <td><p>Cadena de conexión a Azure Service Bus.</p></td>
        <td><em>required</em></td>
      </tr>
  </tbody>
</table>
        <details class="quote">
          <summary>Source code in <code>centraal_client_flow/connections/service_bus.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="fm">__new__</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">connection_str</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Crea una instancia única de ServiceBusClientSingleton si no existe.</span>

<span class="sd">    Args:</span>
<span class="sd">        connection_str: Cadena de conexión a Azure Service Bus.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="bp">cls</span><span class="o">.</span><span class="n">_instance</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="bp">cls</span><span class="o">.</span><span class="n">_instance</span> <span class="o">=</span> <span class="nb">super</span><span class="p">(</span><span class="n">ServiceBusClientSingleton</span><span class="p">,</span> <span class="bp">cls</span><span class="p">)</span><span class="o">.</span><span class="fm">__new__</span><span class="p">(</span><span class="bp">cls</span><span class="p">)</span>
        <span class="bp">cls</span><span class="o">.</span><span class="n">_instance</span><span class="o">.</span><span class="n">connection_str</span> <span class="o">=</span> <span class="n">connection_str</span>
        <span class="bp">cls</span><span class="o">.</span><span class="n">_instance</span><span class="o">.</span><span class="n">_initialize_client</span><span class="p">()</span>

    <span class="k">return</span> <span class="bp">cls</span><span class="o">.</span><span class="n">_instance</span>
</code></pre></div>
        </details>
    </div>

  </div>




  <div class="doc doc-object doc-method">



<h5 id="centraal_client_flow.connections.service_bus.ServiceBusClientSingleton.close" class="doc doc-heading">
<code class="highlight language-python"><span class="n">close</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span></code>


<a href="#centraal_client_flow.connections.service_bus.ServiceBusClientSingleton.close" class="headerlink" title="Permanent link">&para;</a></h5>

    <div class="doc doc-contents ">

      <p>Cierra la conexión con Azure Service Bus.</p>

        <details class="quote">
          <summary>Source code in <code>centraal_client_flow/connections/service_bus.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="nf">close</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Cierra la conexión con Azure Service Bus.&quot;&quot;&quot;</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">queue_name</span><span class="p">,</span> <span class="n">sender</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">senders</span><span class="o">.</span><span class="n">items</span><span class="p">()):</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">sender</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
                <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Successfully closed sender for queue: </span><span class="si">{</span><span class="n">queue_name</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
                <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Error closing sender for queue </span><span class="si">{</span><span class="n">queue_name</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">client</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">client</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
                <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Successfully closed Service Bus client&quot;</span><span class="p">)</span>
            <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
                <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Error closing client: </span><span class="si">{</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">senders</span><span class="o">.</span><span class="n">clear</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">client</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Successfully closed all Service Bus connections&quot;</span><span class="p">)</span>
    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Error during Service Bus cleanup: </span><span class="si">{</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="k">raise</span>
</code></pre></div>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-method">



<h5 id="centraal_client_flow.connections.service_bus.ServiceBusClientSingleton.get_sender" class="doc doc-heading">
<code class="highlight language-python"><span class="n">get_sender</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">queue_name</span><span class="p">)</span></code>


<a href="#centraal_client_flow.connections.service_bus.ServiceBusClientSingleton.get_sender" class="headerlink" title="Permanent link">&para;</a></h5>

    <div class="doc doc-contents ">

      <p>Get or create a sender for the specified queue with retry logic.</p>

        <details class="quote">
          <summary>Source code in <code>centraal_client_flow/connections/service_bus.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="nf">get_sender</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">queue_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Get or create a sender for the specified queue with retry logic.&quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">queue_name</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">senders</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">attempt</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">MAX_RETRIES</span><span class="p">):</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">client</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_ensure_client_connection</span><span class="p">()</span>
                <span class="k">if</span> <span class="n">queue_name</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">senders</span><span class="p">:</span>
                    <span class="k">try</span><span class="p">:</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">senders</span><span class="p">[</span><span class="n">queue_name</span><span class="p">]</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
                    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
                        <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Error closing existing sender: </span><span class="si">{</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

                <span class="bp">self</span><span class="o">.</span><span class="n">senders</span><span class="p">[</span><span class="n">queue_name</span><span class="p">]</span> <span class="o">=</span> <span class="n">client</span><span class="o">.</span><span class="n">get_queue_sender</span><span class="p">(</span><span class="n">queue_name</span><span class="p">)</span>
                <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Successfully created sender for queue: </span><span class="si">{</span><span class="n">queue_name</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
                <span class="k">break</span>
            <span class="k">except</span> <span class="p">(</span><span class="n">ServiceBusError</span><span class="p">,</span> <span class="n">ServiceBusConnectionError</span><span class="p">,</span> <span class="ne">AttributeError</span><span class="p">)</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">attempt</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">MAX_RETRIES</span> <span class="o">-</span> <span class="mi">1</span><span class="p">:</span>
                    <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span>
                        <span class="sa">f</span><span class="s2">&quot;Failed to create sender for queue </span><span class="si">{</span><span class="n">queue_name</span><span class="si">}</span><span class="s2"> after </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">MAX_RETRIES</span><span class="si">}</span><span class="s2"> attempts: </span><span class="si">{</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
                    <span class="k">raise</span>
                <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span>
                    <span class="sa">f</span><span class="s2">&quot;Attempt </span><span class="si">{</span><span class="n">attempt</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="si">}</span><span class="s2"> failed to create sender for queue </span><span class="si">{</span><span class="n">queue_name</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
                <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">RETRY_DELAY</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_initialize_client</span><span class="p">()</span>  <span class="c1"># Try to reinitialize the client</span>

    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">senders</span><span class="p">[</span><span class="n">queue_name</span><span class="p">]</span>
</code></pre></div>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-method">



<h5 id="centraal_client_flow.connections.service_bus.ServiceBusClientSingleton.send_message_to_queue" class="doc doc-heading">
<code class="highlight language-python"><span class="n">send_message_to_queue</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">message</span><span class="p">,</span> <span class="n">session_id</span><span class="p">,</span> <span class="n">queue_name</span><span class="p">)</span></code>


<a href="#centraal_client_flow.connections.service_bus.ServiceBusClientSingleton.send_message_to_queue" class="headerlink" title="Permanent link">&para;</a></h5>

    <div class="doc doc-contents ">

      <p>Envía un mensaje a la cola de Service Bus especificada con retry logic.</p>

        <details class="quote">
          <summary>Source code in <code>centraal_client_flow/connections/service_bus.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="nf">send_message_to_queue</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">message</span><span class="p">:</span> <span class="nb">dict</span><span class="p">,</span> <span class="n">session_id</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">queue_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Envía un mensaje a la cola de Service Bus especificada con retry logic.&quot;&quot;&quot;</span>
    <span class="k">for</span> <span class="n">attempt</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">MAX_RETRIES</span><span class="p">):</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">sender</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_sender</span><span class="p">(</span><span class="n">queue_name</span><span class="p">)</span>

            <span class="n">msg</span> <span class="o">=</span> <span class="n">ServiceBusMessage</span><span class="p">(</span><span class="n">body</span><span class="o">=</span><span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">message</span><span class="p">))</span>
            <span class="n">msg</span><span class="o">.</span><span class="n">session_id</span> <span class="o">=</span> <span class="n">session_id</span>
            <span class="n">sender</span><span class="o">.</span><span class="n">send_messages</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;Successfully sent message to queue </span><span class="si">{</span><span class="n">queue_name</span><span class="si">}</span><span class="s2"> with session_id </span><span class="si">{</span><span class="n">session_id</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="k">return</span>
        <span class="k">except</span> <span class="p">(</span><span class="n">ServiceBusError</span><span class="p">,</span> <span class="n">ServiceBusConnectionError</span><span class="p">,</span> <span class="n">ServiceRequestError</span><span class="p">,</span> <span class="ne">AttributeError</span><span class="p">)</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">attempt</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">MAX_RETRIES</span> <span class="o">-</span> <span class="mi">1</span><span class="p">:</span>
                <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span>
                    <span class="sa">f</span><span class="s2">&quot;Failed to send message to queue </span><span class="si">{</span><span class="n">queue_name</span><span class="si">}</span><span class="s2"> after </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">MAX_RETRIES</span><span class="si">}</span><span class="s2"> attempts: </span><span class="si">{</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
                <span class="k">raise</span> <span class="n">e</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;Attempt </span><span class="si">{</span><span class="n">attempt</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="si">}</span><span class="s2"> failed to send message to queue </span><span class="si">{</span><span class="n">queue_name</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">RETRY_DELAY</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_initialize_client</span><span class="p">()</span>
            <span class="k">if</span> <span class="n">queue_name</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">senders</span><span class="p">:</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">senders</span><span class="p">[</span><span class="n">queue_name</span><span class="p">]</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
                <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">close_error</span><span class="p">:</span>
                    <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Error closing sender during retry: </span><span class="si">{</span><span class="nb">str</span><span class="p">(</span><span class="n">close_error</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
                <span class="k">del</span> <span class="bp">self</span><span class="o">.</span><span class="n">senders</span><span class="p">[</span><span class="n">queue_name</span><span class="p">]</span>
</code></pre></div>
        </details>
    </div>

  </div>





  </div>

    </div>

  </div>







  </div>

    </div>

  </div>




  </div>

    </div>

  </div>



  <div class="doc doc-object doc-module">



<h2 id="centraal_client_flow.events" class="doc doc-heading">
        <code>events</code>


  <span class="doc doc-properties">
      <small class="doc doc-property doc-property-special"><code>special</code></small>
  </span>

<a href="#centraal_client_flow.events" class="headerlink" title="Permanent link">&para;</a></h2>

    <div class="doc doc-contents ">

      <p>Codigo compartido por los submodulos.</p>



  <div class="doc doc-children">







  <div class="doc doc-object doc-class">



<h3 id="centraal_client_flow.events.EventProcessor" class="doc doc-heading">
        <code>
EventProcessor            (<a title="centraal_client_flow.helpers.logger.LoggerMixin" href="#centraal_client_flow.helpers.logger.LoggerMixin">LoggerMixin</a>, <span title="abc.ABC">ABC</span>)
        </code>



<a href="#centraal_client_flow.events.EventProcessor" class="headerlink" title="Permanent link">&para;</a></h3>

    <div class="doc doc-contents ">

      <p>Clase base abstracta para procesadores de eventos.</p>

        <details class="quote">
          <summary>Source code in <code>centraal_client_flow/events/__init__.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">class</span> <span class="nc">EventProcessor</span><span class="p">(</span><span class="n">LoggerMixin</span><span class="p">,</span> <span class="n">ABC</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Clase base abstracta para procesadores de eventos.&quot;&quot;&quot;</span>

    <span class="nd">@abstractmethod</span>
    <span class="k">def</span> <span class="nf">process_event</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">event</span><span class="p">:</span> <span class="n">BaseModel</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">EventoBase</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Procesa el evento recibido. y retorna el modelo de EventoBase</span>

<span class="sd">        Parameters:</span>
<span class="sd">            event: Objeto que corresponde a modelo pydantic.</span>
<span class="sd">        &quot;&quot;&quot;</span>
</code></pre></div>
        </details>



  <div class="doc doc-children">









  <div class="doc doc-object doc-method">



<h4 id="centraal_client_flow.events.EventProcessor.process_event" class="doc doc-heading">
<code class="highlight language-python"><span class="n">process_event</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">event</span><span class="p">)</span></code>


<a href="#centraal_client_flow.events.EventProcessor.process_event" class="headerlink" title="Permanent link">&para;</a></h4>

    <div class="doc doc-contents ">

      <p>Procesa el evento recibido. y retorna el modelo de EventoBase</p>

<p><strong>Parameters:</strong></p>
<table>
  <thead>
    <tr>
      <th>Name</th>
      <th>Type</th>
      <th>Description</th>
      <th>Default</th>
    </tr>
  </thead>
  <tbody>
      <tr>
        <td><code>event</code></td>
        <td><code>BaseModel</code></td>
        <td><p>Objeto que corresponde a modelo pydantic.</p></td>
        <td><em>required</em></td>
      </tr>
  </tbody>
</table>
        <details class="quote">
          <summary>Source code in <code>centraal_client_flow/events/__init__.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="nd">@abstractmethod</span>
<span class="k">def</span> <span class="nf">process_event</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">event</span><span class="p">:</span> <span class="n">BaseModel</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">EventoBase</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Procesa el evento recibido. y retorna el modelo de EventoBase</span>

<span class="sd">    Parameters:</span>
<span class="sd">        event: Objeto que corresponde a modelo pydantic.</span>
<span class="sd">    &quot;&quot;&quot;</span>
</code></pre></div>
        </details>
    </div>

  </div>





  </div>

    </div>

  </div>



  <div class="doc doc-object doc-class">



<h3 id="centraal_client_flow.events.PullProcessor" class="doc doc-heading">
        <code>
PullProcessor            (<a title="centraal_client_flow.helpers.logger.LoggerMixin" href="#centraal_client_flow.helpers.logger.LoggerMixin">LoggerMixin</a>, <span title="abc.ABC">ABC</span>)
        </code>



<a href="#centraal_client_flow.events.PullProcessor" class="headerlink" title="Permanent link">&para;</a></h3>

    <div class="doc doc-contents ">

      <p>Clase base abstracta para procesadores de eventos.</p>

        <details class="quote">
          <summary>Source code in <code>centraal_client_flow/events/__init__.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">class</span> <span class="nc">PullProcessor</span><span class="p">(</span><span class="n">LoggerMixin</span><span class="p">,</span> <span class="n">ABC</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Clase base abstracta para procesadores de eventos.&quot;&quot;&quot;</span>

    <span class="nd">@abstractmethod</span>
    <span class="k">def</span> <span class="nf">get_data</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="n">BaseModel</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Obtiene la informacion</span>
<span class="sd">        &quot;&quot;&quot;</span>

    <span class="nd">@abstractmethod</span>
    <span class="k">def</span> <span class="nf">process_event</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">event_data</span><span class="p">:</span> <span class="n">BaseModel</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">EventoBase</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Procesa el evento recibido. y retorna el modelo de EventoBase</span>

<span class="sd">        Parameters:</span>
<span class="sd">            event_data: Objeto que corresponde a modelo pydantic.</span>
<span class="sd">        &quot;&quot;&quot;</span>
</code></pre></div>
        </details>



  <div class="doc doc-children">









  <div class="doc doc-object doc-method">



<h4 id="centraal_client_flow.events.PullProcessor.get_data" class="doc doc-heading">
<code class="highlight language-python"><span class="n">get_data</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span></code>


<a href="#centraal_client_flow.events.PullProcessor.get_data" class="headerlink" title="Permanent link">&para;</a></h4>

    <div class="doc doc-contents ">

      <p>Obtiene la informacion</p>

        <details class="quote">
          <summary>Source code in <code>centraal_client_flow/events/__init__.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="nd">@abstractmethod</span>
<span class="k">def</span> <span class="nf">get_data</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="n">BaseModel</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Obtiene la informacion</span>
<span class="sd">    &quot;&quot;&quot;</span>
</code></pre></div>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-method">



<h4 id="centraal_client_flow.events.PullProcessor.process_event" class="doc doc-heading">
<code class="highlight language-python"><span class="n">process_event</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">event_data</span><span class="p">)</span></code>


<a href="#centraal_client_flow.events.PullProcessor.process_event" class="headerlink" title="Permanent link">&para;</a></h4>

    <div class="doc doc-contents ">

      <p>Procesa el evento recibido. y retorna el modelo de EventoBase</p>

<p><strong>Parameters:</strong></p>
<table>
  <thead>
    <tr>
      <th>Name</th>
      <th>Type</th>
      <th>Description</th>
      <th>Default</th>
    </tr>
  </thead>
  <tbody>
      <tr>
        <td><code>event_data</code></td>
        <td><code>BaseModel</code></td>
        <td><p>Objeto que corresponde a modelo pydantic.</p></td>
        <td><em>required</em></td>
      </tr>
  </tbody>
</table>
        <details class="quote">
          <summary>Source code in <code>centraal_client_flow/events/__init__.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="nd">@abstractmethod</span>
<span class="k">def</span> <span class="nf">process_event</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">event_data</span><span class="p">:</span> <span class="n">BaseModel</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">EventoBase</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Procesa el evento recibido. y retorna el modelo de EventoBase</span>

<span class="sd">    Parameters:</span>
<span class="sd">        event_data: Objeto que corresponde a modelo pydantic.</span>
<span class="sd">    &quot;&quot;&quot;</span>
</code></pre></div>
        </details>
    </div>

  </div>





  </div>

    </div>

  </div>






  <div class="doc doc-object doc-module">



<h3 id="centraal_client_flow.events.processor" class="doc doc-heading">
        <code>processor</code>



<a href="#centraal_client_flow.events.processor" class="headerlink" title="Permanent link">&para;</a></h3>

    <div class="doc doc-contents ">

      <p>Definicion de clase EventProcessor.</p>



  <div class="doc doc-children">







  <div class="doc doc-object doc-class">



<h4 id="centraal_client_flow.events.processor.EventProcessor" class="doc doc-heading">
        <code>
EventProcessor            (<span title="abc.ABC">ABC</span>)
        </code>



<a href="#centraal_client_flow.events.processor.EventProcessor" class="headerlink" title="Permanent link">&para;</a></h4>

    <div class="doc doc-contents ">

      <p>Clase para procesar eventos.
Esta clase estandariza la manera de procesar eventos basado en pydantic.</p>
<p>La clase sirve coom clase a heredar y debe implementar un metodo:
- process_event que general puede recibir cualquier tipo de dato pero debe devolver un evento validado (EventoBase) o una lista
de evento validados (List[EventoBase]).</p>
<p>el usuario solo tiene implemenetar ese metodo ya que luego la clase se encarga de:
1. controlar errores de validación, para hacer un logger adecuado
2. enviar el evento a la cola de eventos  de manera asincrona(usando batch si es necesario).</p>

        <details class="quote">
          <summary>Source code in <code>centraal_client_flow/events/processor.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">class</span> <span class="nc">EventProcessor</span><span class="p">(</span><span class="n">ABC</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Clase para procesar eventos.</span>
<span class="sd">    Esta clase estandariza la manera de procesar eventos basado en pydantic.</span>

<span class="sd">    La clase sirve coom clase a heredar y debe implementar un metodo:</span>
<span class="sd">    - process_event que general puede recibir cualquier tipo de dato pero debe devolver un evento validado (EventoBase) o una lista</span>
<span class="sd">    de evento validados (List[EventoBase]).</span>

<span class="sd">    el usuario solo tiene implemenetar ese metodo ya que luego la clase se encarga de:</span>
<span class="sd">    1. controlar errores de validación, para hacer un logger adecuado</span>
<span class="sd">    2. enviar el evento a la cola de eventos  de manera asincrona(usando batch si es necesario).</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="nd">@abstractmethod</span>
    <span class="k">def</span> <span class="nf">process_event</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">event</span><span class="p">:</span> <span class="n">Any</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Union</span><span class="p">[</span><span class="n">EventoBase</span><span class="p">,</span> <span class="n">List</span><span class="p">[</span><span class="n">EventoBase</span><span class="p">]]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Procesa un evento.&quot;&quot;&quot;</span>
        <span class="k">pass</span>

    <span class="k">def</span> <span class="nf">handle_event</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data</span><span class="p">:</span> <span class="n">Any</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">eventos</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">process_event</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">eventos</span><span class="p">,</span> <span class="nb">list</span><span class="p">):</span>
                <span class="n">eventos</span> <span class="o">=</span> <span class="p">[</span><span class="n">eventos</span><span class="p">]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">send_to_queue</span><span class="p">(</span><span class="n">eventos</span><span class="p">)</span>
        <span class="k">except</span> <span class="n">ValidationError</span> <span class="k">as</span> <span class="n">ve</span><span class="p">:</span>
            <span class="c1"># Aquí manejarías el logging adecuado de los errores de validación</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Error de validación: </span><span class="si">{</span><span class="n">ve</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="c1"># Manejo de otras excepciones</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Error al procesar el evento: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">send_to_queue</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">eventos</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">EventoBase</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Envia un evento a la cola de eventos.&quot;&quot;&quot;</span>
        <span class="k">pass</span>
</code></pre></div>
        </details>



  <div class="doc doc-children">










  <div class="doc doc-object doc-method">



<h5 id="centraal_client_flow.events.processor.EventProcessor.process_event" class="doc doc-heading">
<code class="highlight language-python"><span class="n">process_event</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">event</span><span class="p">)</span></code>


<a href="#centraal_client_flow.events.processor.EventProcessor.process_event" class="headerlink" title="Permanent link">&para;</a></h5>

    <div class="doc doc-contents ">

      <p>Procesa un evento.</p>

        <details class="quote">
          <summary>Source code in <code>centraal_client_flow/events/processor.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="nd">@abstractmethod</span>
<span class="k">def</span> <span class="nf">process_event</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">event</span><span class="p">:</span> <span class="n">Any</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Union</span><span class="p">[</span><span class="n">EventoBase</span><span class="p">,</span> <span class="n">List</span><span class="p">[</span><span class="n">EventoBase</span><span class="p">]]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Procesa un evento.&quot;&quot;&quot;</span>
    <span class="k">pass</span>
</code></pre></div>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-method">



<h5 id="centraal_client_flow.events.processor.EventProcessor.send_to_queue" class="doc doc-heading">
<code class="highlight language-python"><span class="n">send_to_queue</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">eventos</span><span class="p">)</span></code>


<a href="#centraal_client_flow.events.processor.EventProcessor.send_to_queue" class="headerlink" title="Permanent link">&para;</a></h5>

    <div class="doc doc-contents ">

      <p>Envia un evento a la cola de eventos.</p>

        <details class="quote">
          <summary>Source code in <code>centraal_client_flow/events/processor.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="nf">send_to_queue</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">eventos</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">EventoBase</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Envia un evento a la cola de eventos.&quot;&quot;&quot;</span>
    <span class="k">pass</span>
</code></pre></div>
        </details>
    </div>

  </div>





  </div>

    </div>

  </div>







  </div>

    </div>

  </div>



  <div class="doc doc-object doc-module">



<h3 id="centraal_client_flow.events.receiver" class="doc doc-heading">
        <code>receiver</code>



<a href="#centraal_client_flow.events.receiver" class="headerlink" title="Permanent link">&para;</a></h3>

    <div class="doc doc-contents ">

      <p>Módulo para recibir eventos desde una fuente externa y procesarlos a través de Azure Functions.</p>



  <div class="doc doc-children">







  <div class="doc doc-object doc-class">



<h4 id="centraal_client_flow.events.receiver.EventFunctionBuilder" class="doc doc-heading">
        <code>
EventFunctionBuilder        </code>



<a href="#centraal_client_flow.events.receiver.EventFunctionBuilder" class="headerlink" title="Permanent link">&para;</a></h4>

    <div class="doc doc-contents ">

      <p>Clase para construir y registrar funciones de Azure para recibir y procesar eventos.</p>
<p>Esta clase permite construir dinámicamente funciones de Azure que se desencadenan
por solicitudes HTTP POST para recibir y procesar eventos utilizando un modelo de evento
específico y un procesador de eventos.</p>

        <details class="quote">
          <summary>Source code in <code>centraal_client_flow/events/receiver.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">class</span> <span class="nc">EventFunctionBuilder</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Clase para construir y registrar funciones de Azure para recibir y procesar eventos.</span>

<span class="sd">    Esta clase permite construir dinámicamente funciones de Azure que se desencadenan</span>
<span class="sd">    por solicitudes HTTP POST para recibir y procesar eventos utilizando un modelo de evento</span>
<span class="sd">    específico y un procesador de eventos.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">function_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="n">event_source</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="n">queue_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="n">service_bus_client</span><span class="p">:</span> <span class="n">IServiceBusClient</span><span class="p">,</span>
        <span class="n">processor</span><span class="p">:</span> <span class="n">EventProcessor</span><span class="p">,</span>
        <span class="n">event_model</span><span class="p">:</span> <span class="nb">type</span><span class="p">[</span><span class="n">BaseModel</span><span class="p">],</span>
    <span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Inicializa un constructor de funciones para eventos con los parámetros especificados.</span>

<span class="sd">        Args:</span>
<span class="sd">            function_name: Nombre único de la función que se va a registrar.</span>
<span class="sd">            event_source: Nombre de la fuente del evento.</span>
<span class="sd">            queue_name: Nombre de la cola de Service Bus donde se enviarán los mensajes.</span>
<span class="sd">            service_bus_client: Cliente de Service Bus para enviar mensajes.</span>
<span class="sd">            processor: Procesador de eventos que hereda de EventProcessor.</span>
<span class="sd">            event_model: Modelo Pydantic para validar y parsear los eventos.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">function_name</span> <span class="o">=</span> <span class="n">function_name</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">event_source</span> <span class="o">=</span> <span class="n">event_source</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">queue_name</span> <span class="o">=</span> <span class="n">queue_name</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">service_bus_client</span> <span class="o">=</span> <span class="n">service_bus_client</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">processor</span> <span class="o">=</span> <span class="n">processor</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">event_model</span> <span class="o">=</span> <span class="n">event_model</span>

    <span class="k">def</span> <span class="nf">build_function</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Construye la función de Azure para recibir y procesar eventos.</span>

<span class="sd">        Returns:</span>
<span class="sd">            Una función que procesa solicitudes HTTP POST, valida los eventos recibidos</span>
<span class="sd">            y los envía a una cola de Service Bus.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">def</span> <span class="nf">receive_event</span><span class="p">(</span><span class="n">req</span><span class="p">:</span> <span class="n">HttpRequest</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">HttpResponse</span><span class="p">:</span>
            <span class="n">event_data</span> <span class="o">=</span> <span class="n">req</span><span class="o">.</span><span class="n">get_json</span><span class="p">()</span>
            <span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;validando informacion&quot;</span><span class="p">)</span>
            <span class="n">event</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">event_model</span><span class="o">.</span><span class="n">model_validate</span><span class="p">(</span><span class="n">event_data</span><span class="p">)</span>

            <span class="n">event_validado</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">processor</span><span class="o">.</span><span class="n">process_event</span><span class="p">(</span><span class="n">event</span><span class="p">)</span>
            <span class="n">data_validada</span> <span class="o">=</span> <span class="n">event_validado</span><span class="o">.</span><span class="n">model_dump</span><span class="p">(</span><span class="n">mode</span><span class="o">=</span><span class="s2">&quot;json&quot;</span><span class="p">,</span> <span class="n">exclude_none</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
            <span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;enviando informacion&quot;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">service_bus_client</span><span class="o">.</span><span class="n">send_message_to_queue</span><span class="p">(</span>
                <span class="n">data_validada</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">event_validado</span><span class="o">.</span><span class="n">id</span><span class="p">),</span> <span class="bp">self</span><span class="o">.</span><span class="n">queue_name</span>
            <span class="p">)</span>

            <span class="k">return</span> <span class="n">HttpResponse</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;Evento de </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">event_source</span><span class="si">}</span><span class="s2"> es procesado.&quot;</span><span class="p">,</span> <span class="n">status_code</span><span class="o">=</span><span class="mi">200</span>
            <span class="p">)</span>

        <span class="k">return</span> <span class="n">receive_event</span>

    <span class="k">def</span> <span class="nf">register_function</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">bp</span><span class="p">:</span> <span class="n">Blueprint</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Registra la función construida en el Blueprint proporcionado.</span>

<span class="sd">        Args:</span>
<span class="sd">            bp: Blueprint de Azure Functions donde se registrará la función.</span>

<span class="sd">        Returns:</span>
<span class="sd">            El Blueprint actualizado con la función registrada.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">receive_event</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">build_function</span><span class="p">()</span>

        <span class="n">bp</span><span class="o">.</span><span class="n">function_name</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">function_name</span><span class="p">)(</span>
            <span class="n">bp</span><span class="o">.</span><span class="n">route</span><span class="p">(</span><span class="n">methods</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;POST&quot;</span><span class="p">])(</span><span class="n">receive_event</span><span class="p">)</span>
        <span class="p">)</span>
        <span class="k">return</span> <span class="n">bp</span>
</code></pre></div>
        </details>



  <div class="doc doc-children">









  <div class="doc doc-object doc-method">



<h5 id="centraal_client_flow.events.receiver.EventFunctionBuilder.__init__" class="doc doc-heading">
<code class="highlight language-python"><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">function_name</span><span class="p">,</span> <span class="n">event_source</span><span class="p">,</span> <span class="n">queue_name</span><span class="p">,</span> <span class="n">service_bus_client</span><span class="p">,</span> <span class="n">processor</span><span class="p">,</span> <span class="n">event_model</span><span class="p">)</span></code>

  <span class="doc doc-properties">
      <small class="doc doc-property doc-property-special"><code>special</code></small>
  </span>

<a href="#centraal_client_flow.events.receiver.EventFunctionBuilder.__init__" class="headerlink" title="Permanent link">&para;</a></h5>

    <div class="doc doc-contents ">

      <p>Inicializa un constructor de funciones para eventos con los parámetros especificados.</p>

<p><strong>Parameters:</strong></p>
<table>
  <thead>
    <tr>
      <th>Name</th>
      <th>Type</th>
      <th>Description</th>
      <th>Default</th>
    </tr>
  </thead>
  <tbody>
      <tr>
        <td><code>function_name</code></td>
        <td><code>str</code></td>
        <td><p>Nombre único de la función que se va a registrar.</p></td>
        <td><em>required</em></td>
      </tr>
      <tr>
        <td><code>event_source</code></td>
        <td><code>str</code></td>
        <td><p>Nombre de la fuente del evento.</p></td>
        <td><em>required</em></td>
      </tr>
      <tr>
        <td><code>queue_name</code></td>
        <td><code>str</code></td>
        <td><p>Nombre de la cola de Service Bus donde se enviarán los mensajes.</p></td>
        <td><em>required</em></td>
      </tr>
      <tr>
        <td><code>service_bus_client</code></td>
        <td><code>IServiceBusClient</code></td>
        <td><p>Cliente de Service Bus para enviar mensajes.</p></td>
        <td><em>required</em></td>
      </tr>
      <tr>
        <td><code>processor</code></td>
        <td><code>EventProcessor</code></td>
        <td><p>Procesador de eventos que hereda de EventProcessor.</p></td>
        <td><em>required</em></td>
      </tr>
      <tr>
        <td><code>event_model</code></td>
        <td><code>type[pydantic.main.BaseModel]</code></td>
        <td><p>Modelo Pydantic para validar y parsear los eventos.</p></td>
        <td><em>required</em></td>
      </tr>
  </tbody>
</table>
        <details class="quote">
          <summary>Source code in <code>centraal_client_flow/events/receiver.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="n">function_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
    <span class="n">event_source</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
    <span class="n">queue_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
    <span class="n">service_bus_client</span><span class="p">:</span> <span class="n">IServiceBusClient</span><span class="p">,</span>
    <span class="n">processor</span><span class="p">:</span> <span class="n">EventProcessor</span><span class="p">,</span>
    <span class="n">event_model</span><span class="p">:</span> <span class="nb">type</span><span class="p">[</span><span class="n">BaseModel</span><span class="p">],</span>
<span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Inicializa un constructor de funciones para eventos con los parámetros especificados.</span>

<span class="sd">    Args:</span>
<span class="sd">        function_name: Nombre único de la función que se va a registrar.</span>
<span class="sd">        event_source: Nombre de la fuente del evento.</span>
<span class="sd">        queue_name: Nombre de la cola de Service Bus donde se enviarán los mensajes.</span>
<span class="sd">        service_bus_client: Cliente de Service Bus para enviar mensajes.</span>
<span class="sd">        processor: Procesador de eventos que hereda de EventProcessor.</span>
<span class="sd">        event_model: Modelo Pydantic para validar y parsear los eventos.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">function_name</span> <span class="o">=</span> <span class="n">function_name</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">event_source</span> <span class="o">=</span> <span class="n">event_source</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">queue_name</span> <span class="o">=</span> <span class="n">queue_name</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">service_bus_client</span> <span class="o">=</span> <span class="n">service_bus_client</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">processor</span> <span class="o">=</span> <span class="n">processor</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">event_model</span> <span class="o">=</span> <span class="n">event_model</span>
</code></pre></div>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-method">



<h5 id="centraal_client_flow.events.receiver.EventFunctionBuilder.build_function" class="doc doc-heading">
<code class="highlight language-python"><span class="n">build_function</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span></code>


<a href="#centraal_client_flow.events.receiver.EventFunctionBuilder.build_function" class="headerlink" title="Permanent link">&para;</a></h5>

    <div class="doc doc-contents ">

      <p>Construye la función de Azure para recibir y procesar eventos.</p>

<p><strong>Returns:</strong></p>
<table>
  <thead>
    <tr>
      <th>Type</th>
      <th>Description</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td></td>
      <td><p>Una función que procesa solicitudes HTTP POST, valida los eventos recibidos
y los envía a una cola de Service Bus.</p></td>
    </tr>
  </tbody>
</table>
        <details class="quote">
          <summary>Source code in <code>centraal_client_flow/events/receiver.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="nf">build_function</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Construye la función de Azure para recibir y procesar eventos.</span>

<span class="sd">    Returns:</span>
<span class="sd">        Una función que procesa solicitudes HTTP POST, valida los eventos recibidos</span>
<span class="sd">        y los envía a una cola de Service Bus.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="nf">receive_event</span><span class="p">(</span><span class="n">req</span><span class="p">:</span> <span class="n">HttpRequest</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">HttpResponse</span><span class="p">:</span>
        <span class="n">event_data</span> <span class="o">=</span> <span class="n">req</span><span class="o">.</span><span class="n">get_json</span><span class="p">()</span>
        <span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;validando informacion&quot;</span><span class="p">)</span>
        <span class="n">event</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">event_model</span><span class="o">.</span><span class="n">model_validate</span><span class="p">(</span><span class="n">event_data</span><span class="p">)</span>

        <span class="n">event_validado</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">processor</span><span class="o">.</span><span class="n">process_event</span><span class="p">(</span><span class="n">event</span><span class="p">)</span>
        <span class="n">data_validada</span> <span class="o">=</span> <span class="n">event_validado</span><span class="o">.</span><span class="n">model_dump</span><span class="p">(</span><span class="n">mode</span><span class="o">=</span><span class="s2">&quot;json&quot;</span><span class="p">,</span> <span class="n">exclude_none</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;enviando informacion&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">service_bus_client</span><span class="o">.</span><span class="n">send_message_to_queue</span><span class="p">(</span>
            <span class="n">data_validada</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">event_validado</span><span class="o">.</span><span class="n">id</span><span class="p">),</span> <span class="bp">self</span><span class="o">.</span><span class="n">queue_name</span>
        <span class="p">)</span>

        <span class="k">return</span> <span class="n">HttpResponse</span><span class="p">(</span>
            <span class="sa">f</span><span class="s2">&quot;Evento de </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">event_source</span><span class="si">}</span><span class="s2"> es procesado.&quot;</span><span class="p">,</span> <span class="n">status_code</span><span class="o">=</span><span class="mi">200</span>
        <span class="p">)</span>

    <span class="k">return</span> <span class="n">receive_event</span>
</code></pre></div>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-method">



<h5 id="centraal_client_flow.events.receiver.EventFunctionBuilder.register_function" class="doc doc-heading">
<code class="highlight language-python"><span class="n">register_function</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">bp</span><span class="p">)</span></code>


<a href="#centraal_client_flow.events.receiver.EventFunctionBuilder.register_function" class="headerlink" title="Permanent link">&para;</a></h5>

    <div class="doc doc-contents ">

      <p>Registra la función construida en el Blueprint proporcionado.</p>

<p><strong>Parameters:</strong></p>
<table>
  <thead>
    <tr>
      <th>Name</th>
      <th>Type</th>
      <th>Description</th>
      <th>Default</th>
    </tr>
  </thead>
  <tbody>
      <tr>
        <td><code>bp</code></td>
        <td><code>Blueprint</code></td>
        <td><p>Blueprint de Azure Functions donde se registrará la función.</p></td>
        <td><em>required</em></td>
      </tr>
  </tbody>
</table>
<p><strong>Returns:</strong></p>
<table>
  <thead>
    <tr>
      <th>Type</th>
      <th>Description</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td></td>
      <td><p>El Blueprint actualizado con la función registrada.</p></td>
    </tr>
  </tbody>
</table>
        <details class="quote">
          <summary>Source code in <code>centraal_client_flow/events/receiver.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="nf">register_function</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">bp</span><span class="p">:</span> <span class="n">Blueprint</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Registra la función construida en el Blueprint proporcionado.</span>

<span class="sd">    Args:</span>
<span class="sd">        bp: Blueprint de Azure Functions donde se registrará la función.</span>

<span class="sd">    Returns:</span>
<span class="sd">        El Blueprint actualizado con la función registrada.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">receive_event</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">build_function</span><span class="p">()</span>

    <span class="n">bp</span><span class="o">.</span><span class="n">function_name</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">function_name</span><span class="p">)(</span>
        <span class="n">bp</span><span class="o">.</span><span class="n">route</span><span class="p">(</span><span class="n">methods</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;POST&quot;</span><span class="p">])(</span><span class="n">receive_event</span><span class="p">)</span>
    <span class="p">)</span>
    <span class="k">return</span> <span class="n">bp</span>
</code></pre></div>
        </details>
    </div>

  </div>





  </div>

    </div>

  </div>



  <div class="doc doc-object doc-class">



<h4 id="centraal_client_flow.events.receiver.Recieve" class="doc doc-heading">
        <code>
Recieve        </code>



<a href="#centraal_client_flow.events.receiver.Recieve" class="headerlink" title="Permanent link">&para;</a></h4>

    <div class="doc doc-contents ">

      <p>Clase para manejar la recepción y procesamiento de eventos desde una fuente específica.</p>
<p>Esta clase define y registra reglas de procesamiento de eventos utilizando una fuente de eventos,
un modelo de evento, y un procesador de eventos.</p>

        <details class="quote">
          <summary>Source code in <code>centraal_client_flow/events/receiver.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">class</span> <span class="nc">Recieve</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Clase para manejar la recepción y procesamiento de eventos desde una fuente específica.</span>

<span class="sd">    Esta clase define y registra reglas de procesamiento de eventos utilizando una fuente de eventos,</span>
<span class="sd">    un modelo de evento, y un procesador de eventos.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">event_source</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="n">queue_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="n">service_bus_client</span><span class="p">:</span> <span class="n">IServiceBusClient</span><span class="p">,</span>
    <span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Inicializa una instancia de Receiver.</span>

<span class="sd">        Args:</span>
<span class="sd">            event_source: Nombre de la fuente del evento.</span>
<span class="sd">            queue_name: Nombre de la cola de Service Bus donde se enviarán los mensajes.</span>
<span class="sd">            service_bus_client: Cliente de Service Bus para enviar mensajes.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">function_name</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">event_source</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span><span class="si">}</span><span class="s2">_receive_event&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">event_source</span> <span class="o">=</span> <span class="n">event_source</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">queue_name</span> <span class="o">=</span> <span class="n">queue_name</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">service_bus_client</span> <span class="o">=</span> <span class="n">service_bus_client</span>

    <span class="k">def</span> <span class="nf">register_function</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">bp</span><span class="p">:</span> <span class="n">Blueprint</span><span class="p">,</span>
        <span class="n">processor</span><span class="p">:</span> <span class="n">EventProcessor</span><span class="p">,</span>
        <span class="n">event_model</span><span class="p">:</span> <span class="nb">type</span><span class="p">[</span><span class="n">BaseModel</span><span class="p">],</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Crea y registra una función para recibir y procesar eventos en el Blueprint proporcionado.</span>

<span class="sd">        Args:</span>
<span class="sd">            bp: Blueprint de Azure Functions donde se registrará la función.</span>
<span class="sd">            processor: Instancia de una clase que hereda de EventProcessor.</span>
<span class="sd">            event_model: Modelo Pydantic para validar y parsear el evento.</span>

<span class="sd">        Returns:</span>
<span class="sd">            El Blueprint actualizado con la función de procesamiento de eventos registrada.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">builder</span> <span class="o">=</span> <span class="n">EventFunctionBuilder</span><span class="p">(</span>
            <span class="n">function_name</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">function_name</span><span class="p">,</span>
            <span class="n">event_source</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">event_source</span><span class="p">,</span>
            <span class="n">queue_name</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">queue_name</span><span class="p">,</span>
            <span class="n">service_bus_client</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">service_bus_client</span><span class="p">,</span>
            <span class="n">processor</span><span class="o">=</span><span class="n">processor</span><span class="p">,</span>
            <span class="n">event_model</span><span class="o">=</span><span class="n">event_model</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="n">builder</span><span class="o">.</span><span class="n">register_function</span><span class="p">(</span><span class="n">bp</span><span class="p">)</span>
</code></pre></div>
        </details>



  <div class="doc doc-children">









  <div class="doc doc-object doc-method">



<h5 id="centraal_client_flow.events.receiver.Recieve.__init__" class="doc doc-heading">
<code class="highlight language-python"><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">event_source</span><span class="p">,</span> <span class="n">queue_name</span><span class="p">,</span> <span class="n">service_bus_client</span><span class="p">)</span></code>

  <span class="doc doc-properties">
      <small class="doc doc-property doc-property-special"><code>special</code></small>
  </span>

<a href="#centraal_client_flow.events.receiver.Recieve.__init__" class="headerlink" title="Permanent link">&para;</a></h5>

    <div class="doc doc-contents ">

      <p>Inicializa una instancia de Receiver.</p>

<p><strong>Parameters:</strong></p>
<table>
  <thead>
    <tr>
      <th>Name</th>
      <th>Type</th>
      <th>Description</th>
      <th>Default</th>
    </tr>
  </thead>
  <tbody>
      <tr>
        <td><code>event_source</code></td>
        <td><code>str</code></td>
        <td><p>Nombre de la fuente del evento.</p></td>
        <td><em>required</em></td>
      </tr>
      <tr>
        <td><code>queue_name</code></td>
        <td><code>str</code></td>
        <td><p>Nombre de la cola de Service Bus donde se enviarán los mensajes.</p></td>
        <td><em>required</em></td>
      </tr>
      <tr>
        <td><code>service_bus_client</code></td>
        <td><code>IServiceBusClient</code></td>
        <td><p>Cliente de Service Bus para enviar mensajes.</p></td>
        <td><em>required</em></td>
      </tr>
  </tbody>
</table>
        <details class="quote">
          <summary>Source code in <code>centraal_client_flow/events/receiver.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="n">event_source</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
    <span class="n">queue_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
    <span class="n">service_bus_client</span><span class="p">:</span> <span class="n">IServiceBusClient</span><span class="p">,</span>
<span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Inicializa una instancia de Receiver.</span>

<span class="sd">    Args:</span>
<span class="sd">        event_source: Nombre de la fuente del evento.</span>
<span class="sd">        queue_name: Nombre de la cola de Service Bus donde se enviarán los mensajes.</span>
<span class="sd">        service_bus_client: Cliente de Service Bus para enviar mensajes.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">function_name</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">event_source</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span><span class="si">}</span><span class="s2">_receive_event&quot;</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">event_source</span> <span class="o">=</span> <span class="n">event_source</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">queue_name</span> <span class="o">=</span> <span class="n">queue_name</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">service_bus_client</span> <span class="o">=</span> <span class="n">service_bus_client</span>
</code></pre></div>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-method">



<h5 id="centraal_client_flow.events.receiver.Recieve.register_function" class="doc doc-heading">
<code class="highlight language-python"><span class="n">register_function</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">bp</span><span class="p">,</span> <span class="n">processor</span><span class="p">,</span> <span class="n">event_model</span><span class="p">)</span></code>


<a href="#centraal_client_flow.events.receiver.Recieve.register_function" class="headerlink" title="Permanent link">&para;</a></h5>

    <div class="doc doc-contents ">

      <p>Crea y registra una función para recibir y procesar eventos en el Blueprint proporcionado.</p>

<p><strong>Parameters:</strong></p>
<table>
  <thead>
    <tr>
      <th>Name</th>
      <th>Type</th>
      <th>Description</th>
      <th>Default</th>
    </tr>
  </thead>
  <tbody>
      <tr>
        <td><code>bp</code></td>
        <td><code>Blueprint</code></td>
        <td><p>Blueprint de Azure Functions donde se registrará la función.</p></td>
        <td><em>required</em></td>
      </tr>
      <tr>
        <td><code>processor</code></td>
        <td><code>EventProcessor</code></td>
        <td><p>Instancia de una clase que hereda de EventProcessor.</p></td>
        <td><em>required</em></td>
      </tr>
      <tr>
        <td><code>event_model</code></td>
        <td><code>type[pydantic.main.BaseModel]</code></td>
        <td><p>Modelo Pydantic para validar y parsear el evento.</p></td>
        <td><em>required</em></td>
      </tr>
  </tbody>
</table>
<p><strong>Returns:</strong></p>
<table>
  <thead>
    <tr>
      <th>Type</th>
      <th>Description</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td><code>None</code></td>
      <td><p>El Blueprint actualizado con la función de procesamiento de eventos registrada.</p></td>
    </tr>
  </tbody>
</table>
        <details class="quote">
          <summary>Source code in <code>centraal_client_flow/events/receiver.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="nf">register_function</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="n">bp</span><span class="p">:</span> <span class="n">Blueprint</span><span class="p">,</span>
    <span class="n">processor</span><span class="p">:</span> <span class="n">EventProcessor</span><span class="p">,</span>
    <span class="n">event_model</span><span class="p">:</span> <span class="nb">type</span><span class="p">[</span><span class="n">BaseModel</span><span class="p">],</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Crea y registra una función para recibir y procesar eventos en el Blueprint proporcionado.</span>

<span class="sd">    Args:</span>
<span class="sd">        bp: Blueprint de Azure Functions donde se registrará la función.</span>
<span class="sd">        processor: Instancia de una clase que hereda de EventProcessor.</span>
<span class="sd">        event_model: Modelo Pydantic para validar y parsear el evento.</span>

<span class="sd">    Returns:</span>
<span class="sd">        El Blueprint actualizado con la función de procesamiento de eventos registrada.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">builder</span> <span class="o">=</span> <span class="n">EventFunctionBuilder</span><span class="p">(</span>
        <span class="n">function_name</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">function_name</span><span class="p">,</span>
        <span class="n">event_source</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">event_source</span><span class="p">,</span>
        <span class="n">queue_name</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">queue_name</span><span class="p">,</span>
        <span class="n">service_bus_client</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">service_bus_client</span><span class="p">,</span>
        <span class="n">processor</span><span class="o">=</span><span class="n">processor</span><span class="p">,</span>
        <span class="n">event_model</span><span class="o">=</span><span class="n">event_model</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">builder</span><span class="o">.</span><span class="n">register_function</span><span class="p">(</span><span class="n">bp</span><span class="p">)</span>
</code></pre></div>
        </details>
    </div>

  </div>





  </div>

    </div>

  </div>







  </div>

    </div>

  </div>



  <div class="doc doc-object doc-module">



<h3 id="centraal_client_flow.events.timer" class="doc doc-heading">
        <code>timer</code>



<a href="#centraal_client_flow.events.timer" class="headerlink" title="Permanent link">&para;</a></h3>

    <div class="doc doc-contents ">

      <p>Módulo para recibir eventos desde una fuente externa y procesarlos a través de Azure Functions.</p>



  <div class="doc doc-children">







  <div class="doc doc-object doc-class">



<h4 id="centraal_client_flow.events.timer.Pull" class="doc doc-heading">
        <code>
Pull        </code>



<a href="#centraal_client_flow.events.timer.Pull" class="headerlink" title="Permanent link">&para;</a></h4>

    <div class="doc doc-contents ">

      <p>Clase para manejar la ejecución de tareas programadas y el envío de datos a Service Bus.</p>
<p>Esta clase define y registra reglas de procesamiento de tareas utilizando un temporizador,
un procesador de eventos y un cliente de Service Bus.</p>

        <details class="quote">
          <summary>Source code in <code>centraal_client_flow/events/timer.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">class</span> <span class="nc">Pull</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Clase para manejar la ejecución de tareas programadas y el envío de datos a Service Bus.</span>

<span class="sd">    Esta clase define y registra reglas de procesamiento de tareas utilizando un temporizador,</span>
<span class="sd">    un procesador de eventos y un cliente de Service Bus.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">schedule</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="n">event_source</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="n">queue_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="n">service_bus_client</span><span class="p">:</span> <span class="n">IServiceBusClient</span><span class="p">,</span>
    <span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Inicializa una instancia de Pull.</span>

<span class="sd">        Args:</span>
<span class="sd">            schedule: Cadena que define el horario del temporizador (CRON).</span>
<span class="sd">            event_source: Nombre de la fuente del evento.</span>
<span class="sd">            queue_name: Nombre de la cola de Service Bus donde se enviarán los mensajes.</span>
<span class="sd">            service_bus_client: Cliente de Service Bus para enviar mensajes.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">function_name</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">event_source</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span><span class="si">}</span><span class="s2">_scheduled_event&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">schedule</span> <span class="o">=</span> <span class="n">schedule</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">event_source</span> <span class="o">=</span> <span class="n">event_source</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">queue_name</span> <span class="o">=</span> <span class="n">queue_name</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">service_bus_client</span> <span class="o">=</span> <span class="n">service_bus_client</span>

    <span class="k">def</span> <span class="nf">register_function</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">bp</span><span class="p">:</span> <span class="n">Blueprint</span><span class="p">,</span>
        <span class="n">processor</span><span class="p">:</span> <span class="n">PullProcessor</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Crea y registra una función programada para ejecutar tareas periódicamente en el Blueprint proporcionado.</span>

<span class="sd">        Args:</span>
<span class="sd">            bp: Blueprint de Azure Functions donde se registrará la función.</span>
<span class="sd">            processor: Instancia de una clase que hereda de PullProcessor.</span>

<span class="sd">        Returns:</span>
<span class="sd">            El Blueprint actualizado con la función programada registrada.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">builder</span> <span class="o">=</span> <span class="n">TimerFunctionBuilder</span><span class="p">(</span>
            <span class="n">function_name</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">function_name</span><span class="p">,</span>
            <span class="n">schedule</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">schedule</span><span class="p">,</span>
            <span class="n">event_source</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">event_source</span><span class="p">,</span>
            <span class="n">queue_name</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">queue_name</span><span class="p">,</span>
            <span class="n">service_bus_client</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">service_bus_client</span><span class="p">,</span>
            <span class="n">processor</span><span class="o">=</span><span class="n">processor</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="n">builder</span><span class="o">.</span><span class="n">register_function</span><span class="p">(</span><span class="n">bp</span><span class="p">)</span>
</code></pre></div>
        </details>



  <div class="doc doc-children">









  <div class="doc doc-object doc-method">



<h5 id="centraal_client_flow.events.timer.Pull.__init__" class="doc doc-heading">
<code class="highlight language-python"><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">schedule</span><span class="p">,</span> <span class="n">event_source</span><span class="p">,</span> <span class="n">queue_name</span><span class="p">,</span> <span class="n">service_bus_client</span><span class="p">)</span></code>

  <span class="doc doc-properties">
      <small class="doc doc-property doc-property-special"><code>special</code></small>
  </span>

<a href="#centraal_client_flow.events.timer.Pull.__init__" class="headerlink" title="Permanent link">&para;</a></h5>

    <div class="doc doc-contents ">

      <p>Inicializa una instancia de Pull.</p>

<p><strong>Parameters:</strong></p>
<table>
  <thead>
    <tr>
      <th>Name</th>
      <th>Type</th>
      <th>Description</th>
      <th>Default</th>
    </tr>
  </thead>
  <tbody>
      <tr>
        <td><code>schedule</code></td>
        <td><code>str</code></td>
        <td><p>Cadena que define el horario del temporizador (CRON).</p></td>
        <td><em>required</em></td>
      </tr>
      <tr>
        <td><code>event_source</code></td>
        <td><code>str</code></td>
        <td><p>Nombre de la fuente del evento.</p></td>
        <td><em>required</em></td>
      </tr>
      <tr>
        <td><code>queue_name</code></td>
        <td><code>str</code></td>
        <td><p>Nombre de la cola de Service Bus donde se enviarán los mensajes.</p></td>
        <td><em>required</em></td>
      </tr>
      <tr>
        <td><code>service_bus_client</code></td>
        <td><code>IServiceBusClient</code></td>
        <td><p>Cliente de Service Bus para enviar mensajes.</p></td>
        <td><em>required</em></td>
      </tr>
  </tbody>
</table>
        <details class="quote">
          <summary>Source code in <code>centraal_client_flow/events/timer.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="n">schedule</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
    <span class="n">event_source</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
    <span class="n">queue_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
    <span class="n">service_bus_client</span><span class="p">:</span> <span class="n">IServiceBusClient</span><span class="p">,</span>
<span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Inicializa una instancia de Pull.</span>

<span class="sd">    Args:</span>
<span class="sd">        schedule: Cadena que define el horario del temporizador (CRON).</span>
<span class="sd">        event_source: Nombre de la fuente del evento.</span>
<span class="sd">        queue_name: Nombre de la cola de Service Bus donde se enviarán los mensajes.</span>
<span class="sd">        service_bus_client: Cliente de Service Bus para enviar mensajes.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">function_name</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">event_source</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span><span class="si">}</span><span class="s2">_scheduled_event&quot;</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">schedule</span> <span class="o">=</span> <span class="n">schedule</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">event_source</span> <span class="o">=</span> <span class="n">event_source</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">queue_name</span> <span class="o">=</span> <span class="n">queue_name</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">service_bus_client</span> <span class="o">=</span> <span class="n">service_bus_client</span>
</code></pre></div>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-method">



<h5 id="centraal_client_flow.events.timer.Pull.register_function" class="doc doc-heading">
<code class="highlight language-python"><span class="n">register_function</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">bp</span><span class="p">,</span> <span class="n">processor</span><span class="p">)</span></code>


<a href="#centraal_client_flow.events.timer.Pull.register_function" class="headerlink" title="Permanent link">&para;</a></h5>

    <div class="doc doc-contents ">

      <p>Crea y registra una función programada para ejecutar tareas periódicamente en el Blueprint proporcionado.</p>

<p><strong>Parameters:</strong></p>
<table>
  <thead>
    <tr>
      <th>Name</th>
      <th>Type</th>
      <th>Description</th>
      <th>Default</th>
    </tr>
  </thead>
  <tbody>
      <tr>
        <td><code>bp</code></td>
        <td><code>Blueprint</code></td>
        <td><p>Blueprint de Azure Functions donde se registrará la función.</p></td>
        <td><em>required</em></td>
      </tr>
      <tr>
        <td><code>processor</code></td>
        <td><code>PullProcessor</code></td>
        <td><p>Instancia de una clase que hereda de PullProcessor.</p></td>
        <td><em>required</em></td>
      </tr>
  </tbody>
</table>
<p><strong>Returns:</strong></p>
<table>
  <thead>
    <tr>
      <th>Type</th>
      <th>Description</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td><code>None</code></td>
      <td><p>El Blueprint actualizado con la función programada registrada.</p></td>
    </tr>
  </tbody>
</table>
        <details class="quote">
          <summary>Source code in <code>centraal_client_flow/events/timer.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="nf">register_function</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="n">bp</span><span class="p">:</span> <span class="n">Blueprint</span><span class="p">,</span>
    <span class="n">processor</span><span class="p">:</span> <span class="n">PullProcessor</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Crea y registra una función programada para ejecutar tareas periódicamente en el Blueprint proporcionado.</span>

<span class="sd">    Args:</span>
<span class="sd">        bp: Blueprint de Azure Functions donde se registrará la función.</span>
<span class="sd">        processor: Instancia de una clase que hereda de PullProcessor.</span>

<span class="sd">    Returns:</span>
<span class="sd">        El Blueprint actualizado con la función programada registrada.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">builder</span> <span class="o">=</span> <span class="n">TimerFunctionBuilder</span><span class="p">(</span>
        <span class="n">function_name</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">function_name</span><span class="p">,</span>
        <span class="n">schedule</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">schedule</span><span class="p">,</span>
        <span class="n">event_source</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">event_source</span><span class="p">,</span>
        <span class="n">queue_name</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">queue_name</span><span class="p">,</span>
        <span class="n">service_bus_client</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">service_bus_client</span><span class="p">,</span>
        <span class="n">processor</span><span class="o">=</span><span class="n">processor</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">builder</span><span class="o">.</span><span class="n">register_function</span><span class="p">(</span><span class="n">bp</span><span class="p">)</span>
</code></pre></div>
        </details>
    </div>

  </div>





  </div>

    </div>

  </div>



  <div class="doc doc-object doc-class">



<h4 id="centraal_client_flow.events.timer.TimerFunctionBuilder" class="doc doc-heading">
        <code>
TimerFunctionBuilder        </code>



<a href="#centraal_client_flow.events.timer.TimerFunctionBuilder" class="headerlink" title="Permanent link">&para;</a></h4>

    <div class="doc doc-contents ">

      <p>Clase para construir y registrar funciones de Azure programadas.</p>
<p>Esta clase permite construir dinámicamente funciones de Azure que se desencadenan
por un temporizador, procesan eventos y los envían a un Service Bus.</p>

        <details class="quote">
          <summary>Source code in <code>centraal_client_flow/events/timer.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">class</span> <span class="nc">TimerFunctionBuilder</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Clase para construir y registrar funciones de Azure programadas.</span>

<span class="sd">    Esta clase permite construir dinámicamente funciones de Azure que se desencadenan</span>
<span class="sd">    por un temporizador, procesan eventos y los envían a un Service Bus.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">function_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="n">schedule</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="n">event_source</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="n">queue_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="n">service_bus_client</span><span class="p">:</span> <span class="n">IServiceBusClient</span><span class="p">,</span>
        <span class="n">processor</span><span class="p">:</span> <span class="n">PullProcessor</span><span class="p">,</span>
    <span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Inicializa un constructor de funciones programadas con los parámetros especificados.</span>

<span class="sd">        Args:</span>
<span class="sd">            function_name: Nombre único de la función que se va a registrar.</span>
<span class="sd">            schedule: Cadena que define el horario del temporizador (CRON).</span>
<span class="sd">            event_source: Nombre de la fuente del evento.</span>
<span class="sd">            queue_name: Nombre de la cola de Service Bus donde se enviarán los mensajes.</span>
<span class="sd">            service_bus_client: Cliente de Service Bus para enviar mensajes.</span>
<span class="sd">            processor: Procesador de eventos que hereda de PullProcessor.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">function_name</span> <span class="o">=</span> <span class="n">function_name</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">schedule</span> <span class="o">=</span> <span class="n">schedule</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">event_source</span> <span class="o">=</span> <span class="n">event_source</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">queue_name</span> <span class="o">=</span> <span class="n">queue_name</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">service_bus_client</span> <span class="o">=</span> <span class="n">service_bus_client</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">processor</span> <span class="o">=</span> <span class="n">processor</span>

    <span class="k">def</span> <span class="nf">build_function</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Construye la función de Azure programada para ejecutar tareas periódicamente.</span>

<span class="sd">        Returns:</span>
<span class="sd">            Una función que se ejecuta en base a un temporizador, procesa datos y los envía a una cola de Service Bus.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">def</span> <span class="nf">timer_function</span><span class="p">(</span><span class="n">mytimer</span><span class="p">:</span> <span class="n">TimerRequest</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">mytimer</span><span class="o">.</span><span class="n">past_due</span><span class="p">:</span>
                <span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;The timer is past due!&quot;</span><span class="p">)</span>

            <span class="n">event_data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">processor</span><span class="o">.</span><span class="n">get_data</span><span class="p">()</span>

            <span class="k">for</span> <span class="n">event_in_data</span> <span class="ow">in</span> <span class="n">event_data</span><span class="p">:</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="n">event_validado</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">processor</span><span class="o">.</span><span class="n">process_event</span><span class="p">(</span><span class="n">event_in_data</span><span class="p">)</span>
                    <span class="n">data_validada</span> <span class="o">=</span> <span class="n">event_validado</span><span class="o">.</span><span class="n">model_dump</span><span class="p">(</span>
                        <span class="n">mode</span><span class="o">=</span><span class="s2">&quot;json&quot;</span><span class="p">,</span> <span class="n">exclude_none</span><span class="o">=</span><span class="kc">True</span>
                    <span class="p">)</span>

                    <span class="bp">self</span><span class="o">.</span><span class="n">service_bus_client</span><span class="o">.</span><span class="n">send_message_to_queue</span><span class="p">(</span>
                        <span class="n">data_validada</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">event_validado</span><span class="o">.</span><span class="n">id</span><span class="p">),</span> <span class="bp">self</span><span class="o">.</span><span class="n">queue_name</span>
                    <span class="p">)</span>
                <span class="k">except</span> <span class="n">ValidationError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
                    <span class="n">logging</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s2">&quot;Error en </span><span class="si">%s</span><span class="s2">, excepción:</span><span class="se">\n</span><span class="si">%s</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">event_in_data</span><span class="p">,</span> <span class="n">e</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">timer_function</span>

    <span class="k">def</span> <span class="nf">register_function</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">bp</span><span class="p">:</span> <span class="n">Blueprint</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Registra la función construida en el Blueprint proporcionado.</span>

<span class="sd">        Args:</span>
<span class="sd">            bp: Blueprint de Azure Functions donde se registrará la función.</span>

<span class="sd">        Returns:</span>
<span class="sd">            El Blueprint actualizado con la función registrada.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">timer_function</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">build_function</span><span class="p">()</span>

        <span class="n">bp</span><span class="o">.</span><span class="n">function_name</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">function_name</span><span class="p">)(</span>
            <span class="n">bp</span><span class="o">.</span><span class="n">schedule</span><span class="p">(</span>
                <span class="n">schedule</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">schedule</span><span class="p">,</span> <span class="n">arg_name</span><span class="o">=</span><span class="s2">&quot;mytimer&quot;</span><span class="p">,</span> <span class="n">run_on_startup</span><span class="o">=</span><span class="kc">False</span>
            <span class="p">)(</span><span class="n">timer_function</span><span class="p">)</span>
        <span class="p">)</span>
        <span class="k">return</span> <span class="n">bp</span>
</code></pre></div>
        </details>



  <div class="doc doc-children">









  <div class="doc doc-object doc-method">



<h5 id="centraal_client_flow.events.timer.TimerFunctionBuilder.__init__" class="doc doc-heading">
<code class="highlight language-python"><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">function_name</span><span class="p">,</span> <span class="n">schedule</span><span class="p">,</span> <span class="n">event_source</span><span class="p">,</span> <span class="n">queue_name</span><span class="p">,</span> <span class="n">service_bus_client</span><span class="p">,</span> <span class="n">processor</span><span class="p">)</span></code>

  <span class="doc doc-properties">
      <small class="doc doc-property doc-property-special"><code>special</code></small>
  </span>

<a href="#centraal_client_flow.events.timer.TimerFunctionBuilder.__init__" class="headerlink" title="Permanent link">&para;</a></h5>

    <div class="doc doc-contents ">

      <p>Inicializa un constructor de funciones programadas con los parámetros especificados.</p>

<p><strong>Parameters:</strong></p>
<table>
  <thead>
    <tr>
      <th>Name</th>
      <th>Type</th>
      <th>Description</th>
      <th>Default</th>
    </tr>
  </thead>
  <tbody>
      <tr>
        <td><code>function_name</code></td>
        <td><code>str</code></td>
        <td><p>Nombre único de la función que se va a registrar.</p></td>
        <td><em>required</em></td>
      </tr>
      <tr>
        <td><code>schedule</code></td>
        <td><code>str</code></td>
        <td><p>Cadena que define el horario del temporizador (CRON).</p></td>
        <td><em>required</em></td>
      </tr>
      <tr>
        <td><code>event_source</code></td>
        <td><code>str</code></td>
        <td><p>Nombre de la fuente del evento.</p></td>
        <td><em>required</em></td>
      </tr>
      <tr>
        <td><code>queue_name</code></td>
        <td><code>str</code></td>
        <td><p>Nombre de la cola de Service Bus donde se enviarán los mensajes.</p></td>
        <td><em>required</em></td>
      </tr>
      <tr>
        <td><code>service_bus_client</code></td>
        <td><code>IServiceBusClient</code></td>
        <td><p>Cliente de Service Bus para enviar mensajes.</p></td>
        <td><em>required</em></td>
      </tr>
      <tr>
        <td><code>processor</code></td>
        <td><code>PullProcessor</code></td>
        <td><p>Procesador de eventos que hereda de PullProcessor.</p></td>
        <td><em>required</em></td>
      </tr>
  </tbody>
</table>
        <details class="quote">
          <summary>Source code in <code>centraal_client_flow/events/timer.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="n">function_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
    <span class="n">schedule</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
    <span class="n">event_source</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
    <span class="n">queue_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
    <span class="n">service_bus_client</span><span class="p">:</span> <span class="n">IServiceBusClient</span><span class="p">,</span>
    <span class="n">processor</span><span class="p">:</span> <span class="n">PullProcessor</span><span class="p">,</span>
<span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Inicializa un constructor de funciones programadas con los parámetros especificados.</span>

<span class="sd">    Args:</span>
<span class="sd">        function_name: Nombre único de la función que se va a registrar.</span>
<span class="sd">        schedule: Cadena que define el horario del temporizador (CRON).</span>
<span class="sd">        event_source: Nombre de la fuente del evento.</span>
<span class="sd">        queue_name: Nombre de la cola de Service Bus donde se enviarán los mensajes.</span>
<span class="sd">        service_bus_client: Cliente de Service Bus para enviar mensajes.</span>
<span class="sd">        processor: Procesador de eventos que hereda de PullProcessor.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">function_name</span> <span class="o">=</span> <span class="n">function_name</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">schedule</span> <span class="o">=</span> <span class="n">schedule</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">event_source</span> <span class="o">=</span> <span class="n">event_source</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">queue_name</span> <span class="o">=</span> <span class="n">queue_name</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">service_bus_client</span> <span class="o">=</span> <span class="n">service_bus_client</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">processor</span> <span class="o">=</span> <span class="n">processor</span>
</code></pre></div>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-method">



<h5 id="centraal_client_flow.events.timer.TimerFunctionBuilder.build_function" class="doc doc-heading">
<code class="highlight language-python"><span class="n">build_function</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span></code>


<a href="#centraal_client_flow.events.timer.TimerFunctionBuilder.build_function" class="headerlink" title="Permanent link">&para;</a></h5>

    <div class="doc doc-contents ">

      <p>Construye la función de Azure programada para ejecutar tareas periódicamente.</p>

<p><strong>Returns:</strong></p>
<table>
  <thead>
    <tr>
      <th>Type</th>
      <th>Description</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td></td>
      <td><p>Una función que se ejecuta en base a un temporizador, procesa datos y los envía a una cola de Service Bus.</p></td>
    </tr>
  </tbody>
</table>
        <details class="quote">
          <summary>Source code in <code>centraal_client_flow/events/timer.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="nf">build_function</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Construye la función de Azure programada para ejecutar tareas periódicamente.</span>

<span class="sd">    Returns:</span>
<span class="sd">        Una función que se ejecuta en base a un temporizador, procesa datos y los envía a una cola de Service Bus.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="nf">timer_function</span><span class="p">(</span><span class="n">mytimer</span><span class="p">:</span> <span class="n">TimerRequest</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">mytimer</span><span class="o">.</span><span class="n">past_due</span><span class="p">:</span>
            <span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;The timer is past due!&quot;</span><span class="p">)</span>

        <span class="n">event_data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">processor</span><span class="o">.</span><span class="n">get_data</span><span class="p">()</span>

        <span class="k">for</span> <span class="n">event_in_data</span> <span class="ow">in</span> <span class="n">event_data</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">event_validado</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">processor</span><span class="o">.</span><span class="n">process_event</span><span class="p">(</span><span class="n">event_in_data</span><span class="p">)</span>
                <span class="n">data_validada</span> <span class="o">=</span> <span class="n">event_validado</span><span class="o">.</span><span class="n">model_dump</span><span class="p">(</span>
                    <span class="n">mode</span><span class="o">=</span><span class="s2">&quot;json&quot;</span><span class="p">,</span> <span class="n">exclude_none</span><span class="o">=</span><span class="kc">True</span>
                <span class="p">)</span>

                <span class="bp">self</span><span class="o">.</span><span class="n">service_bus_client</span><span class="o">.</span><span class="n">send_message_to_queue</span><span class="p">(</span>
                    <span class="n">data_validada</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">event_validado</span><span class="o">.</span><span class="n">id</span><span class="p">),</span> <span class="bp">self</span><span class="o">.</span><span class="n">queue_name</span>
                <span class="p">)</span>
            <span class="k">except</span> <span class="n">ValidationError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
                <span class="n">logging</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s2">&quot;Error en </span><span class="si">%s</span><span class="s2">, excepción:</span><span class="se">\n</span><span class="si">%s</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">event_in_data</span><span class="p">,</span> <span class="n">e</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">timer_function</span>
</code></pre></div>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-method">



<h5 id="centraal_client_flow.events.timer.TimerFunctionBuilder.register_function" class="doc doc-heading">
<code class="highlight language-python"><span class="n">register_function</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">bp</span><span class="p">)</span></code>


<a href="#centraal_client_flow.events.timer.TimerFunctionBuilder.register_function" class="headerlink" title="Permanent link">&para;</a></h5>

    <div class="doc doc-contents ">

      <p>Registra la función construida en el Blueprint proporcionado.</p>

<p><strong>Parameters:</strong></p>
<table>
  <thead>
    <tr>
      <th>Name</th>
      <th>Type</th>
      <th>Description</th>
      <th>Default</th>
    </tr>
  </thead>
  <tbody>
      <tr>
        <td><code>bp</code></td>
        <td><code>Blueprint</code></td>
        <td><p>Blueprint de Azure Functions donde se registrará la función.</p></td>
        <td><em>required</em></td>
      </tr>
  </tbody>
</table>
<p><strong>Returns:</strong></p>
<table>
  <thead>
    <tr>
      <th>Type</th>
      <th>Description</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td></td>
      <td><p>El Blueprint actualizado con la función registrada.</p></td>
    </tr>
  </tbody>
</table>
        <details class="quote">
          <summary>Source code in <code>centraal_client_flow/events/timer.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="nf">register_function</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">bp</span><span class="p">:</span> <span class="n">Blueprint</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Registra la función construida en el Blueprint proporcionado.</span>

<span class="sd">    Args:</span>
<span class="sd">        bp: Blueprint de Azure Functions donde se registrará la función.</span>

<span class="sd">    Returns:</span>
<span class="sd">        El Blueprint actualizado con la función registrada.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">timer_function</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">build_function</span><span class="p">()</span>

    <span class="n">bp</span><span class="o">.</span><span class="n">function_name</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">function_name</span><span class="p">)(</span>
        <span class="n">bp</span><span class="o">.</span><span class="n">schedule</span><span class="p">(</span>
            <span class="n">schedule</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">schedule</span><span class="p">,</span> <span class="n">arg_name</span><span class="o">=</span><span class="s2">&quot;mytimer&quot;</span><span class="p">,</span> <span class="n">run_on_startup</span><span class="o">=</span><span class="kc">False</span>
        <span class="p">)(</span><span class="n">timer_function</span><span class="p">)</span>
    <span class="p">)</span>
    <span class="k">return</span> <span class="n">bp</span>
</code></pre></div>
        </details>
    </div>

  </div>





  </div>

    </div>

  </div>







  </div>

    </div>

  </div>




  </div>

    </div>

  </div>



  <div class="doc doc-object doc-module">



<h2 id="centraal_client_flow.helpers" class="doc doc-heading">
        <code>helpers</code>


  <span class="doc doc-properties">
      <small class="doc doc-property doc-property-special"><code>special</code></small>
  </span>

<a href="#centraal_client_flow.helpers" class="headerlink" title="Permanent link">&para;</a></h2>

    <div class="doc doc-contents ">




  <div class="doc doc-children">










  <div class="doc doc-object doc-module">



<h3 id="centraal_client_flow.helpers.cosmos" class="doc doc-heading">
        <code>cosmos</code>



<a href="#centraal_client_flow.helpers.cosmos" class="headerlink" title="Permanent link">&para;</a></h3>

    <div class="doc doc-contents ">

      <p>Helpers para interactuar con cosmos.</p>



  <div class="doc doc-children">








  <div class="doc doc-object doc-function">



<h4 id="centraal_client_flow.helpers.cosmos.save_model_to_cosmos" class="doc doc-heading">
<code class="highlight language-python"><span class="n">save_model_to_cosmos</span><span class="p">(</span><span class="n">cosmos_db</span><span class="p">,</span> <span class="n">container_name</span><span class="p">,</span> <span class="n">model_instance</span><span class="p">)</span></code>


<a href="#centraal_client_flow.helpers.cosmos.save_model_to_cosmos" class="headerlink" title="Permanent link">&para;</a></h4>

    <div class="doc doc-contents ">

      <p>Saves a Pydantic model instance to the specified Cosmos DB container.</p>

        <details class="quote">
          <summary>Source code in <code>centraal_client_flow/helpers/cosmos.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="nf">save_model_to_cosmos</span><span class="p">(</span>
    <span class="n">cosmos_db</span><span class="p">:</span> <span class="n">CosmosDBSingleton</span><span class="p">,</span> <span class="n">container_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">model_instance</span><span class="p">:</span> <span class="n">Type</span><span class="p">[</span><span class="n">BaseModel</span><span class="p">]</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Saves a Pydantic model instance to the specified Cosmos DB container.&quot;&quot;&quot;</span>
    <span class="n">container_client</span> <span class="o">=</span> <span class="n">cosmos_db</span><span class="o">.</span><span class="n">get_container_client</span><span class="p">(</span><span class="n">container_name</span><span class="p">)</span>
    <span class="n">item_written</span> <span class="o">=</span> <span class="n">write_model_to_cosmos</span><span class="p">(</span><span class="n">container_client</span><span class="p">,</span> <span class="n">model_instance</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">item_written</span>
</code></pre></div>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-function">



<h4 id="centraal_client_flow.helpers.cosmos.write_model_to_cosmos" class="doc doc-heading">
<code class="highlight language-python"><span class="n">write_model_to_cosmos</span><span class="p">(</span><span class="n">container_client</span><span class="p">,</span> <span class="n">model_instance</span><span class="p">)</span></code>


<a href="#centraal_client_flow.helpers.cosmos.write_model_to_cosmos" class="headerlink" title="Permanent link">&para;</a></h4>

    <div class="doc doc-contents ">

      <p>Writes a Pydantic model instance to the specified Cosmos DB container.</p>

        <details class="quote">
          <summary>Source code in <code>centraal_client_flow/helpers/cosmos.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="nf">write_model_to_cosmos</span><span class="p">(</span>
    <span class="n">container_client</span><span class="p">:</span> <span class="n">ContainerProxy</span><span class="p">,</span> <span class="n">model_instance</span><span class="p">:</span> <span class="n">Type</span><span class="p">[</span><span class="n">BaseModel</span><span class="p">]</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Writes a Pydantic model instance to the specified Cosmos DB container.&quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="n">container_client</span><span class="o">.</span><span class="n">upsert_item</span><span class="p">(</span>
        <span class="n">body</span><span class="o">=</span><span class="n">model_instance</span><span class="o">.</span><span class="n">model_dump</span><span class="p">(</span><span class="n">mode</span><span class="o">=</span><span class="s2">&quot;json&quot;</span><span class="p">,</span> <span class="n">exclude_none</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="p">)</span>
</code></pre></div>
        </details>
    </div>

  </div>






  </div>

    </div>

  </div>



  <div class="doc doc-object doc-module">



<h3 id="centraal_client_flow.helpers.logger" class="doc doc-heading">
        <code>logger</code>



<a href="#centraal_client_flow.helpers.logger" class="headerlink" title="Permanent link">&para;</a></h3>

    <div class="doc doc-contents ">

      <p>Utilidades para logger.</p>



  <div class="doc doc-children">







  <div class="doc doc-object doc-class">



<h4 id="centraal_client_flow.helpers.logger.LoggerMixin" class="doc doc-heading">
        <code>
LoggerMixin        </code>



<a href="#centraal_client_flow.helpers.logger.LoggerMixin" class="headerlink" title="Permanent link">&para;</a></h4>

    <div class="doc doc-contents ">

      <p>Clase base abstracta para proveer funcionalidad de logging.</p>

        <details class="quote">
          <summary>Source code in <code>centraal_client_flow/helpers/logger.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">class</span> <span class="nc">LoggerMixin</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Clase base abstracta para proveer funcionalidad de logging.&quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">logger</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">logging</span><span class="o">.</span><span class="n">Logger</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Inicializa la clase base con un logger opcional.</span>

<span class="sd">        Parameters:</span>
<span class="sd">            logger: Instancia de logging.Logger para registrar eventos.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">logger</span> <span class="o">=</span> <span class="n">logger</span> <span class="ow">or</span> <span class="n">logging</span><span class="o">.</span><span class="n">getLogger</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="vm">__name__</span><span class="p">)</span>
</code></pre></div>
        </details>



  <div class="doc doc-children">









  <div class="doc doc-object doc-method">



<h5 id="centraal_client_flow.helpers.logger.LoggerMixin.__init__" class="doc doc-heading">
<code class="highlight language-python"><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">logger</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>

  <span class="doc doc-properties">
      <small class="doc doc-property doc-property-special"><code>special</code></small>
  </span>

<a href="#centraal_client_flow.helpers.logger.LoggerMixin.__init__" class="headerlink" title="Permanent link">&para;</a></h5>

    <div class="doc doc-contents ">

      <p>Inicializa la clase base con un logger opcional.</p>

<p><strong>Parameters:</strong></p>
<table>
  <thead>
    <tr>
      <th>Name</th>
      <th>Type</th>
      <th>Description</th>
      <th>Default</th>
    </tr>
  </thead>
  <tbody>
      <tr>
        <td><code>logger</code></td>
        <td><code>Optional[logging.Logger]</code></td>
        <td><p>Instancia de logging.Logger para registrar eventos.</p></td>
        <td><code>None</code></td>
      </tr>
  </tbody>
</table>
        <details class="quote">
          <summary>Source code in <code>centraal_client_flow/helpers/logger.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">logger</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">logging</span><span class="o">.</span><span class="n">Logger</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Inicializa la clase base con un logger opcional.</span>

<span class="sd">    Parameters:</span>
<span class="sd">        logger: Instancia de logging.Logger para registrar eventos.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">logger</span> <span class="o">=</span> <span class="n">logger</span> <span class="ow">or</span> <span class="n">logging</span><span class="o">.</span><span class="n">getLogger</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="vm">__name__</span><span class="p">)</span>
</code></pre></div>
        </details>
    </div>

  </div>





  </div>

    </div>

  </div>







  </div>

    </div>

  </div>



  <div class="doc doc-object doc-module">



<h3 id="centraal_client_flow.helpers.pydantic" class="doc doc-heading">
        <code>pydantic</code>



<a href="#centraal_client_flow.helpers.pydantic" class="headerlink" title="Permanent link">&para;</a></h3>

    <div class="doc doc-contents ">

      <p>Helpers relacionados con pydantic.</p>



  <div class="doc doc-children">








  <div class="doc doc-object doc-function">



<h4 id="centraal_client_flow.helpers.pydantic.built_valid_json_str_with_aditional_info" class="doc doc-heading">
<code class="highlight language-python"><span class="n">built_valid_json_str_with_aditional_info</span><span class="p">(</span><span class="n">error_message</span><span class="p">,</span> <span class="n">additional_info</span><span class="p">)</span></code>


<a href="#centraal_client_flow.helpers.pydantic.built_valid_json_str_with_aditional_info" class="headerlink" title="Permanent link">&para;</a></h4>

    <div class="doc doc-contents ">

      <p>Construye una cadena JSON válida con información adicional.</p>

        <details class="quote">
          <summary>Source code in <code>centraal_client_flow/helpers/pydantic.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="nf">built_valid_json_str_with_aditional_info</span><span class="p">(</span>
    <span class="n">error_message</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">additional_info</span><span class="p">:</span> <span class="nb">str</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Construye una cadena JSON válida con información adicional.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">valid_dict</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;error_validacion&quot;</span><span class="p">:</span> <span class="n">error_message</span><span class="p">}</span>
    <span class="k">if</span> <span class="n">additional_info</span><span class="p">:</span>
        <span class="n">valid_dict</span><span class="p">[</span><span class="s2">&quot;error_validacion_detalle&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">additional_info</span>

    <span class="k">return</span> <span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">valid_dict</span><span class="p">,</span> <span class="n">ensure_ascii</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</code></pre></div>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-function">



<h4 id="centraal_client_flow.helpers.pydantic.serialize_validation_errors" class="doc doc-heading">
<code class="highlight language-python"><span class="n">serialize_validation_errors</span><span class="p">(</span><span class="n">errors</span><span class="p">)</span></code>


<a href="#centraal_client_flow.helpers.pydantic.serialize_validation_errors" class="headerlink" title="Permanent link">&para;</a></h4>

    <div class="doc doc-contents ">

      <p>Serializa los errores de validación en una cadena JSON adecuada para Cosmos DB.</p>

<p><strong>Parameters:</strong></p>
<table>
  <thead>
    <tr>
      <th>Name</th>
      <th>Type</th>
      <th>Description</th>
      <th>Default</th>
    </tr>
  </thead>
  <tbody>
      <tr>
        <td><code>errors</code></td>
        <td><code>list[pydantic_core.ErrorDetails]</code></td>
        <td><p>Lista de diccionarios que describen los errores de validación.</p></td>
        <td><em>required</em></td>
      </tr>
  </tbody>
</table>
<p><strong>Returns:</strong></p>
<table>
  <thead>
    <tr>
      <th>Type</th>
      <th>Description</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td><code>str</code></td>
      <td><p>Cadena JSON que representa los errores de validación.</p></td>
    </tr>
  </tbody>
</table>
        <details class="quote">
          <summary>Source code in <code>centraal_client_flow/helpers/pydantic.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="nf">serialize_validation_errors</span><span class="p">(</span><span class="n">errors</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="n">ErrorDetails</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Serializa los errores de validación en una cadena JSON adecuada para Cosmos DB.</span>

<span class="sd">    Args:</span>
<span class="sd">        errors: Lista de diccionarios que describen los errores de validación.</span>

<span class="sd">    Returns:</span>
<span class="sd">        Cadena JSON que representa los errores de validación.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">errors</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="n">_custom_serializer</span><span class="p">,</span> <span class="n">ensure_ascii</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</code></pre></div>
        </details>
    </div>

  </div>






  </div>

    </div>

  </div>




  </div>

    </div>

  </div>



  <div class="doc doc-object doc-module">



<h2 id="centraal_client_flow.rules" class="doc doc-heading">
        <code>rules</code>


  <span class="doc doc-properties">
      <small class="doc doc-property doc-property-special"><code>special</code></small>
  </span>

<a href="#centraal_client_flow.rules" class="headerlink" title="Permanent link">&para;</a></h2>

    <div class="doc doc-contents ">

      <p>Comun para rules.</p>



  <div class="doc doc-children">







  <div class="doc doc-object doc-class">



<h3 id="centraal_client_flow.rules.NoHayReglas" class="doc doc-heading">
        <code>
NoHayReglas            (<span title="Exception">Exception</span>)
        </code>



<a href="#centraal_client_flow.rules.NoHayReglas" class="headerlink" title="Permanent link">&para;</a></h3>

    <div class="doc doc-contents ">

      <p>Excepción personalizada cuando no existen reglas.</p>

        <details class="quote">
          <summary>Source code in <code>centraal_client_flow/rules/__init__.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">class</span> <span class="nc">NoHayReglas</span><span class="p">(</span><span class="ne">Exception</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Excepción personalizada cuando no existen reglas.&quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">mensaje</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">mensaje</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">mensaje</span> <span class="o">=</span> <span class="n">mensaje</span>
</code></pre></div>
        </details>



  <div class="doc doc-children">












  </div>

    </div>

  </div>






  <div class="doc doc-object doc-module">



<h3 id="centraal_client_flow.rules.integration" class="doc doc-heading">
        <code>integration</code>


  <span class="doc doc-properties">
      <small class="doc doc-property doc-property-special"><code>special</code></small>
  </span>

<a href="#centraal_client_flow.rules.integration" class="headerlink" title="Permanent link">&para;</a></h3>

    <div class="doc doc-contents ">




  <div class="doc doc-children">










  <div class="doc doc-object doc-module">



<h4 id="centraal_client_flow.rules.integration.processor" class="doc doc-heading">
        <code>processor</code>



<a href="#centraal_client_flow.rules.integration.processor" class="headerlink" title="Permanent link">&para;</a></h4>

    <div class="doc doc-contents ">

      <p>Reglas de integración.</p>



  <div class="doc doc-children">







  <div class="doc doc-object doc-class">



<h5 id="centraal_client_flow.rules.integration.processor.IntegrationRule" class="doc doc-heading">
        <code>
IntegrationRule        </code>



<a href="#centraal_client_flow.rules.integration.processor.IntegrationRule" class="headerlink" title="Permanent link">&para;</a></h5>

    <div class="doc doc-contents ">

      <p>Clase para definir y registrar reglas de integración basadas en topics de Service Bus.</p>
<p>Esta clase encapsula la lógica para definir una regla de integración utilizando un topic,
una suscripción y una estrategia de integración específica.</p>

        <details class="quote">
          <summary>Source code in <code>centraal_client_flow/rules/integration/processor.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">class</span> <span class="nc">IntegrationRule</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Clase para definir y registrar reglas de integración basadas en topics de Service Bus.</span>

<span class="sd">    Esta clase encapsula la lógica para definir una regla de integración utilizando un topic,</span>
<span class="sd">    una suscripción y una estrategia de integración específica.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">topic_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="n">connection_str</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="n">subscription_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="n">integration_strategy</span><span class="p">:</span> <span class="n">IntegrationStrategy</span><span class="p">,</span>
        <span class="n">model_unficado</span><span class="p">:</span> <span class="nb">type</span><span class="p">[</span><span class="n">EntradaEsquemaUnificado</span><span class="p">],</span>
    <span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Inicializa una regla de integración con los parámetros especificados.</span>

<span class="sd">        Args:</span>
<span class="sd">            topic_name: Nombre del topic de Service Bus que se utilizará para la integración.</span>
<span class="sd">            connection_str: Cadena de conexión para el Service Bus.</span>
<span class="sd">            subscription_name: Nombre de la suscripción en el topic de Service Bus.</span>
<span class="sd">            integration_strategy: Estrategia de integración a aplicar en los mensajes procesados.</span>
<span class="sd">            model_unficado: Modelo de esquema unificado para validar y mapear los mensajes recibidos.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">integration_strategy</span><span class="o">.</span><span class="n">name</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">function_name</span> <span class="o">=</span> <span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">integration_strategy</span><span class="o">.</span><span class="n">name</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">topic_name</span><span class="si">}</span><span class="s2">_intrule&quot;</span>
            <span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">function_name</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">topic_name</span><span class="si">}</span><span class="s2">_intrule&quot;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">topic_name</span> <span class="o">=</span> <span class="n">topic_name</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">connection_str</span> <span class="o">=</span> <span class="n">connection_str</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">subscription_name</span> <span class="o">=</span> <span class="n">subscription_name</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">integration_strategy</span> <span class="o">=</span> <span class="n">integration_strategy</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">model_unficado</span> <span class="o">=</span> <span class="n">model_unficado</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">id_esquema</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">IDModel</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>

    <span class="k">def</span> <span class="nf">run</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">message</span><span class="p">:</span> <span class="n">ServiceBusMessage</span> <span class="o">|</span> <span class="nb">dict</span><span class="p">,</span> <span class="n">logger</span><span class="p">:</span> <span class="n">logging</span><span class="o">.</span><span class="n">Logger</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Optional</span><span class="p">[</span><span class="n">StrategyResult</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Ejecuta la regla de integración.&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">message</span><span class="p">,</span> <span class="n">ServiceBusMessage</span><span class="p">):</span>
            <span class="n">message</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">loads</span><span class="p">(</span><span class="n">message</span><span class="o">.</span><span class="n">message</span><span class="p">)</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="n">message_esquema</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">model_unficado</span><span class="o">.</span><span class="n">model_validate</span><span class="p">(</span><span class="n">message</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">id_esquema</span> <span class="o">=</span> <span class="n">message_esquema</span><span class="o">.</span><span class="n">id</span>
            <span class="n">output_model</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">integration_strategy</span><span class="o">.</span><span class="n">modelo_unificado_mapping</span><span class="p">(</span>
                <span class="n">message_esquema</span>
            <span class="p">)</span>
        <span class="k">except</span> <span class="n">ValidationError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>

            <span class="n">error_val_cosmos_friendly</span> <span class="o">=</span> <span class="n">serialize_validation_errors</span><span class="p">(</span><span class="n">e</span><span class="o">.</span><span class="n">errors</span><span class="p">())</span>

            <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span>
                <span class="s2">&quot;Error antes de integración en validación </span><span class="si">%s</span><span class="s2">&quot;</span><span class="p">,</span>
                <span class="n">error_val_cosmos_friendly</span><span class="p">,</span>
                <span class="n">exc_info</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
            <span class="p">)</span>
            <span class="k">return</span> <span class="n">StrategyResult</span><span class="p">(</span>
                <span class="n">success</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                <span class="n">response</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;error_validacion&quot;</span><span class="p">:</span> <span class="n">error_val_cosmos_friendly</span><span class="p">},</span>
                <span class="n">bodysent</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;error_validacion&quot;</span><span class="p">:</span> <span class="kc">True</span><span class="p">},</span>
            <span class="p">)</span>

        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">integration_strategy</span><span class="o">.</span><span class="n">integrate</span><span class="p">(</span><span class="n">output_model</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">register_log</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">result</span><span class="p">:</span> <span class="n">StrategyResult</span><span class="p">,</span>
        <span class="n">cosmos_client</span><span class="p">:</span> <span class="n">CosmosDBSingleton</span><span class="p">,</span>
        <span class="n">container_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
    <span class="p">):</span>
        <span class="n">container</span> <span class="o">=</span> <span class="n">cosmos_client</span><span class="o">.</span><span class="n">get_container_client</span><span class="p">(</span><span class="n">container_name</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">id_esquema</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">entry</span> <span class="o">=</span> <span class="n">AuditoriaEntryIntegracion</span><span class="p">(</span>
                <span class="nb">id</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">id_esquema</span><span class="p">,</span>
                <span class="n">regla</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">function_name</span><span class="p">,</span>
                <span class="n">contenido</span><span class="o">=</span><span class="n">result</span><span class="o">.</span><span class="n">bodysent</span><span class="p">,</span>
                <span class="n">sucess</span><span class="o">=</span><span class="n">result</span><span class="o">.</span><span class="n">success</span><span class="p">,</span>
                <span class="n">response</span><span class="o">=</span><span class="n">result</span><span class="o">.</span><span class="n">response</span><span class="p">,</span>
            <span class="p">)</span>
            <span class="n">item_written</span> <span class="o">=</span> <span class="n">container</span><span class="o">.</span><span class="n">upsert_item</span><span class="p">(</span>
                <span class="n">entry</span><span class="o">.</span><span class="n">model_dump</span><span class="p">(</span><span class="n">mode</span><span class="o">=</span><span class="s2">&quot;json&quot;</span><span class="p">,</span> <span class="n">exclude_none</span><span class="o">=</span><span class="kc">True</span><span class="p">),</span>
            <span class="p">)</span>
            <span class="k">return</span> <span class="n">item_written</span>

        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;No es posible usar registro del log.&quot;</span><span class="p">)</span>
</code></pre></div>
        </details>



  <div class="doc doc-children">









  <div class="doc doc-object doc-method">



<h6 id="centraal_client_flow.rules.integration.processor.IntegrationRule.__init__" class="doc doc-heading">
<code class="highlight language-python"><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">topic_name</span><span class="p">,</span> <span class="n">connection_str</span><span class="p">,</span> <span class="n">subscription_name</span><span class="p">,</span> <span class="n">integration_strategy</span><span class="p">,</span> <span class="n">model_unficado</span><span class="p">)</span></code>

  <span class="doc doc-properties">
      <small class="doc doc-property doc-property-special"><code>special</code></small>
  </span>

<a href="#centraal_client_flow.rules.integration.processor.IntegrationRule.__init__" class="headerlink" title="Permanent link">&para;</a></h6>

    <div class="doc doc-contents ">

      <p>Inicializa una regla de integración con los parámetros especificados.</p>

<p><strong>Parameters:</strong></p>
<table>
  <thead>
    <tr>
      <th>Name</th>
      <th>Type</th>
      <th>Description</th>
      <th>Default</th>
    </tr>
  </thead>
  <tbody>
      <tr>
        <td><code>topic_name</code></td>
        <td><code>str</code></td>
        <td><p>Nombre del topic de Service Bus que se utilizará para la integración.</p></td>
        <td><em>required</em></td>
      </tr>
      <tr>
        <td><code>connection_str</code></td>
        <td><code>str</code></td>
        <td><p>Cadena de conexión para el Service Bus.</p></td>
        <td><em>required</em></td>
      </tr>
      <tr>
        <td><code>subscription_name</code></td>
        <td><code>str</code></td>
        <td><p>Nombre de la suscripción en el topic de Service Bus.</p></td>
        <td><em>required</em></td>
      </tr>
      <tr>
        <td><code>integration_strategy</code></td>
        <td><code>IntegrationStrategy</code></td>
        <td><p>Estrategia de integración a aplicar en los mensajes procesados.</p></td>
        <td><em>required</em></td>
      </tr>
      <tr>
        <td><code>model_unficado</code></td>
        <td><code>type[centraal_client_flow.models.schemas.EntradaEsquemaUnificado]</code></td>
        <td><p>Modelo de esquema unificado para validar y mapear los mensajes recibidos.</p></td>
        <td><em>required</em></td>
      </tr>
  </tbody>
</table>
        <details class="quote">
          <summary>Source code in <code>centraal_client_flow/rules/integration/processor.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="n">topic_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
    <span class="n">connection_str</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
    <span class="n">subscription_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
    <span class="n">integration_strategy</span><span class="p">:</span> <span class="n">IntegrationStrategy</span><span class="p">,</span>
    <span class="n">model_unficado</span><span class="p">:</span> <span class="nb">type</span><span class="p">[</span><span class="n">EntradaEsquemaUnificado</span><span class="p">],</span>
<span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Inicializa una regla de integración con los parámetros especificados.</span>

<span class="sd">    Args:</span>
<span class="sd">        topic_name: Nombre del topic de Service Bus que se utilizará para la integración.</span>
<span class="sd">        connection_str: Cadena de conexión para el Service Bus.</span>
<span class="sd">        subscription_name: Nombre de la suscripción en el topic de Service Bus.</span>
<span class="sd">        integration_strategy: Estrategia de integración a aplicar en los mensajes procesados.</span>
<span class="sd">        model_unficado: Modelo de esquema unificado para validar y mapear los mensajes recibidos.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">integration_strategy</span><span class="o">.</span><span class="n">name</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">function_name</span> <span class="o">=</span> <span class="p">(</span>
            <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">integration_strategy</span><span class="o">.</span><span class="n">name</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">topic_name</span><span class="si">}</span><span class="s2">_intrule&quot;</span>
        <span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">function_name</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">topic_name</span><span class="si">}</span><span class="s2">_intrule&quot;</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">topic_name</span> <span class="o">=</span> <span class="n">topic_name</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">connection_str</span> <span class="o">=</span> <span class="n">connection_str</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">subscription_name</span> <span class="o">=</span> <span class="n">subscription_name</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">integration_strategy</span> <span class="o">=</span> <span class="n">integration_strategy</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">model_unficado</span> <span class="o">=</span> <span class="n">model_unficado</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">id_esquema</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">IDModel</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
</code></pre></div>
        </details>
    </div>

  </div>




  <div class="doc doc-object doc-method">



<h6 id="centraal_client_flow.rules.integration.processor.IntegrationRule.run" class="doc doc-heading">
<code class="highlight language-python"><span class="n">run</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">message</span><span class="p">,</span> <span class="n">logger</span><span class="p">)</span></code>


<a href="#centraal_client_flow.rules.integration.processor.IntegrationRule.run" class="headerlink" title="Permanent link">&para;</a></h6>

    <div class="doc doc-contents ">

      <p>Ejecuta la regla de integración.</p>

        <details class="quote">
          <summary>Source code in <code>centraal_client_flow/rules/integration/processor.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="nf">run</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span> <span class="n">message</span><span class="p">:</span> <span class="n">ServiceBusMessage</span> <span class="o">|</span> <span class="nb">dict</span><span class="p">,</span> <span class="n">logger</span><span class="p">:</span> <span class="n">logging</span><span class="o">.</span><span class="n">Logger</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Optional</span><span class="p">[</span><span class="n">StrategyResult</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Ejecuta la regla de integración.&quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">message</span><span class="p">,</span> <span class="n">ServiceBusMessage</span><span class="p">):</span>
        <span class="n">message</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">loads</span><span class="p">(</span><span class="n">message</span><span class="o">.</span><span class="n">message</span><span class="p">)</span>

    <span class="k">try</span><span class="p">:</span>
        <span class="n">message_esquema</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">model_unficado</span><span class="o">.</span><span class="n">model_validate</span><span class="p">(</span><span class="n">message</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">id_esquema</span> <span class="o">=</span> <span class="n">message_esquema</span><span class="o">.</span><span class="n">id</span>
        <span class="n">output_model</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">integration_strategy</span><span class="o">.</span><span class="n">modelo_unificado_mapping</span><span class="p">(</span>
            <span class="n">message_esquema</span>
        <span class="p">)</span>
    <span class="k">except</span> <span class="n">ValidationError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>

        <span class="n">error_val_cosmos_friendly</span> <span class="o">=</span> <span class="n">serialize_validation_errors</span><span class="p">(</span><span class="n">e</span><span class="o">.</span><span class="n">errors</span><span class="p">())</span>

        <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span>
            <span class="s2">&quot;Error antes de integración en validación </span><span class="si">%s</span><span class="s2">&quot;</span><span class="p">,</span>
            <span class="n">error_val_cosmos_friendly</span><span class="p">,</span>
            <span class="n">exc_info</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="k">return</span> <span class="n">StrategyResult</span><span class="p">(</span>
            <span class="n">success</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
            <span class="n">response</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;error_validacion&quot;</span><span class="p">:</span> <span class="n">error_val_cosmos_friendly</span><span class="p">},</span>
            <span class="n">bodysent</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;error_validacion&quot;</span><span class="p">:</span> <span class="kc">True</span><span class="p">},</span>
        <span class="p">)</span>

    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">integration_strategy</span><span class="o">.</span><span class="n">integrate</span><span class="p">(</span><span class="n">output_model</span><span class="p">)</span>
</code></pre></div>
        </details>
    </div>

  </div>





  </div>

    </div>

  </div>







  </div>

    </div>

  </div>



  <div class="doc doc-object doc-module">



<h4 id="centraal_client_flow.rules.integration.strategy" class="doc doc-heading">
        <code>strategy</code>



<a href="#centraal_client_flow.rules.integration.strategy" class="headerlink" title="Permanent link">&para;</a></h4>

    <div class="doc doc-contents ">

      <p>Estrategias. </p>



  <div class="doc doc-children">







  <div class="doc doc-object doc-class">



<h5 id="centraal_client_flow.rules.integration.strategy.IntegrationStrategy" class="doc doc-heading">
        <code>
IntegrationStrategy            (<span title="abc.ABC">ABC</span>)
        </code>



<a href="#centraal_client_flow.rules.integration.strategy.IntegrationStrategy" class="headerlink" title="Permanent link">&para;</a></h5>

    <div class="doc doc-contents ">

      <p>Clase Abstracta para definir estrategias de integracion.</p>

        <details class="quote">
          <summary>Source code in <code>centraal_client_flow/rules/integration/strategy.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">class</span> <span class="nc">IntegrationStrategy</span><span class="p">(</span><span class="n">ABC</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Clase Abstracta para definir estrategias de integracion.&quot;&quot;&quot;</span>

    <span class="n">name</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="n">logger</span><span class="p">:</span> <span class="n">logging</span><span class="o">.</span><span class="n">Logger</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">logger</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">logging</span><span class="o">.</span><span class="n">Logger</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">name</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Inicializa la estrategia de integración con un logger opcional.</span>

<span class="sd">        Parameters:</span>
<span class="sd">            logger: Instancia opcional de logging.Logger.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">logger</span> <span class="o">=</span> <span class="n">logger</span> <span class="ow">or</span> <span class="n">logging</span><span class="o">.</span><span class="n">getLogger</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="vm">__name__</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="n">name</span>

    <span class="nd">@abstractmethod</span>
    <span class="k">def</span> <span class="nf">modelo_unificado_mapping</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">message</span><span class="p">:</span> <span class="n">EntradaEsquemaUnificado</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Optional</span><span class="p">[</span><span class="n">BaseModel</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Mapea el mensaje de entrada a un modelo unificado de salida.</span>

<span class="sd">        Args:</span>
<span class="sd">            message: El mensaje de entrada a ser mapeado.</span>

<span class="sd">        Returns:</span>
<span class="sd">            Un modelo Pydantic que representa la salida mapeada.</span>
<span class="sd">        &quot;&quot;&quot;</span>

    <span class="nd">@abstractmethod</span>
    <span class="k">def</span> <span class="nf">integrate</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">output_model</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">BaseModel</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Any</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Realiza la integración utilizando el modelo de salida.</span>

<span class="sd">        Args:</span>
<span class="sd">            output_model: El modelo de datos ya mapeado que se enviará a la integración.</span>

<span class="sd">        Returns:</span>
<span class="sd">            La respuesta de la integración, generalmente en formato JSON.</span>
<span class="sd">        &quot;&quot;&quot;</span>
</code></pre></div>
        </details>



  <div class="doc doc-children">










  <div class="doc doc-object doc-method">



<h6 id="centraal_client_flow.rules.integration.strategy.IntegrationStrategy.__init__" class="doc doc-heading">
<code class="highlight language-python"><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">logger</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>

  <span class="doc doc-properties">
      <small class="doc doc-property doc-property-special"><code>special</code></small>
  </span>

<a href="#centraal_client_flow.rules.integration.strategy.IntegrationStrategy.__init__" class="headerlink" title="Permanent link">&para;</a></h6>

    <div class="doc doc-contents ">

      <p>Inicializa la estrategia de integración con un logger opcional.</p>

<p><strong>Parameters:</strong></p>
<table>
  <thead>
    <tr>
      <th>Name</th>
      <th>Type</th>
      <th>Description</th>
      <th>Default</th>
    </tr>
  </thead>
  <tbody>
      <tr>
        <td><code>logger</code></td>
        <td><code>Optional[logging.Logger]</code></td>
        <td><p>Instancia opcional de logging.Logger.</p></td>
        <td><code>None</code></td>
      </tr>
  </tbody>
</table>
        <details class="quote">
          <summary>Source code in <code>centraal_client_flow/rules/integration/strategy.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span> <span class="n">logger</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">logging</span><span class="o">.</span><span class="n">Logger</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">name</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
<span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Inicializa la estrategia de integración con un logger opcional.</span>

<span class="sd">    Parameters:</span>
<span class="sd">        logger: Instancia opcional de logging.Logger.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">logger</span> <span class="o">=</span> <span class="n">logger</span> <span class="ow">or</span> <span class="n">logging</span><span class="o">.</span><span class="n">getLogger</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="vm">__name__</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="n">name</span>
</code></pre></div>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-method">



<h6 id="centraal_client_flow.rules.integration.strategy.IntegrationStrategy.integrate" class="doc doc-heading">
<code class="highlight language-python"><span class="n">integrate</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">output_model</span><span class="p">)</span></code>


<a href="#centraal_client_flow.rules.integration.strategy.IntegrationStrategy.integrate" class="headerlink" title="Permanent link">&para;</a></h6>

    <div class="doc doc-contents ">

      <p>Realiza la integración utilizando el modelo de salida.</p>

<p><strong>Parameters:</strong></p>
<table>
  <thead>
    <tr>
      <th>Name</th>
      <th>Type</th>
      <th>Description</th>
      <th>Default</th>
    </tr>
  </thead>
  <tbody>
      <tr>
        <td><code>output_model</code></td>
        <td><code>Optional[pydantic.main.BaseModel]</code></td>
        <td><p>El modelo de datos ya mapeado que se enviará a la integración.</p></td>
        <td><em>required</em></td>
      </tr>
  </tbody>
</table>
<p><strong>Returns:</strong></p>
<table>
  <thead>
    <tr>
      <th>Type</th>
      <th>Description</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td><code>Optional[Any]</code></td>
      <td><p>La respuesta de la integración, generalmente en formato JSON.</p></td>
    </tr>
  </tbody>
</table>
        <details class="quote">
          <summary>Source code in <code>centraal_client_flow/rules/integration/strategy.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="nd">@abstractmethod</span>
<span class="k">def</span> <span class="nf">integrate</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">output_model</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">BaseModel</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Any</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Realiza la integración utilizando el modelo de salida.</span>

<span class="sd">    Args:</span>
<span class="sd">        output_model: El modelo de datos ya mapeado que se enviará a la integración.</span>

<span class="sd">    Returns:</span>
<span class="sd">        La respuesta de la integración, generalmente en formato JSON.</span>
<span class="sd">    &quot;&quot;&quot;</span>
</code></pre></div>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-method">



<h6 id="centraal_client_flow.rules.integration.strategy.IntegrationStrategy.modelo_unificado_mapping" class="doc doc-heading">
<code class="highlight language-python"><span class="n">modelo_unificado_mapping</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">message</span><span class="p">)</span></code>


<a href="#centraal_client_flow.rules.integration.strategy.IntegrationStrategy.modelo_unificado_mapping" class="headerlink" title="Permanent link">&para;</a></h6>

    <div class="doc doc-contents ">

      <p>Mapea el mensaje de entrada a un modelo unificado de salida.</p>

<p><strong>Parameters:</strong></p>
<table>
  <thead>
    <tr>
      <th>Name</th>
      <th>Type</th>
      <th>Description</th>
      <th>Default</th>
    </tr>
  </thead>
  <tbody>
      <tr>
        <td><code>message</code></td>
        <td><code>EntradaEsquemaUnificado</code></td>
        <td><p>El mensaje de entrada a ser mapeado.</p></td>
        <td><em>required</em></td>
      </tr>
  </tbody>
</table>
<p><strong>Returns:</strong></p>
<table>
  <thead>
    <tr>
      <th>Type</th>
      <th>Description</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td><code>Optional[pydantic.main.BaseModel]</code></td>
      <td><p>Un modelo Pydantic que representa la salida mapeada.</p></td>
    </tr>
  </tbody>
</table>
        <details class="quote">
          <summary>Source code in <code>centraal_client_flow/rules/integration/strategy.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="nd">@abstractmethod</span>
<span class="k">def</span> <span class="nf">modelo_unificado_mapping</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span> <span class="n">message</span><span class="p">:</span> <span class="n">EntradaEsquemaUnificado</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Optional</span><span class="p">[</span><span class="n">BaseModel</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Mapea el mensaje de entrada a un modelo unificado de salida.</span>

<span class="sd">    Args:</span>
<span class="sd">        message: El mensaje de entrada a ser mapeado.</span>

<span class="sd">    Returns:</span>
<span class="sd">        Un modelo Pydantic que representa la salida mapeada.</span>
<span class="sd">    &quot;&quot;&quot;</span>
</code></pre></div>
        </details>
    </div>

  </div>





  </div>

    </div>

  </div>



  <div class="doc doc-object doc-class">



<h5 id="centraal_client_flow.rules.integration.strategy.OAuthConfigPassFlow" class="doc doc-heading">
        <code>
OAuthConfigPassFlow        </code>


  <span class="doc doc-properties">
      <small class="doc doc-property doc-property-dataclass"><code>dataclass</code></small>
  </span>

<a href="#centraal_client_flow.rules.integration.strategy.OAuthConfigPassFlow" class="headerlink" title="Permanent link">&para;</a></h5>

    <div class="doc doc-contents ">

      <p>Configuración necesaria para la autenticación OAuth 2.0 con grant_type=password.</p>

        <details class="quote">
          <summary>Source code in <code>centraal_client_flow/rules/integration/strategy.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="nd">@dataclass</span>
<span class="k">class</span> <span class="nc">OAuthConfigPassFlow</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Configuración necesaria para la autenticación OAuth 2.0 con grant_type=password.&quot;&quot;&quot;</span>

    <span class="n">client_id</span><span class="p">:</span> <span class="nb">str</span>
    <span class="n">client_secret</span><span class="p">:</span> <span class="nb">str</span>
    <span class="n">username</span><span class="p">:</span> <span class="nb">str</span>
    <span class="n">password</span><span class="p">:</span> <span class="nb">str</span>
    <span class="n">token_resource</span><span class="p">:</span> <span class="nb">str</span>
    <span class="n">api_url</span><span class="p">:</span> <span class="nb">str</span>
    <span class="n">use_url_params_for_auth</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span>
</code></pre></div>
        </details>



  <div class="doc doc-children">





















  </div>

    </div>

  </div>



  <div class="doc doc-object doc-class">



<h5 id="centraal_client_flow.rules.integration.strategy.OAuthTokenPass" class="doc doc-heading">
        <code>
OAuthTokenPass        </code>


  <span class="doc doc-properties">
      <small class="doc doc-property doc-property-dataclass"><code>dataclass</code></small>
  </span>

<a href="#centraal_client_flow.rules.integration.strategy.OAuthTokenPass" class="headerlink" title="Permanent link">&para;</a></h5>

    <div class="doc doc-contents ">

      <p>Representa el token OAuth obtenido tras la autenticación.</p>

        <details class="quote">
          <summary>Source code in <code>centraal_client_flow/rules/integration/strategy.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="nd">@dataclass</span>
<span class="k">class</span> <span class="nc">OAuthTokenPass</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Representa el token OAuth obtenido tras la autenticación.&quot;&quot;&quot;</span>

    <span class="n">access_token</span><span class="p">:</span> <span class="nb">str</span>
    <span class="n">instance_url</span><span class="p">:</span> <span class="nb">str</span>
    <span class="nb">id</span><span class="p">:</span> <span class="nb">str</span>
    <span class="n">token_type</span><span class="p">:</span> <span class="nb">str</span>
    <span class="n">issued_at</span><span class="p">:</span> <span class="nb">int</span>
    <span class="n">signature</span><span class="p">:</span> <span class="nb">str</span>
    <span class="n">expires_in</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">1800</span>

    <span class="k">def</span> <span class="nf">__post_init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">issued_at</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">issued_at</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">issued_at</span><span class="p">)</span>
</code></pre></div>
        </details>



  <div class="doc doc-children">






















  </div>

    </div>

  </div>



  <div class="doc doc-object doc-class">



<h5 id="centraal_client_flow.rules.integration.strategy.RESTIntegration" class="doc doc-heading">
        <code>
RESTIntegration            (<a title="centraal_client_flow.rules.integration.strategy.IntegrationStrategy" href="#centraal_client_flow.rules.integration.strategy.IntegrationStrategy">IntegrationStrategy</a>)
        </code>



<a href="#centraal_client_flow.rules.integration.strategy.RESTIntegration" class="headerlink" title="Permanent link">&para;</a></h5>

    <div class="doc doc-contents ">

      <p>Estrategia de integracion basada en REST.</p>

        <details class="quote">
          <summary>Source code in <code>centraal_client_flow/rules/integration/strategy.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">class</span> <span class="nc">RESTIntegration</span><span class="p">(</span><span class="n">IntegrationStrategy</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Estrategia de integracion basada en REST.&quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">oauth_config</span><span class="p">:</span> <span class="n">OAuthConfigPassFlow</span><span class="p">,</span>
        <span class="n">method</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;POST&quot;</span><span class="p">,</span>
        <span class="n">resource</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span><span class="p">,</span>
        <span class="n">mapping_function</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span>
            <span class="n">Callable</span><span class="p">[[</span><span class="n">EntradaEsquemaUnificado</span><span class="p">],</span> <span class="n">Optional</span><span class="p">[</span><span class="n">BaseModel</span><span class="p">]]</span>
        <span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">logger</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">logging</span><span class="o">.</span><span class="n">Logger</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Inicializa una instancia de RESTIntegration con la configuración de OAuth y</span>
<span class="sd">            los parámetros REST.</span>

<span class="sd">        Args:</span>
<span class="sd">            oauth_config: Configuración necesaria para autenticarse con OAuth 2.0.</span>
<span class="sd">            method: El método HTTP que se utilizará para la integración</span>
<span class="sd">                (por ejemplo, &#39;POST&#39;, &#39;PATCH&#39;).</span>
<span class="sd">            resource: El recurso específico de la API con el cual se interactuará.</span>
<span class="sd">            mapping_function: Una función opcional que define cómo mapear un</span>
<span class="sd">                `EntradaEsquemaUnificado` a un modelo Pydantic.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">mapping_function</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span>
                <span class="n">logger</span><span class="o">=</span><span class="n">logger</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">method</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">mapping_function</span><span class="o">.</span><span class="vm">__name__</span><span class="si">}</span><span class="s2">&quot;</span>
            <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">oauth_config</span> <span class="o">=</span> <span class="n">oauth_config</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">method</span> <span class="o">=</span> <span class="n">method</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">resource</span> <span class="o">=</span> <span class="n">resource</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">mapping_function</span> <span class="o">=</span> <span class="n">mapping_function</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">response_processor</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">r</span><span class="p">,</span> <span class="n">m</span><span class="p">:</span> <span class="n">StrategyResult</span><span class="p">(</span>
            <span class="n">success</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">response</span><span class="o">=</span><span class="n">r</span><span class="p">,</span> <span class="n">bodysent</span><span class="o">=</span><span class="n">m</span>
        <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_token</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">OAuthTokenPass</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>

    <span class="k">def</span> <span class="nf">_authenticate</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">OAuthTokenPass</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Autentica usando OAuth 2.0 con grant_type=password y obtiene un token de acceso.</span>

<span class="sd">        Returns:</span>
<span class="sd">            Un objeto `OAuthTokenPass` que contiene el token de acceso y otra información relevante.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">auth_data</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s2">&quot;grant_type&quot;</span><span class="p">:</span> <span class="s2">&quot;password&quot;</span><span class="p">,</span>
            <span class="s2">&quot;client_id&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">oauth_config</span><span class="o">.</span><span class="n">client_id</span><span class="p">,</span>
            <span class="s2">&quot;client_secret&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">oauth_config</span><span class="o">.</span><span class="n">client_secret</span><span class="p">,</span>
            <span class="s2">&quot;username&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">oauth_config</span><span class="o">.</span><span class="n">username</span><span class="p">,</span>
            <span class="s2">&quot;password&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">oauth_config</span><span class="o">.</span><span class="n">password</span><span class="p">,</span>
        <span class="p">}</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">oauth_config</span><span class="o">.</span><span class="n">use_url_params_for_auth</span><span class="p">:</span>
            <span class="n">token_url</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">oauth_config</span><span class="o">.</span><span class="n">api_url</span><span class="si">}</span><span class="s2">/</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">oauth_config</span><span class="o">.</span><span class="n">token_resource</span><span class="si">}</span><span class="s2">?</span><span class="si">{</span><span class="n">urlencode</span><span class="p">(</span><span class="n">auth_data</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span>
            <span class="n">response</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">post</span><span class="p">(</span><span class="n">token_url</span><span class="p">,</span> <span class="n">headers</span><span class="o">=</span><span class="p">{},</span> <span class="n">timeout</span><span class="o">=</span><span class="mi">30</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">token_url</span> <span class="o">=</span> <span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">oauth_config</span><span class="o">.</span><span class="n">api_url</span><span class="si">}</span><span class="s2">/</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">oauth_config</span><span class="o">.</span><span class="n">token_resource</span><span class="si">}</span><span class="s2">&quot;</span>
            <span class="p">)</span>
            <span class="n">response</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">post</span><span class="p">(</span><span class="n">token_url</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">auth_data</span><span class="p">,</span> <span class="n">headers</span><span class="o">=</span><span class="p">{},</span> <span class="n">timeout</span><span class="o">=</span><span class="mi">30</span><span class="p">)</span>

        <span class="n">response</span><span class="o">.</span><span class="n">raise_for_status</span><span class="p">()</span>
        <span class="n">token_data</span> <span class="o">=</span> <span class="n">response</span><span class="o">.</span><span class="n">json</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_token</span> <span class="o">=</span> <span class="n">OAuthTokenPass</span><span class="p">(</span><span class="o">**</span><span class="n">token_data</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_token</span>

    <span class="k">def</span> <span class="nf">_get_token</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Obtiene el token actual o lo renueva si ha expirado.</span>

<span class="sd">        Returns:</span>
<span class="sd">            El token de acceso en formato de cadena.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_token</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_authenticate</span><span class="p">()</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_token</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">current_time</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">())</span>
            <span class="n">expiration_time</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_token</span><span class="o">.</span><span class="n">issued_at</span> <span class="o">/</span> <span class="mi">1000</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">_token</span><span class="o">.</span><span class="n">expires_in</span>
            <span class="k">if</span> <span class="n">current_time</span> <span class="o">&gt;=</span> <span class="n">expiration_time</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;El token ha expirado. Renovando...&quot;</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_authenticate</span><span class="p">()</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_token</span><span class="o">.</span><span class="n">access_token</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;error en autenticación&quot;</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">modelo_unificado_mapping</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">message</span><span class="p">:</span> <span class="n">EntradaEsquemaUnificado</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Optional</span><span class="p">[</span><span class="n">BaseModel</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Mapea el mensaje de entrada a un modelo unificado de salida utilizando la</span>
<span class="sd">            función de mapeo proporcionada.</span>

<span class="sd">        Args:</span>
<span class="sd">            message: El mensaje de entrada que será mapeado.</span>

<span class="sd">        Returns:</span>
<span class="sd">            Un modelo Pydantic que representa la salida mapeada.</span>

<span class="sd">        Raises:</span>
<span class="sd">            TypeError: Si el mensaje no es una instancia de `EntradaEsquemaUnificado`.</span>
<span class="sd">            NotImplementedError: Si no se ha proporcionado una función de mapeo personalizada.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">mapping_function</span><span class="p">:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">message</span><span class="p">,</span> <span class="n">EntradaEsquemaUnificado</span><span class="p">):</span>
                <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span>
                    <span class="s2">&quot;El mensaje debe ser una instancia de EntradaEsquemaUnificado&quot;</span>
                <span class="p">)</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">mapping_function</span><span class="p">(</span><span class="n">message</span><span class="p">)</span>
        <span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">(</span>
            <span class="s2">&quot;No se ha proporcionado una función de mapeo personalizada.&quot;</span>
        <span class="p">)</span>

    <span class="k">def</span> <span class="nf">integrate</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">output_model</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">BaseModel</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="n">Optional</span><span class="p">[</span><span class="n">StrategyResult</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Realiza la integración utilizando el modelo de salida mapeado.</span>

<span class="sd">        Args:</span>
<span class="sd">            output_model: El modelo de datos ya mapeado que se enviará a la integración.</span>

<span class="sd">        Returns:</span>
<span class="sd">            La respuesta defina en response_processor.</span>

<span class="sd">        Raises:</span>
<span class="sd">            HTTPError: Si la solicitud HTTP a la API falla.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">token</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_token</span><span class="p">()</span>
        <span class="n">headers</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s2">&quot;Authorization&quot;</span><span class="p">:</span> <span class="sa">f</span><span class="s2">&quot;Bearer </span><span class="si">{</span><span class="n">token</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
            <span class="s2">&quot;Content-Type&quot;</span><span class="p">:</span> <span class="s2">&quot;application/json&quot;</span><span class="p">,</span>
        <span class="p">}</span>

        <span class="n">url</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">oauth_config</span><span class="o">.</span><span class="n">api_url</span><span class="si">}</span><span class="s2">/</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">resource</span><span class="si">}</span><span class="s2">&quot;</span>

        <span class="k">if</span> <span class="n">output_model</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>

            <span class="n">response</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">request</span><span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">method</span><span class="p">,</span>
                <span class="n">url</span><span class="p">,</span>
                <span class="n">json</span><span class="o">=</span><span class="n">output_model</span><span class="o">.</span><span class="n">model_dump</span><span class="p">(</span><span class="n">mode</span><span class="o">=</span><span class="s2">&quot;json&quot;</span><span class="p">,</span> <span class="n">exclude_none</span><span class="o">=</span><span class="kc">True</span><span class="p">),</span>
                <span class="n">headers</span><span class="o">=</span><span class="n">headers</span><span class="p">,</span>
                <span class="n">timeout</span><span class="o">=</span><span class="mi">300</span><span class="p">,</span>
            <span class="p">)</span>
            <span class="n">response</span><span class="o">.</span><span class="n">raise_for_status</span><span class="p">()</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">response_processor</span><span class="p">(</span><span class="n">response</span><span class="p">,</span> <span class="n">output_model</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Evento es ignorado.&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">StrategyResult</span><span class="p">(</span>
            <span class="n">success</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
            <span class="n">response</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;evento_ignorado&quot;</span><span class="p">:</span> <span class="kc">True</span><span class="p">},</span>
            <span class="n">bodysent</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;evento_ignorado&quot;</span><span class="p">:</span> <span class="kc">True</span><span class="p">},</span>
        <span class="p">)</span>

    <span class="k">def</span> <span class="nf">set_response_processor</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">processor</span><span class="p">:</span> <span class="n">Callable</span><span class="p">[[</span><span class="n">requests</span><span class="o">.</span><span class="n">Response</span><span class="p">,</span> <span class="n">BaseModel</span><span class="p">],</span> <span class="n">StrategyResult</span><span class="p">]</span>
    <span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Configura un procesamiento de la respuesta.&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">response_processor</span> <span class="o">=</span> <span class="n">processor</span>
</code></pre></div>
        </details>



  <div class="doc doc-children">









  <div class="doc doc-object doc-method">



<h6 id="centraal_client_flow.rules.integration.strategy.RESTIntegration.__init__" class="doc doc-heading">
<code class="highlight language-python"><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">oauth_config</span><span class="p">,</span> <span class="n">method</span><span class="o">=</span><span class="s1">&#39;POST&#39;</span><span class="p">,</span> <span class="n">resource</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="n">mapping_function</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">logger</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>

  <span class="doc doc-properties">
      <small class="doc doc-property doc-property-special"><code>special</code></small>
  </span>

<a href="#centraal_client_flow.rules.integration.strategy.RESTIntegration.__init__" class="headerlink" title="Permanent link">&para;</a></h6>

    <div class="doc doc-contents ">

      <p>Inicializa una instancia de RESTIntegration con la configuración de OAuth y
    los parámetros REST.</p>

<p><strong>Parameters:</strong></p>
<table>
  <thead>
    <tr>
      <th>Name</th>
      <th>Type</th>
      <th>Description</th>
      <th>Default</th>
    </tr>
  </thead>
  <tbody>
      <tr>
        <td><code>oauth_config</code></td>
        <td><code>OAuthConfigPassFlow</code></td>
        <td><p>Configuración necesaria para autenticarse con OAuth 2.0.</p></td>
        <td><em>required</em></td>
      </tr>
      <tr>
        <td><code>method</code></td>
        <td><code>str</code></td>
        <td><p>El método HTTP que se utilizará para la integración
(por ejemplo, 'POST', 'PATCH').</p></td>
        <td><code>&#39;POST&#39;</code></td>
      </tr>
      <tr>
        <td><code>resource</code></td>
        <td><code>str</code></td>
        <td><p>El recurso específico de la API con el cual se interactuará.</p></td>
        <td><code>&#39;&#39;</code></td>
      </tr>
      <tr>
        <td><code>mapping_function</code></td>
        <td><code>Optional[Callable[[centraal_client_flow.models.schemas.EntradaEsquemaUnificado], Optional[pydantic.main.BaseModel]]]</code></td>
        <td><p>Una función opcional que define cómo mapear un
<code>EntradaEsquemaUnificado</code> a un modelo Pydantic.</p></td>
        <td><code>None</code></td>
      </tr>
  </tbody>
</table>
        <details class="quote">
          <summary>Source code in <code>centraal_client_flow/rules/integration/strategy.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="n">oauth_config</span><span class="p">:</span> <span class="n">OAuthConfigPassFlow</span><span class="p">,</span>
    <span class="n">method</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;POST&quot;</span><span class="p">,</span>
    <span class="n">resource</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span><span class="p">,</span>
    <span class="n">mapping_function</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span>
        <span class="n">Callable</span><span class="p">[[</span><span class="n">EntradaEsquemaUnificado</span><span class="p">],</span> <span class="n">Optional</span><span class="p">[</span><span class="n">BaseModel</span><span class="p">]]</span>
    <span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">logger</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">logging</span><span class="o">.</span><span class="n">Logger</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Inicializa una instancia de RESTIntegration con la configuración de OAuth y</span>
<span class="sd">        los parámetros REST.</span>

<span class="sd">    Args:</span>
<span class="sd">        oauth_config: Configuración necesaria para autenticarse con OAuth 2.0.</span>
<span class="sd">        method: El método HTTP que se utilizará para la integración</span>
<span class="sd">            (por ejemplo, &#39;POST&#39;, &#39;PATCH&#39;).</span>
<span class="sd">        resource: El recurso específico de la API con el cual se interactuará.</span>
<span class="sd">        mapping_function: Una función opcional que define cómo mapear un</span>
<span class="sd">            `EntradaEsquemaUnificado` a un modelo Pydantic.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">mapping_function</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span>
            <span class="n">logger</span><span class="o">=</span><span class="n">logger</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">method</span><span class="si">}</span><span class="s2">_</span><span class="si">{</span><span class="n">mapping_function</span><span class="o">.</span><span class="vm">__name__</span><span class="si">}</span><span class="s2">&quot;</span>
        <span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">oauth_config</span> <span class="o">=</span> <span class="n">oauth_config</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">method</span> <span class="o">=</span> <span class="n">method</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">resource</span> <span class="o">=</span> <span class="n">resource</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">mapping_function</span> <span class="o">=</span> <span class="n">mapping_function</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">response_processor</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">r</span><span class="p">,</span> <span class="n">m</span><span class="p">:</span> <span class="n">StrategyResult</span><span class="p">(</span>
        <span class="n">success</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">response</span><span class="o">=</span><span class="n">r</span><span class="p">,</span> <span class="n">bodysent</span><span class="o">=</span><span class="n">m</span>
    <span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_token</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">OAuthTokenPass</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
</code></pre></div>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-method">



<h6 id="centraal_client_flow.rules.integration.strategy.RESTIntegration.integrate" class="doc doc-heading">
<code class="highlight language-python"><span class="n">integrate</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">output_model</span><span class="p">)</span></code>


<a href="#centraal_client_flow.rules.integration.strategy.RESTIntegration.integrate" class="headerlink" title="Permanent link">&para;</a></h6>

    <div class="doc doc-contents ">

      <p>Realiza la integración utilizando el modelo de salida mapeado.</p>

<p><strong>Parameters:</strong></p>
<table>
  <thead>
    <tr>
      <th>Name</th>
      <th>Type</th>
      <th>Description</th>
      <th>Default</th>
    </tr>
  </thead>
  <tbody>
      <tr>
        <td><code>output_model</code></td>
        <td><code>Optional[pydantic.main.BaseModel]</code></td>
        <td><p>El modelo de datos ya mapeado que se enviará a la integración.</p></td>
        <td><em>required</em></td>
      </tr>
  </tbody>
</table>
<p><strong>Returns:</strong></p>
<table>
  <thead>
    <tr>
      <th>Type</th>
      <th>Description</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td><code>Optional[centraal_client_flow.rules.integration.strategy.StrategyResult]</code></td>
      <td><p>La respuesta defina en response_processor.</p></td>
    </tr>
  </tbody>
</table>
<p><strong>Exceptions:</strong></p>
<table>
  <thead>
    <tr>
      <th>Type</th>
      <th>Description</th>
    </tr>
  </thead>
  <tbody>
      <tr>
        <td><code>HTTPError</code></td>
        <td><p>Si la solicitud HTTP a la API falla.</p></td>
      </tr>
  </tbody>
</table>
        <details class="quote">
          <summary>Source code in <code>centraal_client_flow/rules/integration/strategy.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="nf">integrate</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">output_model</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">BaseModel</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="n">Optional</span><span class="p">[</span><span class="n">StrategyResult</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Realiza la integración utilizando el modelo de salida mapeado.</span>

<span class="sd">    Args:</span>
<span class="sd">        output_model: El modelo de datos ya mapeado que se enviará a la integración.</span>

<span class="sd">    Returns:</span>
<span class="sd">        La respuesta defina en response_processor.</span>

<span class="sd">    Raises:</span>
<span class="sd">        HTTPError: Si la solicitud HTTP a la API falla.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">token</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_token</span><span class="p">()</span>
    <span class="n">headers</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s2">&quot;Authorization&quot;</span><span class="p">:</span> <span class="sa">f</span><span class="s2">&quot;Bearer </span><span class="si">{</span><span class="n">token</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
        <span class="s2">&quot;Content-Type&quot;</span><span class="p">:</span> <span class="s2">&quot;application/json&quot;</span><span class="p">,</span>
    <span class="p">}</span>

    <span class="n">url</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">oauth_config</span><span class="o">.</span><span class="n">api_url</span><span class="si">}</span><span class="s2">/</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">resource</span><span class="si">}</span><span class="s2">&quot;</span>

    <span class="k">if</span> <span class="n">output_model</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>

        <span class="n">response</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">request</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">method</span><span class="p">,</span>
            <span class="n">url</span><span class="p">,</span>
            <span class="n">json</span><span class="o">=</span><span class="n">output_model</span><span class="o">.</span><span class="n">model_dump</span><span class="p">(</span><span class="n">mode</span><span class="o">=</span><span class="s2">&quot;json&quot;</span><span class="p">,</span> <span class="n">exclude_none</span><span class="o">=</span><span class="kc">True</span><span class="p">),</span>
            <span class="n">headers</span><span class="o">=</span><span class="n">headers</span><span class="p">,</span>
            <span class="n">timeout</span><span class="o">=</span><span class="mi">300</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="n">response</span><span class="o">.</span><span class="n">raise_for_status</span><span class="p">()</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">response_processor</span><span class="p">(</span><span class="n">response</span><span class="p">,</span> <span class="n">output_model</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Evento es ignorado.&quot;</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">StrategyResult</span><span class="p">(</span>
        <span class="n">success</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="n">response</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;evento_ignorado&quot;</span><span class="p">:</span> <span class="kc">True</span><span class="p">},</span>
        <span class="n">bodysent</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;evento_ignorado&quot;</span><span class="p">:</span> <span class="kc">True</span><span class="p">},</span>
    <span class="p">)</span>
</code></pre></div>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-method">



<h6 id="centraal_client_flow.rules.integration.strategy.RESTIntegration.modelo_unificado_mapping" class="doc doc-heading">
<code class="highlight language-python"><span class="n">modelo_unificado_mapping</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">message</span><span class="p">)</span></code>


<a href="#centraal_client_flow.rules.integration.strategy.RESTIntegration.modelo_unificado_mapping" class="headerlink" title="Permanent link">&para;</a></h6>

    <div class="doc doc-contents ">

      <p>Mapea el mensaje de entrada a un modelo unificado de salida utilizando la
    función de mapeo proporcionada.</p>

<p><strong>Parameters:</strong></p>
<table>
  <thead>
    <tr>
      <th>Name</th>
      <th>Type</th>
      <th>Description</th>
      <th>Default</th>
    </tr>
  </thead>
  <tbody>
      <tr>
        <td><code>message</code></td>
        <td><code>EntradaEsquemaUnificado</code></td>
        <td><p>El mensaje de entrada que será mapeado.</p></td>
        <td><em>required</em></td>
      </tr>
  </tbody>
</table>
<p><strong>Returns:</strong></p>
<table>
  <thead>
    <tr>
      <th>Type</th>
      <th>Description</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td><code>Optional[pydantic.main.BaseModel]</code></td>
      <td><p>Un modelo Pydantic que representa la salida mapeada.</p></td>
    </tr>
  </tbody>
</table>
<p><strong>Exceptions:</strong></p>
<table>
  <thead>
    <tr>
      <th>Type</th>
      <th>Description</th>
    </tr>
  </thead>
  <tbody>
      <tr>
        <td><code>TypeError</code></td>
        <td><p>Si el mensaje no es una instancia de <code>EntradaEsquemaUnificado</code>.</p></td>
      </tr>
      <tr>
        <td><code>NotImplementedError</code></td>
        <td><p>Si no se ha proporcionado una función de mapeo personalizada.</p></td>
      </tr>
  </tbody>
</table>
        <details class="quote">
          <summary>Source code in <code>centraal_client_flow/rules/integration/strategy.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="nf">modelo_unificado_mapping</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span> <span class="n">message</span><span class="p">:</span> <span class="n">EntradaEsquemaUnificado</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Optional</span><span class="p">[</span><span class="n">BaseModel</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Mapea el mensaje de entrada a un modelo unificado de salida utilizando la</span>
<span class="sd">        función de mapeo proporcionada.</span>

<span class="sd">    Args:</span>
<span class="sd">        message: El mensaje de entrada que será mapeado.</span>

<span class="sd">    Returns:</span>
<span class="sd">        Un modelo Pydantic que representa la salida mapeada.</span>

<span class="sd">    Raises:</span>
<span class="sd">        TypeError: Si el mensaje no es una instancia de `EntradaEsquemaUnificado`.</span>
<span class="sd">        NotImplementedError: Si no se ha proporcionado una función de mapeo personalizada.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">mapping_function</span><span class="p">:</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">message</span><span class="p">,</span> <span class="n">EntradaEsquemaUnificado</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span>
                <span class="s2">&quot;El mensaje debe ser una instancia de EntradaEsquemaUnificado&quot;</span>
            <span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">mapping_function</span><span class="p">(</span><span class="n">message</span><span class="p">)</span>
    <span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">(</span>
        <span class="s2">&quot;No se ha proporcionado una función de mapeo personalizada.&quot;</span>
    <span class="p">)</span>
</code></pre></div>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-method">



<h6 id="centraal_client_flow.rules.integration.strategy.RESTIntegration.set_response_processor" class="doc doc-heading">
<code class="highlight language-python"><span class="n">set_response_processor</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">processor</span><span class="p">)</span></code>


<a href="#centraal_client_flow.rules.integration.strategy.RESTIntegration.set_response_processor" class="headerlink" title="Permanent link">&para;</a></h6>

    <div class="doc doc-contents ">

      <p>Configura un procesamiento de la respuesta.</p>

        <details class="quote">
          <summary>Source code in <code>centraal_client_flow/rules/integration/strategy.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="nf">set_response_processor</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span> <span class="n">processor</span><span class="p">:</span> <span class="n">Callable</span><span class="p">[[</span><span class="n">requests</span><span class="o">.</span><span class="n">Response</span><span class="p">,</span> <span class="n">BaseModel</span><span class="p">],</span> <span class="n">StrategyResult</span><span class="p">]</span>
<span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Configura un procesamiento de la respuesta.&quot;&quot;&quot;</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">response_processor</span> <span class="o">=</span> <span class="n">processor</span>
</code></pre></div>
        </details>
    </div>

  </div>





  </div>

    </div>

  </div>



  <div class="doc doc-object doc-class">



<h5 id="centraal_client_flow.rules.integration.strategy.StrategyResult" class="doc doc-heading">
        <code>
StrategyResult        </code>


  <span class="doc doc-properties">
      <small class="doc doc-property doc-property-dataclass"><code>dataclass</code></small>
  </span>

<a href="#centraal_client_flow.rules.integration.strategy.StrategyResult" class="headerlink" title="Permanent link">&para;</a></h5>

    <div class="doc doc-contents ">

      <p>Resultado de Estrategia.</p>

        <details class="quote">
          <summary>Source code in <code>centraal_client_flow/rules/integration/strategy.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="nd">@dataclass</span>
<span class="k">class</span> <span class="nc">StrategyResult</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Resultado de Estrategia.&quot;&quot;&quot;</span>

    <span class="n">success</span><span class="p">:</span> <span class="nb">bool</span>
    <span class="n">response</span><span class="p">:</span> <span class="nb">dict</span>
    <span class="n">bodysent</span><span class="p">:</span> <span class="nb">dict</span>
</code></pre></div>
        </details>



  <div class="doc doc-children">

















  </div>

    </div>

  </div>







  </div>

    </div>

  </div>



  <div class="doc doc-object doc-module">



<h4 id="centraal_client_flow.rules.integration.v2" class="doc doc-heading">
        <code>v2</code>



<a href="#centraal_client_flow.rules.integration.v2" class="headerlink" title="Permanent link">&para;</a></h4>

    <div class="doc doc-contents ">

      <p>Implementación de la regla de integración v2.</p>



  <div class="doc doc-children">







  <div class="doc doc-object doc-class">



<h5 id="centraal_client_flow.rules.integration.v2.IntegrationResult" class="doc doc-heading">
        <code>
IntegrationResult        </code>


  <span class="doc doc-properties">
      <small class="doc doc-property doc-property-dataclass"><code>dataclass</code></small>
  </span>

<a href="#centraal_client_flow.rules.integration.v2.IntegrationResult" class="headerlink" title="Permanent link">&para;</a></h5>

    <div class="doc doc-contents ">

      <p>Resultado de integración.</p>

        <details class="quote">
          <summary>Source code in <code>centraal_client_flow/rules/integration/v2.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="nd">@dataclass</span>
<span class="k">class</span> <span class="nc">IntegrationResult</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Resultado de integración.&quot;&quot;&quot;</span>

    <span class="n">success</span><span class="p">:</span> <span class="nb">bool</span>
    <span class="n">response</span><span class="p">:</span> <span class="nb">dict</span>
    <span class="n">bodysent</span><span class="p">:</span> <span class="nb">dict</span>

    <span class="k">def</span> <span class="nf">__post_init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Valida que bodysent no sea un diccionario vacío.&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">bodysent</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;bodysent no puede ser un diccionario vacío&quot;</span><span class="p">)</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">response</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;response no puede ser un diccionario vacío&quot;</span><span class="p">)</span>
</code></pre></div>
        </details>



  <div class="doc doc-children">














  <div class="doc doc-object doc-method">



<h6 id="centraal_client_flow.rules.integration.v2.IntegrationResult.__post_init__" class="doc doc-heading">
<code class="highlight language-python"><span class="n">__post_init__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span></code>

  <span class="doc doc-properties">
      <small class="doc doc-property doc-property-special"><code>special</code></small>
  </span>

<a href="#centraal_client_flow.rules.integration.v2.IntegrationResult.__post_init__" class="headerlink" title="Permanent link">&para;</a></h6>

    <div class="doc doc-contents ">

      <p>Valida que bodysent no sea un diccionario vacío.</p>

        <details class="quote">
          <summary>Source code in <code>centraal_client_flow/rules/integration/v2.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="nf">__post_init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Valida que bodysent no sea un diccionario vacío.&quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">bodysent</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;bodysent no puede ser un diccionario vacío&quot;</span><span class="p">)</span>

    <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">response</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;response no puede ser un diccionario vacío&quot;</span><span class="p">)</span>
</code></pre></div>
        </details>
    </div>

  </div>






  </div>

    </div>

  </div>



  <div class="doc doc-object doc-class">



<h5 id="centraal_client_flow.rules.integration.v2.IntegrationRule" class="doc doc-heading">
        <code>
IntegrationRule            (<span title="abc.ABC">ABC</span>)
        </code>



<a href="#centraal_client_flow.rules.integration.v2.IntegrationRule" class="headerlink" title="Permanent link">&para;</a></h5>

    <div class="doc doc-contents ">

      <p>Implementación de la regla de integración v2.
Esta implementación es una regla tiene el objetivo de simplicar la implementación,
se observa que en los casos de uso la estrategias de integración no son valiosas y dan
muy poca flexibilidad. Adicional en general las reglas de integración son un concpeto mas directo y
claro para representar la logica de transformación del modelo unficaido a lo que necesita el sistema
destino, esto ayudara a que el usuario implemente directamente la transformación y operaciones
necesarias sin necesidad de definirla en un objeto diferente.</p>
<p>La reglas integración se implementa como una clase abstracta con metodos compartidos, el usuario solo debera
implementar el metodo abstracto <code>integrate</code>, que debe recibir el mensaje del topic, codificarlo mediante el modelo unificado
y hacer la implemetación que requiera (inlcuido mapping o logicas adicionales para realizar la integración),
y el set de body_sent que se enviara a la auditoria de cosmos, par asaber que se envio al sistema destino.
con el unico requisito de devolver un IntegrationResult, que indicara el resultado
de la transformación.</p>
<p>la clase abstracta tendra la implementación de metodos concretos:
run: se encarga de ejecutar <code>integrate</code> y realizar el logging a la auditoria de cosmos.
register_log: se encarga de realizar el logging de la auditoria de cosmos.</p>

        <details class="quote">
          <summary>Source code in <code>centraal_client_flow/rules/integration/v2.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">class</span> <span class="nc">IntegrationRule</span><span class="p">(</span><span class="n">ABC</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Implementación de la regla de integración v2.</span>
<span class="sd">    Esta implementación es una regla tiene el objetivo de simplicar la implementación,</span>
<span class="sd">    se observa que en los casos de uso la estrategias de integración no son valiosas y dan</span>
<span class="sd">    muy poca flexibilidad. Adicional en general las reglas de integración son un concpeto mas directo y</span>
<span class="sd">    claro para representar la logica de transformación del modelo unficaido a lo que necesita el sistema</span>
<span class="sd">    destino, esto ayudara a que el usuario implemente directamente la transformación y operaciones</span>
<span class="sd">    necesarias sin necesidad de definirla en un objeto diferente.</span>

<span class="sd">    La reglas integración se implementa como una clase abstracta con metodos compartidos, el usuario solo debera</span>
<span class="sd">    implementar el metodo abstracto `integrate`, que debe recibir el mensaje del topic, codificarlo mediante el modelo unificado</span>
<span class="sd">    y hacer la implemetación que requiera (inlcuido mapping o logicas adicionales para realizar la integración),</span>
<span class="sd">    y el set de body_sent que se enviara a la auditoria de cosmos, par asaber que se envio al sistema destino.</span>
<span class="sd">    con el unico requisito de devolver un IntegrationResult, que indicara el resultado</span>
<span class="sd">    de la transformación.</span>

<span class="sd">    la clase abstracta tendra la implementación de metodos concretos:</span>
<span class="sd">    run: se encarga de ejecutar `integrate` y realizar el logging a la auditoria de cosmos.</span>
<span class="sd">    register_log: se encarga de realizar el logging de la auditoria de cosmos.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="n">model_unficado</span><span class="p">:</span> <span class="nb">type</span><span class="p">[</span><span class="n">EntradaEsquemaUnificado</span><span class="p">],</span>
        <span class="n">logger</span><span class="p">:</span> <span class="n">logging</span><span class="o">.</span><span class="n">Logger</span><span class="p">,</span>
        <span class="n">container_name_aud</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
    <span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Inicializa una regla de integración.</span>

<span class="sd">        Args:</span>
<span class="sd">            name: Nombre del topic de Service Bus que se utilizará para la integración.</span>
<span class="sd">            model_unficado: Modelo de esquema unificado para validar y mapear los mensajes recibidos.</span>
<span class="sd">            container_name_aud: Nombre del contenedor de la auditoria de cosmos.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="n">name</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">model_unficado</span> <span class="o">=</span> <span class="n">model_unficado</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">logger</span> <span class="o">=</span> <span class="n">logger</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">id_esquema</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">container_name_aud</span> <span class="o">=</span> <span class="n">container_name_aud</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">body_sent</span> <span class="o">=</span> <span class="p">{}</span>

    <span class="nd">@abstractmethod</span>
    <span class="k">def</span> <span class="nf">integrate</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">entrada_esquema_unificado</span><span class="p">:</span> <span class="n">EntradaEsquemaUnificado</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Optional</span><span class="p">[</span><span class="n">IntegrationResult</span><span class="p">]:</span>
        <span class="k">pass</span>

    <span class="k">def</span> <span class="nf">_validate_modelo_unificado</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">message</span><span class="p">:</span> <span class="nb">dict</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Union</span><span class="p">[</span><span class="n">IntegrationResult</span><span class="p">,</span> <span class="n">EntradaEsquemaUnificado</span><span class="p">]:</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">message_esquema</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">model_unficado</span><span class="o">.</span><span class="n">model_validate</span><span class="p">(</span><span class="n">message</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">id_esquema</span> <span class="o">=</span> <span class="n">message_esquema</span><span class="o">.</span><span class="n">id</span>
            <span class="k">return</span> <span class="n">message_esquema</span>

        <span class="k">except</span> <span class="n">ValidationError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="n">error_val_cosmos_friendly</span> <span class="o">=</span> <span class="n">serialize_validation_errors</span><span class="p">(</span><span class="n">e</span><span class="o">.</span><span class="n">errors</span><span class="p">())</span>
            <span class="n">response</span> <span class="o">=</span> <span class="n">built_valid_json_str_with_aditional_info</span><span class="p">(</span>
                <span class="n">error_val_cosmos_friendly</span><span class="p">,</span>
                <span class="sa">f</span><span class="s2">&quot;Mensaje no cumple con el esquema </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">model_unficado</span><span class="o">.</span><span class="vm">__name__</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
            <span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span>
                <span class="s2">&quot;Error en validación del modelo unificado </span><span class="si">%s</span><span class="s2">&quot;</span><span class="p">,</span>
                <span class="n">error_val_cosmos_friendly</span><span class="p">,</span>
                <span class="n">exc_info</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
            <span class="p">)</span>
            <span class="k">return</span> <span class="n">IntegrationResult</span><span class="p">(</span>
                <span class="n">success</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                <span class="n">response</span><span class="o">=</span><span class="n">response</span><span class="p">,</span>
                <span class="n">bodysent</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;error_validacion&quot;</span><span class="p">:</span> <span class="kc">True</span><span class="p">},</span>
            <span class="p">)</span>

    <span class="k">def</span> <span class="nf">run</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">message</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">ServiceBusMessage</span><span class="p">,</span> <span class="nb">dict</span><span class="p">],</span>
        <span class="n">cosmos_client</span><span class="p">:</span> <span class="n">CosmosDBSingleton</span><span class="p">,</span>
    <span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Ejecuta la regla de integración.&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">message</span><span class="p">,</span> <span class="n">ServiceBusMessage</span><span class="p">):</span>
            <span class="n">message</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">loads</span><span class="p">(</span><span class="n">message</span><span class="o">.</span><span class="n">get_body</span><span class="p">()</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="s2">&quot;utf-8&quot;</span><span class="p">))</span>

        <span class="n">message_esquema</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_validate_modelo_unificado</span><span class="p">(</span><span class="n">message</span><span class="p">)</span>

        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">message_esquema</span><span class="p">,</span> <span class="n">IntegrationResult</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;Error en validación del modelo unificado. Se recibe un mensaje no valido </span><span class="si">{</span><span class="n">message_esquema</span><span class="si">}</span><span class="s2">&quot;</span>
            <span class="p">)</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">id_esquema</span> <span class="o">=</span> <span class="n">message_esquema</span><span class="o">.</span><span class="n">id</span>
            <span class="n">result</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_retry_with_exponential_backoff</span><span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">integrate</span><span class="p">,</span> <span class="n">message_esquema</span>
            <span class="p">)</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">body_sent</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                    <span class="s2">&quot;No se ha definido el body_sent. Integrate debe setear el atributo body_sent.&quot;</span>
                <span class="p">)</span>
        <span class="k">except</span> <span class="n">ValidationError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>

            <span class="n">error_val_cosmos_friendly</span> <span class="o">=</span> <span class="n">serialize_validation_errors</span><span class="p">(</span><span class="n">e</span><span class="o">.</span><span class="n">errors</span><span class="p">())</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span>
                <span class="s2">&quot;Error de validación en integración </span><span class="si">%s</span><span class="s2">&quot;</span><span class="p">,</span>
                <span class="n">error_val_cosmos_friendly</span><span class="p">,</span>
                <span class="n">exc_info</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
            <span class="p">)</span>
            <span class="n">result</span> <span class="o">=</span> <span class="n">IntegrationResult</span><span class="p">(</span>
                <span class="n">success</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                <span class="n">response</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;error_validacion&quot;</span><span class="p">:</span> <span class="n">error_val_cosmos_friendly</span><span class="p">},</span>
                <span class="n">bodysent</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;error_validacion&quot;</span><span class="p">:</span> <span class="kc">True</span><span class="p">},</span>
            <span class="p">)</span>
        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span>
                <span class="s2">&quot;Error en integración </span><span class="si">%s</span><span class="s2">&quot;</span><span class="p">,</span>
                <span class="n">e</span><span class="p">,</span>
                <span class="n">exc_info</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
            <span class="p">)</span>
            <span class="k">raise</span> <span class="n">e</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">register_log</span><span class="p">(</span><span class="n">result</span><span class="p">,</span> <span class="n">cosmos_client</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">result</span>

    <span class="k">def</span> <span class="nf">register_log</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">result</span><span class="p">:</span> <span class="n">IntegrationResult</span><span class="p">,</span>
        <span class="n">cosmos_client</span><span class="p">:</span> <span class="n">CosmosDBSingleton</span><span class="p">,</span>
    <span class="p">):</span>
        <span class="n">container</span> <span class="o">=</span> <span class="n">cosmos_client</span><span class="o">.</span><span class="n">get_container_client</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">container_name_aud</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">id_esquema</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">entry</span> <span class="o">=</span> <span class="n">AuditoriaEntryIntegracion</span><span class="p">(</span>
                <span class="nb">id</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">id_esquema</span><span class="p">,</span>
                <span class="n">regla</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">,</span>
                <span class="n">contenido</span><span class="o">=</span><span class="n">result</span><span class="o">.</span><span class="n">bodysent</span><span class="p">,</span>
                <span class="n">sucess</span><span class="o">=</span><span class="n">result</span><span class="o">.</span><span class="n">success</span><span class="p">,</span>
                <span class="n">response</span><span class="o">=</span><span class="n">result</span><span class="o">.</span><span class="n">response</span><span class="p">,</span>
            <span class="p">)</span>
            <span class="n">item_written</span> <span class="o">=</span> <span class="n">container</span><span class="o">.</span><span class="n">upsert_item</span><span class="p">(</span>
                <span class="n">entry</span><span class="o">.</span><span class="n">model_dump</span><span class="p">(</span><span class="n">mode</span><span class="o">=</span><span class="s2">&quot;json&quot;</span><span class="p">,</span> <span class="n">exclude_none</span><span class="o">=</span><span class="kc">True</span><span class="p">),</span>
            <span class="p">)</span>
            <span class="k">return</span> <span class="n">item_written</span>

        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;No es posible usar registro del log.&quot;</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_retry_with_exponential_backoff</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">func</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="n">max_retries</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">base_delay</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span>
    <span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Retries a function with exponential backoff.&quot;&quot;&quot;</span>
        <span class="k">for</span> <span class="n">attempt</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">max_retries</span><span class="p">):</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">func</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
            <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">attempt</span> <span class="o">&lt;</span> <span class="n">max_retries</span> <span class="o">-</span> <span class="mi">1</span><span class="p">:</span>
                    <span class="n">delay</span> <span class="o">=</span> <span class="n">base_delay</span> <span class="o">*</span> <span class="p">(</span><span class="mi">2</span><span class="o">**</span><span class="n">attempt</span><span class="p">)</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span>
                        <span class="s2">&quot;Retrying due to error: </span><span class="si">%s</span><span class="s2">. Attempt </span><span class="si">%d</span><span class="s2">/</span><span class="si">%d</span><span class="s2">. Retrying in </span><span class="si">%d</span><span class="s2"> seconds...&quot;</span><span class="p">,</span>
                        <span class="n">e</span><span class="p">,</span>
                        <span class="n">attempt</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span>
                        <span class="n">max_retries</span><span class="p">,</span>
                        <span class="n">delay</span><span class="p">,</span>
                    <span class="p">)</span>
                    <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="n">delay</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span>
                        <span class="s2">&quot;Max retries reached. Last error: </span><span class="si">%s</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">e</span><span class="p">,</span> <span class="n">exc_info</span><span class="o">=</span><span class="kc">True</span>
                    <span class="p">)</span>
                    <span class="k">raise</span> <span class="n">e</span>
</code></pre></div>
        </details>



  <div class="doc doc-children">









  <div class="doc doc-object doc-method">



<h6 id="centraal_client_flow.rules.integration.v2.IntegrationRule.__init__" class="doc doc-heading">
<code class="highlight language-python"><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">model_unficado</span><span class="p">,</span> <span class="n">logger</span><span class="p">,</span> <span class="n">container_name_aud</span><span class="p">)</span></code>

  <span class="doc doc-properties">
      <small class="doc doc-property doc-property-special"><code>special</code></small>
  </span>

<a href="#centraal_client_flow.rules.integration.v2.IntegrationRule.__init__" class="headerlink" title="Permanent link">&para;</a></h6>

    <div class="doc doc-contents ">

      <p>Inicializa una regla de integración.</p>

<p><strong>Parameters:</strong></p>
<table>
  <thead>
    <tr>
      <th>Name</th>
      <th>Type</th>
      <th>Description</th>
      <th>Default</th>
    </tr>
  </thead>
  <tbody>
      <tr>
        <td><code>name</code></td>
        <td><code>str</code></td>
        <td><p>Nombre del topic de Service Bus que se utilizará para la integración.</p></td>
        <td><em>required</em></td>
      </tr>
      <tr>
        <td><code>model_unficado</code></td>
        <td><code>type[centraal_client_flow.models.schemas.EntradaEsquemaUnificado]</code></td>
        <td><p>Modelo de esquema unificado para validar y mapear los mensajes recibidos.</p></td>
        <td><em>required</em></td>
      </tr>
      <tr>
        <td><code>container_name_aud</code></td>
        <td><code>str</code></td>
        <td><p>Nombre del contenedor de la auditoria de cosmos.</p></td>
        <td><em>required</em></td>
      </tr>
  </tbody>
</table>
        <details class="quote">
          <summary>Source code in <code>centraal_client_flow/rules/integration/v2.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="n">name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
    <span class="n">model_unficado</span><span class="p">:</span> <span class="nb">type</span><span class="p">[</span><span class="n">EntradaEsquemaUnificado</span><span class="p">],</span>
    <span class="n">logger</span><span class="p">:</span> <span class="n">logging</span><span class="o">.</span><span class="n">Logger</span><span class="p">,</span>
    <span class="n">container_name_aud</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
<span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Inicializa una regla de integración.</span>

<span class="sd">    Args:</span>
<span class="sd">        name: Nombre del topic de Service Bus que se utilizará para la integración.</span>
<span class="sd">        model_unficado: Modelo de esquema unificado para validar y mapear los mensajes recibidos.</span>
<span class="sd">        container_name_aud: Nombre del contenedor de la auditoria de cosmos.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="n">name</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">model_unficado</span> <span class="o">=</span> <span class="n">model_unficado</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">logger</span> <span class="o">=</span> <span class="n">logger</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">id_esquema</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">container_name_aud</span> <span class="o">=</span> <span class="n">container_name_aud</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">body_sent</span> <span class="o">=</span> <span class="p">{}</span>
</code></pre></div>
        </details>
    </div>

  </div>





  <div class="doc doc-object doc-method">



<h6 id="centraal_client_flow.rules.integration.v2.IntegrationRule.run" class="doc doc-heading">
<code class="highlight language-python"><span class="n">run</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">message</span><span class="p">,</span> <span class="n">cosmos_client</span><span class="p">)</span></code>


<a href="#centraal_client_flow.rules.integration.v2.IntegrationRule.run" class="headerlink" title="Permanent link">&para;</a></h6>

    <div class="doc doc-contents ">

      <p>Ejecuta la regla de integración.</p>

        <details class="quote">
          <summary>Source code in <code>centraal_client_flow/rules/integration/v2.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="nf">run</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="n">message</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">ServiceBusMessage</span><span class="p">,</span> <span class="nb">dict</span><span class="p">],</span>
    <span class="n">cosmos_client</span><span class="p">:</span> <span class="n">CosmosDBSingleton</span><span class="p">,</span>
<span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Ejecuta la regla de integración.&quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">message</span><span class="p">,</span> <span class="n">ServiceBusMessage</span><span class="p">):</span>
        <span class="n">message</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">loads</span><span class="p">(</span><span class="n">message</span><span class="o">.</span><span class="n">get_body</span><span class="p">()</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="s2">&quot;utf-8&quot;</span><span class="p">))</span>

    <span class="n">message_esquema</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_validate_modelo_unificado</span><span class="p">(</span><span class="n">message</span><span class="p">)</span>

    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">message_esquema</span><span class="p">,</span> <span class="n">IntegrationResult</span><span class="p">):</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
            <span class="sa">f</span><span class="s2">&quot;Error en validación del modelo unificado. Se recibe un mensaje no valido </span><span class="si">{</span><span class="n">message_esquema</span><span class="si">}</span><span class="s2">&quot;</span>
        <span class="p">)</span>

    <span class="k">try</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">id_esquema</span> <span class="o">=</span> <span class="n">message_esquema</span><span class="o">.</span><span class="n">id</span>
        <span class="n">result</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_retry_with_exponential_backoff</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">integrate</span><span class="p">,</span> <span class="n">message_esquema</span>
        <span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">body_sent</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                <span class="s2">&quot;No se ha definido el body_sent. Integrate debe setear el atributo body_sent.&quot;</span>
            <span class="p">)</span>
    <span class="k">except</span> <span class="n">ValidationError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>

        <span class="n">error_val_cosmos_friendly</span> <span class="o">=</span> <span class="n">serialize_validation_errors</span><span class="p">(</span><span class="n">e</span><span class="o">.</span><span class="n">errors</span><span class="p">())</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span>
            <span class="s2">&quot;Error de validación en integración </span><span class="si">%s</span><span class="s2">&quot;</span><span class="p">,</span>
            <span class="n">error_val_cosmos_friendly</span><span class="p">,</span>
            <span class="n">exc_info</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="n">result</span> <span class="o">=</span> <span class="n">IntegrationResult</span><span class="p">(</span>
            <span class="n">success</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
            <span class="n">response</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;error_validacion&quot;</span><span class="p">:</span> <span class="n">error_val_cosmos_friendly</span><span class="p">},</span>
            <span class="n">bodysent</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;error_validacion&quot;</span><span class="p">:</span> <span class="kc">True</span><span class="p">},</span>
        <span class="p">)</span>
    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span>
            <span class="s2">&quot;Error en integración </span><span class="si">%s</span><span class="s2">&quot;</span><span class="p">,</span>
            <span class="n">e</span><span class="p">,</span>
            <span class="n">exc_info</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="k">raise</span> <span class="n">e</span>

    <span class="bp">self</span><span class="o">.</span><span class="n">register_log</span><span class="p">(</span><span class="n">result</span><span class="p">,</span> <span class="n">cosmos_client</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">result</span>
</code></pre></div>
        </details>
    </div>

  </div>





  </div>

    </div>

  </div>







  </div>

    </div>

  </div>




  </div>

    </div>

  </div>



  <div class="doc doc-object doc-module">



<h3 id="centraal_client_flow.rules.update" class="doc doc-heading">
        <code>update</code>



<a href="#centraal_client_flow.rules.update" class="headerlink" title="Permanent link">&para;</a></h3>

    <div class="doc doc-contents ">

      <p>Módulo para las reglas de actualización.</p>



  <div class="doc doc-children">







  <div class="doc doc-object doc-class">



<h4 id="centraal_client_flow.rules.update.Rule" class="doc doc-heading">
        <code>
Rule        </code>


  <span class="doc doc-properties">
      <small class="doc doc-property doc-property-dataclass"><code>dataclass</code></small>
  </span>

<a href="#centraal_client_flow.rules.update.Rule" class="headerlink" title="Permanent link">&para;</a></h4>

    <div class="doc doc-contents ">

      <p>Representa una regla de procesamiento que asocia un modelo Pydantic con un procesador
    y los tópicos relevantes.</p>

<p><strong>Attributes:</strong></p>
<table>
  <thead>
    <tr>
      <th>Name</th>
      <th>Type</th>
      <th>Description</th>
    </tr>
  </thead>
  <tbody>
      <tr>
        <td><code>model</code></td>
        <td><code>Type[centraal_client_flow.models.schemas.EventoBase]</code></td>
        <td><p>El tipo de modelo Pydantic que la regla procesa.</p></td>
      </tr>
      <tr>
        <td><code>processor</code></td>
        <td><code>UpdateProcessor</code></td>
        <td><p>El procesador que manejará la lógica de actualización.</p></td>
      </tr>
      <tr>
        <td><code>topics</code></td>
        <td><code>Set[str]</code></td>
        <td><p>Los tópicos a los que la regla está asociada.</p></td>
      </tr>
      <tr>
        <td><code>name</code></td>
        <td><code>str</code></td>
        <td><p>El nombre asignado a la regla basado en el nombre de la clase del modelo.</p></td>
      </tr>
  </tbody>
</table>
        <details class="quote">
          <summary>Source code in <code>centraal_client_flow/rules/update.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="nd">@dataclass</span>
<span class="k">class</span> <span class="nc">Rule</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Representa una regla de procesamiento que asocia un modelo Pydantic con un procesador</span>
<span class="sd">        y los tópicos relevantes.</span>

<span class="sd">    Attributes:</span>
<span class="sd">        model: El tipo de modelo Pydantic que la regla procesa.</span>
<span class="sd">        processor: El procesador que manejará la lógica de actualización.</span>
<span class="sd">        topics: Los tópicos a los que la regla está asociada.</span>
<span class="sd">        name: El nombre asignado a la regla basado en el nombre de la clase del modelo.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">model</span><span class="p">:</span> <span class="n">Type</span><span class="p">[</span><span class="n">EventoBase</span><span class="p">]</span>
    <span class="n">processor</span><span class="p">:</span> <span class="n">UpdateProcessor</span>
    <span class="n">topics</span><span class="p">:</span> <span class="n">Set</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span>
    <span class="n">name</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>

    <span class="k">def</span> <span class="nf">__post_init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Inicializa el nombre de la regla basado en el nombre de la clase del modelo.&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="vm">__name__</span>

    <span class="k">def</span> <span class="nf">process_rule</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">data</span><span class="p">:</span> <span class="n">EventoBase</span><span class="p">,</span> <span class="n">current</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">EntradaEsquemaUnificado</span><span class="p">]</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">EntradaEsquemaUnificado</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Procesa una entrada de datos usando la regla definida.</span>

<span class="sd">        Parameters:</span>
<span class="sd">            data: El evento que se procesará.</span>
<span class="sd">            current: El registro actual a ser actualizado.</span>

<span class="sd">        Returns:</span>
<span class="sd">            EntradaEsquemaUnificado: El registro actualizado.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">data_copy</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">model_copy</span><span class="p">(</span><span class="n">deep</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="n">current_copy</span> <span class="o">=</span> <span class="n">current</span><span class="o">.</span><span class="n">model_copy</span><span class="p">(</span><span class="n">deep</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span> <span class="k">if</span> <span class="n">current</span> <span class="k">else</span> <span class="kc">None</span>
        <span class="n">result</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">processor</span><span class="o">.</span><span class="n">process_message</span><span class="p">(</span><span class="n">data_copy</span><span class="p">,</span> <span class="n">current_copy</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">result</span>
</code></pre></div>
        </details>



  <div class="doc doc-children">















  <div class="doc doc-object doc-method">



<h5 id="centraal_client_flow.rules.update.Rule.__post_init__" class="doc doc-heading">
<code class="highlight language-python"><span class="n">__post_init__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span></code>

  <span class="doc doc-properties">
      <small class="doc doc-property doc-property-special"><code>special</code></small>
  </span>

<a href="#centraal_client_flow.rules.update.Rule.__post_init__" class="headerlink" title="Permanent link">&para;</a></h5>

    <div class="doc doc-contents ">

      <p>Inicializa el nombre de la regla basado en el nombre de la clase del modelo.</p>

        <details class="quote">
          <summary>Source code in <code>centraal_client_flow/rules/update.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="nf">__post_init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Inicializa el nombre de la regla basado en el nombre de la clase del modelo.&quot;&quot;&quot;</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="vm">__name__</span>
</code></pre></div>
        </details>
    </div>

  </div>




  <div class="doc doc-object doc-method">



<h5 id="centraal_client_flow.rules.update.Rule.process_rule" class="doc doc-heading">
<code class="highlight language-python"><span class="n">process_rule</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data</span><span class="p">,</span> <span class="n">current</span><span class="p">)</span></code>


<a href="#centraal_client_flow.rules.update.Rule.process_rule" class="headerlink" title="Permanent link">&para;</a></h5>

    <div class="doc doc-contents ">

      <p>Procesa una entrada de datos usando la regla definida.</p>

<p><strong>Parameters:</strong></p>
<table>
  <thead>
    <tr>
      <th>Name</th>
      <th>Type</th>
      <th>Description</th>
      <th>Default</th>
    </tr>
  </thead>
  <tbody>
      <tr>
        <td><code>data</code></td>
        <td><code>EventoBase</code></td>
        <td><p>El evento que se procesará.</p></td>
        <td><em>required</em></td>
      </tr>
      <tr>
        <td><code>current</code></td>
        <td><code>Optional[centraal_client_flow.models.schemas.EntradaEsquemaUnificado]</code></td>
        <td><p>El registro actual a ser actualizado.</p></td>
        <td><em>required</em></td>
      </tr>
  </tbody>
</table>
<p><strong>Returns:</strong></p>
<table>
  <thead>
    <tr>
      <th>Type</th>
      <th>Description</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td><code>EntradaEsquemaUnificado</code></td>
      <td><p>El registro actualizado.</p></td>
    </tr>
  </tbody>
</table>
        <details class="quote">
          <summary>Source code in <code>centraal_client_flow/rules/update.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="nf">process_rule</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span> <span class="n">data</span><span class="p">:</span> <span class="n">EventoBase</span><span class="p">,</span> <span class="n">current</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">EntradaEsquemaUnificado</span><span class="p">]</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">EntradaEsquemaUnificado</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Procesa una entrada de datos usando la regla definida.</span>

<span class="sd">    Parameters:</span>
<span class="sd">        data: El evento que se procesará.</span>
<span class="sd">        current: El registro actual a ser actualizado.</span>

<span class="sd">    Returns:</span>
<span class="sd">        EntradaEsquemaUnificado: El registro actualizado.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">data_copy</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">model_copy</span><span class="p">(</span><span class="n">deep</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">current_copy</span> <span class="o">=</span> <span class="n">current</span><span class="o">.</span><span class="n">model_copy</span><span class="p">(</span><span class="n">deep</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span> <span class="k">if</span> <span class="n">current</span> <span class="k">else</span> <span class="kc">None</span>
    <span class="n">result</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">processor</span><span class="o">.</span><span class="n">process_message</span><span class="p">(</span><span class="n">data_copy</span><span class="p">,</span> <span class="n">current_copy</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">result</span>
</code></pre></div>
        </details>
    </div>

  </div>





  </div>

    </div>

  </div>



  <div class="doc doc-object doc-class">



<h4 id="centraal_client_flow.rules.update.RuleProcessor" class="doc doc-heading">
        <code>
RuleProcessor        </code>



<a href="#centraal_client_flow.rules.update.RuleProcessor" class="headerlink" title="Permanent link">&para;</a></h4>

    <div class="doc doc-contents ">

      <p>Clase que orquesta el procesamiento de reglas y la interacción con Service Bus y Cosmos DB.</p>

        <details class="quote">
          <summary>Source code in <code>centraal_client_flow/rules/update.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">class</span> <span class="nc">RuleProcessor</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Clase que orquesta el procesamiento de reglas y la interacción con Service Bus y Cosmos DB.&quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">queue_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="n">unified_container_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="n">auditoria_container_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="n">service_bus_client</span><span class="p">:</span> <span class="n">IServiceBusClient</span><span class="p">,</span>
        <span class="n">cosmos_client</span><span class="p">:</span> <span class="n">CosmosDBSingleton</span><span class="p">,</span>
        <span class="n">rule_selector</span><span class="p">:</span> <span class="n">RuleSelector</span><span class="p">,</span>
    <span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">queue_name</span> <span class="o">=</span> <span class="n">queue_name</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">unified_container_name</span> <span class="o">=</span> <span class="n">unified_container_name</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">auditoria_container_name</span> <span class="o">=</span> <span class="n">auditoria_container_name</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">service_bus_client</span> <span class="o">=</span> <span class="n">service_bus_client</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">cosmos_client</span> <span class="o">=</span> <span class="n">cosmos_client</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">rule_selector</span> <span class="o">=</span> <span class="n">rule_selector</span>

    <span class="k">def</span> <span class="nf">save_unified_model</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">new_data</span><span class="p">:</span> <span class="n">EntradaEsquemaUnificado</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Guarda el modelo de EntradaEsquemaUnificado actualizado en Cosmos DB.</span>

<span class="sd">        Parameters:</span>
<span class="sd">            new_data: El modelo actualizado de EntradaEsquemaUnificado.</span>

<span class="sd">        Returns:</span>
<span class="sd">            EntradaEsquemaUnificado: El modelo almacenado en la base de datos.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">container</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cosmos_client</span><span class="o">.</span><span class="n">get_container_client</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">unified_container_name</span><span class="p">)</span>
        <span class="n">item_written</span> <span class="o">=</span> <span class="n">container</span><span class="o">.</span><span class="n">upsert_item</span><span class="p">(</span>
            <span class="n">new_data</span><span class="o">.</span><span class="n">model_dump</span><span class="p">(</span><span class="n">mode</span><span class="o">=</span><span class="s2">&quot;json&quot;</span><span class="p">,</span> <span class="n">exclude_none</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="p">)</span>
        <span class="k">return</span> <span class="n">item_written</span>

    <span class="k">def</span> <span class="nf">record_auditoria</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">changes</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">AuditoriaEntry</span><span class="p">]):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Registra los cambios detectados en el contenedor de auditoría de Cosmos DB.</span>

<span class="sd">        Parameters:</span>
<span class="sd">            changes: Lista de entradas de auditoría que contienen los cambios detectados.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">container</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cosmos_client</span><span class="o">.</span><span class="n">get_container_client</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">auditoria_container_name</span>
        <span class="p">)</span>
        <span class="k">for</span> <span class="n">change</span> <span class="ow">in</span> <span class="n">changes</span><span class="p">:</span>
            <span class="n">container</span><span class="o">.</span><span class="n">create_item</span><span class="p">(</span>
                <span class="n">change</span><span class="o">.</span><span class="n">model_dump</span><span class="p">(</span><span class="n">mode</span><span class="o">=</span><span class="s2">&quot;json&quot;</span><span class="p">,</span> <span class="n">exclude_none</span><span class="o">=</span><span class="kc">True</span><span class="p">),</span>
                <span class="n">enable_automatic_id_generation</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
            <span class="p">)</span>

    <span class="k">def</span> <span class="nf">get_current_entrada</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">id_entrada</span><span class="p">:</span> <span class="n">IDModel</span><span class="p">,</span> <span class="n">model_unificado</span><span class="p">:</span> <span class="n">EntradaEsquemaUnificado</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Optional</span><span class="p">[</span><span class="n">EntradaEsquemaUnificado</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Recupera el registro actual desde Cosmos DB basado en el ID proporcionado.</span>

<span class="sd">        Parameters:</span>
<span class="sd">            id_entrada: El ID del registro que se desea recuperar.</span>

<span class="sd">        Returns:</span>
<span class="sd">            Optional[EntradaEsquemaUnificado]: El registro actual, si existe.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">container</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cosmos_client</span><span class="o">.</span><span class="n">get_container_client</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">unified_container_name</span><span class="p">)</span>
        <span class="n">query</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;SELECT * FROM c WHERE c.id = &#39;</span><span class="si">{</span><span class="n">id_entrada</span><span class="o">.</span><span class="n">model_dump</span><span class="p">()</span><span class="si">}</span><span class="s2">&#39;&quot;</span>
        <span class="n">current_items</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span>
            <span class="n">container</span><span class="o">.</span><span class="n">query_items</span><span class="p">(</span><span class="n">query</span><span class="p">,</span> <span class="n">enable_cross_partition_query</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="p">)</span>

        <span class="k">if</span> <span class="n">current_items</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">model_unificado</span><span class="o">.</span><span class="n">model_validate</span><span class="p">(</span><span class="n">current_items</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
        <span class="k">return</span> <span class="kc">None</span>

    <span class="k">def</span> <span class="nf">detect_changes</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">current_data</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">EntradaEsquemaUnificado</span><span class="p">],</span>
        <span class="n">updated_data</span><span class="p">:</span> <span class="n">EntradaEsquemaUnificado</span><span class="p">,</span>
        <span class="n">id_model</span><span class="p">:</span> <span class="n">IDModel</span><span class="p">,</span>
        <span class="n">regla_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="n">AuditoriaEntry</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Detecta cambios entre los datos actuales y los actualizados en el modelo EntradaEsquemaUnificado.</span>

<span class="sd">        Parameters:</span>
<span class="sd">            current_data: Los datos actuales en la base de datos.</span>
<span class="sd">            updated_data: Los datos actualizados a comparar.</span>
<span class="sd">            id_model: El ID del modelo que se está procesando.</span>

<span class="sd">        Returns:</span>
<span class="sd">            List[AuditoriaEntry]: Lista de entradas de auditoría que reflejan los cambios detectados.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">changes</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="k">def</span> <span class="nf">_log_changes</span><span class="p">(</span>
            <span class="n">subesquema_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">old_value</span><span class="p">:</span> <span class="n">Any</span><span class="p">,</span> <span class="n">new_value</span><span class="p">:</span> <span class="n">Any</span><span class="p">,</span> <span class="n">field_name</span><span class="p">:</span> <span class="nb">str</span>
        <span class="p">):</span>
<span class="w">            </span><span class="sd">&quot;&quot;&quot;Función auxiliar para registrar cambios detectados.&quot;&quot;&quot;</span>
            <span class="n">changes</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
                <span class="n">AuditoriaEntry</span><span class="p">(</span>
                    <span class="n">id_entrada</span><span class="o">=</span><span class="n">id_model</span><span class="p">,</span>
                    <span class="n">subesquema</span><span class="o">=</span><span class="n">subesquema_name</span><span class="p">,</span>
                    <span class="n">campo</span><span class="o">=</span><span class="n">field_name</span><span class="p">,</span>
                    <span class="n">new_value</span><span class="o">=</span><span class="n">new_value</span><span class="p">,</span>
                    <span class="n">old_value</span><span class="o">=</span><span class="n">old_value</span><span class="p">,</span>
                    <span class="n">regla</span><span class="o">=</span><span class="n">regla_name</span><span class="p">,</span>
                <span class="p">)</span>
            <span class="p">)</span>

        <span class="k">if</span> <span class="n">current_data</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="c1"># No hay datos actuales, se registran todos los campos como cambios</span>
            <span class="k">for</span> <span class="n">field_name</span> <span class="ow">in</span> <span class="n">updated_data</span><span class="o">.</span><span class="n">model_fields_set</span><span class="p">:</span>
                <span class="n">new_value</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">updated_data</span><span class="p">,</span> <span class="n">field_name</span><span class="p">)</span>
                <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">new_value</span><span class="p">,</span> <span class="n">BaseModel</span><span class="p">)</span> <span class="ow">and</span> <span class="ow">not</span> <span class="p">(</span>
                    <span class="nb">isinstance</span><span class="p">(</span><span class="n">new_value</span><span class="p">,</span> <span class="n">IDModel</span><span class="p">)</span>
                <span class="p">):</span>
                    <span class="c1"># Es un modelo Pydantic anidado (subesquema)</span>
                    <span class="k">for</span> <span class="n">sub_field_name</span> <span class="ow">in</span> <span class="n">new_value</span><span class="o">.</span><span class="n">model_fields_set</span><span class="p">:</span>
                        <span class="n">sub_field_value</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">new_value</span><span class="p">,</span> <span class="n">sub_field_name</span><span class="p">)</span>
                        <span class="n">_log_changes</span><span class="p">(</span><span class="n">field_name</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="n">sub_field_value</span><span class="p">,</span> <span class="n">sub_field_name</span><span class="p">)</span>

                <span class="k">else</span><span class="p">:</span>
                    <span class="c1"># Si es principal es &quot;root&quot;</span>
                    <span class="n">_log_changes</span><span class="p">(</span><span class="s2">&quot;root&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="n">new_value</span><span class="p">,</span> <span class="n">field_name</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">field_name</span> <span class="ow">in</span> <span class="n">updated_data</span><span class="o">.</span><span class="n">model_fields_set</span><span class="p">:</span>
                <span class="n">old_value</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">current_data</span><span class="p">,</span> <span class="n">field_name</span><span class="p">)</span>
                <span class="n">new_value</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">updated_data</span><span class="p">,</span> <span class="n">field_name</span><span class="p">)</span>
                <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">new_value</span><span class="p">,</span> <span class="n">BaseModel</span><span class="p">):</span>
                    <span class="c1"># Es un modelo Pydantic anidado (subesquema)</span>
                    <span class="k">for</span> <span class="n">sub_field_name</span> <span class="ow">in</span> <span class="n">new_value</span><span class="o">.</span><span class="n">model_fields_set</span><span class="p">:</span>
                        <span class="n">sub_old_value</span> <span class="o">=</span> <span class="p">(</span>
                            <span class="nb">getattr</span><span class="p">(</span><span class="n">old_value</span><span class="p">,</span> <span class="n">sub_field_name</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
                            <span class="k">if</span> <span class="n">old_value</span>
                            <span class="k">else</span> <span class="kc">None</span>
                        <span class="p">)</span>
                        <span class="n">sub_new_value</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">new_value</span><span class="p">,</span> <span class="n">sub_field_name</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
                        <span class="k">if</span> <span class="n">sub_old_value</span> <span class="o">!=</span> <span class="n">sub_new_value</span><span class="p">:</span>
                            <span class="n">_log_changes</span><span class="p">(</span>
                                <span class="n">field_name</span><span class="p">,</span> <span class="n">sub_old_value</span><span class="p">,</span> <span class="n">sub_new_value</span><span class="p">,</span> <span class="n">sub_field_name</span>
                            <span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">old_value</span> <span class="o">!=</span> <span class="n">new_value</span><span class="p">:</span>
                        <span class="n">_log_changes</span><span class="p">(</span><span class="s2">&quot;root&quot;</span><span class="p">,</span> <span class="n">old_value</span><span class="p">,</span> <span class="n">new_value</span><span class="p">,</span> <span class="n">field_name</span><span class="p">)</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">changes</span><span class="p">:</span>
            <span class="n">changes</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
                <span class="n">AuditoriaEntry</span><span class="p">(</span>
                    <span class="n">id_entrada</span><span class="o">=</span><span class="n">id_model</span><span class="p">,</span>
                    <span class="n">subesquema</span><span class="o">=</span><span class="s2">&quot;No Changes&quot;</span><span class="p">,</span>
                    <span class="n">campo</span><span class="o">=</span><span class="s2">&quot;Ninguno&quot;</span><span class="p">,</span>
                    <span class="n">new_value</span><span class="o">=</span><span class="s2">&quot;No cambios&quot;</span><span class="p">,</span>
                    <span class="n">old_value</span><span class="o">=</span><span class="s2">&quot;No cambios&quot;</span><span class="p">,</span>
                    <span class="n">regla</span><span class="o">=</span><span class="n">regla_name</span><span class="p">,</span>
                <span class="p">)</span>
            <span class="p">)</span>

        <span class="k">return</span> <span class="n">changes</span>

    <span class="k">def</span> <span class="nf">publish_to_topics</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">processed_data</span><span class="p">:</span> <span class="n">EntradaEsquemaUnificado</span><span class="p">,</span>
        <span class="n">topic_names</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">],</span>
    <span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Publica los datos procesados a los tópicos de Service Bus relevantes.</span>

<span class="sd">        Parameters:</span>
<span class="sd">            processed_data: Los datos procesados que se enviarán.</span>
<span class="sd">            topic_names: Lista de tópicos a los que se enviarán los datos.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">client</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">service_bus_client</span><span class="o">.</span><span class="n">client</span>
        <span class="k">for</span> <span class="n">topic_name</span> <span class="ow">in</span> <span class="n">topic_names</span><span class="p">:</span>
            <span class="n">body</span> <span class="o">=</span> <span class="n">processed_data</span><span class="o">.</span><span class="n">model_dump</span><span class="p">(</span><span class="n">mode</span><span class="o">=</span><span class="s2">&quot;json&quot;</span><span class="p">,</span> <span class="n">exclude_none</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
            <span class="k">with</span> <span class="n">client</span><span class="o">.</span><span class="n">get_topic_sender</span><span class="p">(</span><span class="n">topic_name</span><span class="o">=</span><span class="n">topic_name</span><span class="p">)</span> <span class="k">as</span> <span class="n">sender</span><span class="p">:</span>
                <span class="n">message</span> <span class="o">=</span> <span class="n">SBMessage</span><span class="p">(</span><span class="n">body</span><span class="o">=</span><span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">body</span><span class="p">))</span>
                <span class="n">sender</span><span class="o">.</span><span class="n">send_messages</span><span class="p">(</span><span class="n">message</span><span class="p">)</span>
</code></pre></div>
        </details>



  <div class="doc doc-children">










  <div class="doc doc-object doc-method">



<h5 id="centraal_client_flow.rules.update.RuleProcessor.detect_changes" class="doc doc-heading">
<code class="highlight language-python"><span class="n">detect_changes</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">current_data</span><span class="p">,</span> <span class="n">updated_data</span><span class="p">,</span> <span class="n">id_model</span><span class="p">,</span> <span class="n">regla_name</span><span class="p">)</span></code>


<a href="#centraal_client_flow.rules.update.RuleProcessor.detect_changes" class="headerlink" title="Permanent link">&para;</a></h5>

    <div class="doc doc-contents ">

      <p>Detecta cambios entre los datos actuales y los actualizados en el modelo EntradaEsquemaUnificado.</p>

<p><strong>Parameters:</strong></p>
<table>
  <thead>
    <tr>
      <th>Name</th>
      <th>Type</th>
      <th>Description</th>
      <th>Default</th>
    </tr>
  </thead>
  <tbody>
      <tr>
        <td><code>current_data</code></td>
        <td><code>Optional[centraal_client_flow.models.schemas.EntradaEsquemaUnificado]</code></td>
        <td><p>Los datos actuales en la base de datos.</p></td>
        <td><em>required</em></td>
      </tr>
      <tr>
        <td><code>updated_data</code></td>
        <td><code>EntradaEsquemaUnificado</code></td>
        <td><p>Los datos actualizados a comparar.</p></td>
        <td><em>required</em></td>
      </tr>
      <tr>
        <td><code>id_model</code></td>
        <td><code>IDModel</code></td>
        <td><p>El ID del modelo que se está procesando.</p></td>
        <td><em>required</em></td>
      </tr>
  </tbody>
</table>
<p><strong>Returns:</strong></p>
<table>
  <thead>
    <tr>
      <th>Type</th>
      <th>Description</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td><code>List[AuditoriaEntry]</code></td>
      <td><p>Lista de entradas de auditoría que reflejan los cambios detectados.</p></td>
    </tr>
  </tbody>
</table>
        <details class="quote">
          <summary>Source code in <code>centraal_client_flow/rules/update.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="nf">detect_changes</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="n">current_data</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">EntradaEsquemaUnificado</span><span class="p">],</span>
    <span class="n">updated_data</span><span class="p">:</span> <span class="n">EntradaEsquemaUnificado</span><span class="p">,</span>
    <span class="n">id_model</span><span class="p">:</span> <span class="n">IDModel</span><span class="p">,</span>
    <span class="n">regla_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="n">AuditoriaEntry</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Detecta cambios entre los datos actuales y los actualizados en el modelo EntradaEsquemaUnificado.</span>

<span class="sd">    Parameters:</span>
<span class="sd">        current_data: Los datos actuales en la base de datos.</span>
<span class="sd">        updated_data: Los datos actualizados a comparar.</span>
<span class="sd">        id_model: El ID del modelo que se está procesando.</span>

<span class="sd">    Returns:</span>
<span class="sd">        List[AuditoriaEntry]: Lista de entradas de auditoría que reflejan los cambios detectados.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">changes</span> <span class="o">=</span> <span class="p">[]</span>

    <span class="k">def</span> <span class="nf">_log_changes</span><span class="p">(</span>
        <span class="n">subesquema_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">old_value</span><span class="p">:</span> <span class="n">Any</span><span class="p">,</span> <span class="n">new_value</span><span class="p">:</span> <span class="n">Any</span><span class="p">,</span> <span class="n">field_name</span><span class="p">:</span> <span class="nb">str</span>
    <span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Función auxiliar para registrar cambios detectados.&quot;&quot;&quot;</span>
        <span class="n">changes</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
            <span class="n">AuditoriaEntry</span><span class="p">(</span>
                <span class="n">id_entrada</span><span class="o">=</span><span class="n">id_model</span><span class="p">,</span>
                <span class="n">subesquema</span><span class="o">=</span><span class="n">subesquema_name</span><span class="p">,</span>
                <span class="n">campo</span><span class="o">=</span><span class="n">field_name</span><span class="p">,</span>
                <span class="n">new_value</span><span class="o">=</span><span class="n">new_value</span><span class="p">,</span>
                <span class="n">old_value</span><span class="o">=</span><span class="n">old_value</span><span class="p">,</span>
                <span class="n">regla</span><span class="o">=</span><span class="n">regla_name</span><span class="p">,</span>
            <span class="p">)</span>
        <span class="p">)</span>

    <span class="k">if</span> <span class="n">current_data</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="c1"># No hay datos actuales, se registran todos los campos como cambios</span>
        <span class="k">for</span> <span class="n">field_name</span> <span class="ow">in</span> <span class="n">updated_data</span><span class="o">.</span><span class="n">model_fields_set</span><span class="p">:</span>
            <span class="n">new_value</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">updated_data</span><span class="p">,</span> <span class="n">field_name</span><span class="p">)</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">new_value</span><span class="p">,</span> <span class="n">BaseModel</span><span class="p">)</span> <span class="ow">and</span> <span class="ow">not</span> <span class="p">(</span>
                <span class="nb">isinstance</span><span class="p">(</span><span class="n">new_value</span><span class="p">,</span> <span class="n">IDModel</span><span class="p">)</span>
            <span class="p">):</span>
                <span class="c1"># Es un modelo Pydantic anidado (subesquema)</span>
                <span class="k">for</span> <span class="n">sub_field_name</span> <span class="ow">in</span> <span class="n">new_value</span><span class="o">.</span><span class="n">model_fields_set</span><span class="p">:</span>
                    <span class="n">sub_field_value</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">new_value</span><span class="p">,</span> <span class="n">sub_field_name</span><span class="p">)</span>
                    <span class="n">_log_changes</span><span class="p">(</span><span class="n">field_name</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="n">sub_field_value</span><span class="p">,</span> <span class="n">sub_field_name</span><span class="p">)</span>

            <span class="k">else</span><span class="p">:</span>
                <span class="c1"># Si es principal es &quot;root&quot;</span>
                <span class="n">_log_changes</span><span class="p">(</span><span class="s2">&quot;root&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="n">new_value</span><span class="p">,</span> <span class="n">field_name</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">field_name</span> <span class="ow">in</span> <span class="n">updated_data</span><span class="o">.</span><span class="n">model_fields_set</span><span class="p">:</span>
            <span class="n">old_value</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">current_data</span><span class="p">,</span> <span class="n">field_name</span><span class="p">)</span>
            <span class="n">new_value</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">updated_data</span><span class="p">,</span> <span class="n">field_name</span><span class="p">)</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">new_value</span><span class="p">,</span> <span class="n">BaseModel</span><span class="p">):</span>
                <span class="c1"># Es un modelo Pydantic anidado (subesquema)</span>
                <span class="k">for</span> <span class="n">sub_field_name</span> <span class="ow">in</span> <span class="n">new_value</span><span class="o">.</span><span class="n">model_fields_set</span><span class="p">:</span>
                    <span class="n">sub_old_value</span> <span class="o">=</span> <span class="p">(</span>
                        <span class="nb">getattr</span><span class="p">(</span><span class="n">old_value</span><span class="p">,</span> <span class="n">sub_field_name</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
                        <span class="k">if</span> <span class="n">old_value</span>
                        <span class="k">else</span> <span class="kc">None</span>
                    <span class="p">)</span>
                    <span class="n">sub_new_value</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">new_value</span><span class="p">,</span> <span class="n">sub_field_name</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
                    <span class="k">if</span> <span class="n">sub_old_value</span> <span class="o">!=</span> <span class="n">sub_new_value</span><span class="p">:</span>
                        <span class="n">_log_changes</span><span class="p">(</span>
                            <span class="n">field_name</span><span class="p">,</span> <span class="n">sub_old_value</span><span class="p">,</span> <span class="n">sub_new_value</span><span class="p">,</span> <span class="n">sub_field_name</span>
                        <span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">old_value</span> <span class="o">!=</span> <span class="n">new_value</span><span class="p">:</span>
                    <span class="n">_log_changes</span><span class="p">(</span><span class="s2">&quot;root&quot;</span><span class="p">,</span> <span class="n">old_value</span><span class="p">,</span> <span class="n">new_value</span><span class="p">,</span> <span class="n">field_name</span><span class="p">)</span>

    <span class="k">if</span> <span class="ow">not</span> <span class="n">changes</span><span class="p">:</span>
        <span class="n">changes</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
            <span class="n">AuditoriaEntry</span><span class="p">(</span>
                <span class="n">id_entrada</span><span class="o">=</span><span class="n">id_model</span><span class="p">,</span>
                <span class="n">subesquema</span><span class="o">=</span><span class="s2">&quot;No Changes&quot;</span><span class="p">,</span>
                <span class="n">campo</span><span class="o">=</span><span class="s2">&quot;Ninguno&quot;</span><span class="p">,</span>
                <span class="n">new_value</span><span class="o">=</span><span class="s2">&quot;No cambios&quot;</span><span class="p">,</span>
                <span class="n">old_value</span><span class="o">=</span><span class="s2">&quot;No cambios&quot;</span><span class="p">,</span>
                <span class="n">regla</span><span class="o">=</span><span class="n">regla_name</span><span class="p">,</span>
            <span class="p">)</span>
        <span class="p">)</span>

    <span class="k">return</span> <span class="n">changes</span>
</code></pre></div>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-method">



<h5 id="centraal_client_flow.rules.update.RuleProcessor.get_current_entrada" class="doc doc-heading">
<code class="highlight language-python"><span class="n">get_current_entrada</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">id_entrada</span><span class="p">,</span> <span class="n">model_unificado</span><span class="p">)</span></code>


<a href="#centraal_client_flow.rules.update.RuleProcessor.get_current_entrada" class="headerlink" title="Permanent link">&para;</a></h5>

    <div class="doc doc-contents ">

      <p>Recupera el registro actual desde Cosmos DB basado en el ID proporcionado.</p>

<p><strong>Parameters:</strong></p>
<table>
  <thead>
    <tr>
      <th>Name</th>
      <th>Type</th>
      <th>Description</th>
      <th>Default</th>
    </tr>
  </thead>
  <tbody>
      <tr>
        <td><code>id_entrada</code></td>
        <td><code>IDModel</code></td>
        <td><p>El ID del registro que se desea recuperar.</p></td>
        <td><em>required</em></td>
      </tr>
  </tbody>
</table>
<p><strong>Returns:</strong></p>
<table>
  <thead>
    <tr>
      <th>Type</th>
      <th>Description</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td><code>Optional[EntradaEsquemaUnificado]</code></td>
      <td><p>El registro actual, si existe.</p></td>
    </tr>
  </tbody>
</table>
        <details class="quote">
          <summary>Source code in <code>centraal_client_flow/rules/update.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="nf">get_current_entrada</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span> <span class="n">id_entrada</span><span class="p">:</span> <span class="n">IDModel</span><span class="p">,</span> <span class="n">model_unificado</span><span class="p">:</span> <span class="n">EntradaEsquemaUnificado</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Optional</span><span class="p">[</span><span class="n">EntradaEsquemaUnificado</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Recupera el registro actual desde Cosmos DB basado en el ID proporcionado.</span>

<span class="sd">    Parameters:</span>
<span class="sd">        id_entrada: El ID del registro que se desea recuperar.</span>

<span class="sd">    Returns:</span>
<span class="sd">        Optional[EntradaEsquemaUnificado]: El registro actual, si existe.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">container</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cosmos_client</span><span class="o">.</span><span class="n">get_container_client</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">unified_container_name</span><span class="p">)</span>
    <span class="n">query</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;SELECT * FROM c WHERE c.id = &#39;</span><span class="si">{</span><span class="n">id_entrada</span><span class="o">.</span><span class="n">model_dump</span><span class="p">()</span><span class="si">}</span><span class="s2">&#39;&quot;</span>
    <span class="n">current_items</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span>
        <span class="n">container</span><span class="o">.</span><span class="n">query_items</span><span class="p">(</span><span class="n">query</span><span class="p">,</span> <span class="n">enable_cross_partition_query</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="p">)</span>

    <span class="k">if</span> <span class="n">current_items</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">model_unificado</span><span class="o">.</span><span class="n">model_validate</span><span class="p">(</span><span class="n">current_items</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
    <span class="k">return</span> <span class="kc">None</span>
</code></pre></div>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-method">



<h5 id="centraal_client_flow.rules.update.RuleProcessor.publish_to_topics" class="doc doc-heading">
<code class="highlight language-python"><span class="n">publish_to_topics</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">processed_data</span><span class="p">,</span> <span class="n">topic_names</span><span class="p">)</span></code>


<a href="#centraal_client_flow.rules.update.RuleProcessor.publish_to_topics" class="headerlink" title="Permanent link">&para;</a></h5>

    <div class="doc doc-contents ">

      <p>Publica los datos procesados a los tópicos de Service Bus relevantes.</p>

<p><strong>Parameters:</strong></p>
<table>
  <thead>
    <tr>
      <th>Name</th>
      <th>Type</th>
      <th>Description</th>
      <th>Default</th>
    </tr>
  </thead>
  <tbody>
      <tr>
        <td><code>processed_data</code></td>
        <td><code>EntradaEsquemaUnificado</code></td>
        <td><p>Los datos procesados que se enviarán.</p></td>
        <td><em>required</em></td>
      </tr>
      <tr>
        <td><code>topic_names</code></td>
        <td><code>List[str]</code></td>
        <td><p>Lista de tópicos a los que se enviarán los datos.</p></td>
        <td><em>required</em></td>
      </tr>
  </tbody>
</table>
        <details class="quote">
          <summary>Source code in <code>centraal_client_flow/rules/update.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="nf">publish_to_topics</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="n">processed_data</span><span class="p">:</span> <span class="n">EntradaEsquemaUnificado</span><span class="p">,</span>
    <span class="n">topic_names</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">],</span>
<span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Publica los datos procesados a los tópicos de Service Bus relevantes.</span>

<span class="sd">    Parameters:</span>
<span class="sd">        processed_data: Los datos procesados que se enviarán.</span>
<span class="sd">        topic_names: Lista de tópicos a los que se enviarán los datos.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">client</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">service_bus_client</span><span class="o">.</span><span class="n">client</span>
    <span class="k">for</span> <span class="n">topic_name</span> <span class="ow">in</span> <span class="n">topic_names</span><span class="p">:</span>
        <span class="n">body</span> <span class="o">=</span> <span class="n">processed_data</span><span class="o">.</span><span class="n">model_dump</span><span class="p">(</span><span class="n">mode</span><span class="o">=</span><span class="s2">&quot;json&quot;</span><span class="p">,</span> <span class="n">exclude_none</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="k">with</span> <span class="n">client</span><span class="o">.</span><span class="n">get_topic_sender</span><span class="p">(</span><span class="n">topic_name</span><span class="o">=</span><span class="n">topic_name</span><span class="p">)</span> <span class="k">as</span> <span class="n">sender</span><span class="p">:</span>
            <span class="n">message</span> <span class="o">=</span> <span class="n">SBMessage</span><span class="p">(</span><span class="n">body</span><span class="o">=</span><span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">body</span><span class="p">))</span>
            <span class="n">sender</span><span class="o">.</span><span class="n">send_messages</span><span class="p">(</span><span class="n">message</span><span class="p">)</span>
</code></pre></div>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-method">



<h5 id="centraal_client_flow.rules.update.RuleProcessor.record_auditoria" class="doc doc-heading">
<code class="highlight language-python"><span class="n">record_auditoria</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">changes</span><span class="p">)</span></code>


<a href="#centraal_client_flow.rules.update.RuleProcessor.record_auditoria" class="headerlink" title="Permanent link">&para;</a></h5>

    <div class="doc doc-contents ">

      <p>Registra los cambios detectados en el contenedor de auditoría de Cosmos DB.</p>

<p><strong>Parameters:</strong></p>
<table>
  <thead>
    <tr>
      <th>Name</th>
      <th>Type</th>
      <th>Description</th>
      <th>Default</th>
    </tr>
  </thead>
  <tbody>
      <tr>
        <td><code>changes</code></td>
        <td><code>List[centraal_client_flow.models.schemas.AuditoriaEntry]</code></td>
        <td><p>Lista de entradas de auditoría que contienen los cambios detectados.</p></td>
        <td><em>required</em></td>
      </tr>
  </tbody>
</table>
        <details class="quote">
          <summary>Source code in <code>centraal_client_flow/rules/update.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="nf">record_auditoria</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">changes</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">AuditoriaEntry</span><span class="p">]):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Registra los cambios detectados en el contenedor de auditoría de Cosmos DB.</span>

<span class="sd">    Parameters:</span>
<span class="sd">        changes: Lista de entradas de auditoría que contienen los cambios detectados.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">container</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cosmos_client</span><span class="o">.</span><span class="n">get_container_client</span><span class="p">(</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">auditoria_container_name</span>
    <span class="p">)</span>
    <span class="k">for</span> <span class="n">change</span> <span class="ow">in</span> <span class="n">changes</span><span class="p">:</span>
        <span class="n">container</span><span class="o">.</span><span class="n">create_item</span><span class="p">(</span>
            <span class="n">change</span><span class="o">.</span><span class="n">model_dump</span><span class="p">(</span><span class="n">mode</span><span class="o">=</span><span class="s2">&quot;json&quot;</span><span class="p">,</span> <span class="n">exclude_none</span><span class="o">=</span><span class="kc">True</span><span class="p">),</span>
            <span class="n">enable_automatic_id_generation</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="p">)</span>
</code></pre></div>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-method">



<h5 id="centraal_client_flow.rules.update.RuleProcessor.save_unified_model" class="doc doc-heading">
<code class="highlight language-python"><span class="n">save_unified_model</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">new_data</span><span class="p">)</span></code>


<a href="#centraal_client_flow.rules.update.RuleProcessor.save_unified_model" class="headerlink" title="Permanent link">&para;</a></h5>

    <div class="doc doc-contents ">

      <p>Guarda el modelo de EntradaEsquemaUnificado actualizado en Cosmos DB.</p>

<p><strong>Parameters:</strong></p>
<table>
  <thead>
    <tr>
      <th>Name</th>
      <th>Type</th>
      <th>Description</th>
      <th>Default</th>
    </tr>
  </thead>
  <tbody>
      <tr>
        <td><code>new_data</code></td>
        <td><code>EntradaEsquemaUnificado</code></td>
        <td><p>El modelo actualizado de EntradaEsquemaUnificado.</p></td>
        <td><em>required</em></td>
      </tr>
  </tbody>
</table>
<p><strong>Returns:</strong></p>
<table>
  <thead>
    <tr>
      <th>Type</th>
      <th>Description</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td><code>EntradaEsquemaUnificado</code></td>
      <td><p>El modelo almacenado en la base de datos.</p></td>
    </tr>
  </tbody>
</table>
        <details class="quote">
          <summary>Source code in <code>centraal_client_flow/rules/update.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="nf">save_unified_model</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="n">new_data</span><span class="p">:</span> <span class="n">EntradaEsquemaUnificado</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Guarda el modelo de EntradaEsquemaUnificado actualizado en Cosmos DB.</span>

<span class="sd">    Parameters:</span>
<span class="sd">        new_data: El modelo actualizado de EntradaEsquemaUnificado.</span>

<span class="sd">    Returns:</span>
<span class="sd">        EntradaEsquemaUnificado: El modelo almacenado en la base de datos.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">container</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cosmos_client</span><span class="o">.</span><span class="n">get_container_client</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">unified_container_name</span><span class="p">)</span>
    <span class="n">item_written</span> <span class="o">=</span> <span class="n">container</span><span class="o">.</span><span class="n">upsert_item</span><span class="p">(</span>
        <span class="n">new_data</span><span class="o">.</span><span class="n">model_dump</span><span class="p">(</span><span class="n">mode</span><span class="o">=</span><span class="s2">&quot;json&quot;</span><span class="p">,</span> <span class="n">exclude_none</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="p">)</span>
    <span class="k">return</span> <span class="n">item_written</span>
</code></pre></div>
        </details>
    </div>

  </div>





  </div>

    </div>

  </div>



  <div class="doc doc-object doc-class">



<h4 id="centraal_client_flow.rules.update.RuleSelector" class="doc doc-heading">
        <code>
RuleSelector        </code>



<a href="#centraal_client_flow.rules.update.RuleSelector" class="headerlink" title="Permanent link">&para;</a></h4>

    <div class="doc doc-contents ">

      <p>Clase encargada de seleccionar y aplicar reglas de procesamiento sobre los eventos.</p>

        <details class="quote">
          <summary>Source code in <code>centraal_client_flow/rules/update.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">class</span> <span class="nc">RuleSelector</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Clase encargada de seleccionar y aplicar reglas de procesamiento sobre los eventos.&quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">modelo_unificado</span><span class="p">:</span> <span class="n">EntradaEsquemaUnificado</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">rules</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">Rule</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">modelo_unificado</span> <span class="o">=</span> <span class="n">modelo_unificado</span>

    <span class="k">def</span> <span class="nf">register_rule</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">rule</span><span class="p">:</span> <span class="n">Rule</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Registra una nueva regla para su uso futuro en el procesamiento de eventos.</span>

<span class="sd">        Parameters:</span>
<span class="sd">            rule: La regla que se va a registrar.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_validate_rule</span><span class="p">(</span><span class="n">rule</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">rules</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">rule</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">_validate_rule</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">rule</span><span class="p">:</span> <span class="n">Rule</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Valida que los tópicos de la regla coincidan con los subesquemas en el modelo unificado.</span>

<span class="sd">        Parameters:</span>
<span class="sd">            rule: La regla a validar.</span>

<span class="sd">        Raises:</span>
<span class="sd">            ValueError: Si algún tópico de la regla no corresponde a un subesquema válido.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">model_fields</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">modelo_unificado</span><span class="o">.</span><span class="n">model_fields</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="n">rule</span><span class="o">.</span><span class="n">topics</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">t</span> <span class="o">==</span> <span class="s2">&quot;root&quot;</span><span class="p">:</span>
                <span class="k">pass</span>
            <span class="k">elif</span> <span class="n">t</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">model_fields</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                    <span class="sa">f</span><span class="s2">&quot;El tópico </span><span class="si">{</span><span class="n">t</span><span class="si">}</span><span class="s2"> debe corresponder a un subesquema </span><span class="si">{</span><span class="n">model_fields</span><span class="si">}</span><span class="s2">&quot;</span>
                <span class="p">)</span>

    <span class="k">def</span> <span class="nf">select_rule</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data</span><span class="p">:</span> <span class="nb">dict</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Tuple</span><span class="p">[</span><span class="n">EventoBase</span><span class="p">,</span> <span class="n">Rule</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Selecciona la regla adecuada para los datos proporcionados.</span>

<span class="sd">        Parameters:</span>
<span class="sd">            data: Un diccionario con los datos a validar y procesar.</span>

<span class="sd">        Returns:</span>
<span class="sd">            Tuple[EventoBase, Rule]: Los datos validados y la regla seleccionada.</span>

<span class="sd">        Raises:</span>
<span class="sd">            NoHayReglas: Si no se encuentra una regla válida para los datos proporcionados.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">for</span> <span class="n">rule</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">rules</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">validated_data</span> <span class="o">=</span> <span class="n">rule</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">model_validate</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
                <span class="k">return</span> <span class="n">validated_data</span><span class="p">,</span> <span class="n">rule</span>
            <span class="k">except</span> <span class="n">ValidationError</span><span class="p">:</span>
                <span class="k">continue</span>
        <span class="k">raise</span> <span class="n">NoHayReglas</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;No se encontró una regla válida para </span><span class="si">{</span><span class="n">data</span><span class="si">}</span><span class="s2">.&quot;</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">get_topics_by_changes</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">rule_topics</span><span class="p">:</span> <span class="n">Set</span><span class="p">[</span><span class="nb">str</span><span class="p">],</span>
        <span class="n">changes</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">AuditoriaEntry</span><span class="p">],</span>
        <span class="n">include_root</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Selecciona los tópicos relevantes basados en los cambios detectados.</span>

<span class="sd">        Parameters:</span>
<span class="sd">            rule_topics: Conjunto de tópicos definidos en la regla.</span>
<span class="sd">            changes: Lista de entradas de auditoría con los cambios detectados.</span>

<span class="sd">        Returns:</span>
<span class="sd">            List[str]: Lista de tópicos que necesitan ser notificados.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">topics_to_notify</span> <span class="o">=</span> <span class="nb">set</span><span class="p">()</span>

        <span class="k">for</span> <span class="n">change</span> <span class="ow">in</span> <span class="n">changes</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">change</span><span class="o">.</span><span class="n">subesquema</span> <span class="ow">in</span> <span class="n">rule_topics</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">include_root</span><span class="p">:</span>
                    <span class="n">topics_to_notify</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">change</span><span class="o">.</span><span class="n">subesquema</span><span class="p">)</span>
                <span class="k">elif</span> <span class="n">change</span><span class="o">.</span><span class="n">subesquema</span> <span class="o">!=</span> <span class="s2">&quot;root&quot;</span><span class="p">:</span>
                    <span class="n">topics_to_notify</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">change</span><span class="o">.</span><span class="n">subesquema</span><span class="p">)</span>

        <span class="k">return</span> <span class="nb">list</span><span class="p">(</span><span class="n">topics_to_notify</span><span class="p">)</span>
</code></pre></div>
        </details>



  <div class="doc doc-children">










  <div class="doc doc-object doc-method">



<h5 id="centraal_client_flow.rules.update.RuleSelector.get_topics_by_changes" class="doc doc-heading">
<code class="highlight language-python"><span class="n">get_topics_by_changes</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">rule_topics</span><span class="p">,</span> <span class="n">changes</span><span class="p">,</span> <span class="n">include_root</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span></code>


<a href="#centraal_client_flow.rules.update.RuleSelector.get_topics_by_changes" class="headerlink" title="Permanent link">&para;</a></h5>

    <div class="doc doc-contents ">

      <p>Selecciona los tópicos relevantes basados en los cambios detectados.</p>

<p><strong>Parameters:</strong></p>
<table>
  <thead>
    <tr>
      <th>Name</th>
      <th>Type</th>
      <th>Description</th>
      <th>Default</th>
    </tr>
  </thead>
  <tbody>
      <tr>
        <td><code>rule_topics</code></td>
        <td><code>Set[str]</code></td>
        <td><p>Conjunto de tópicos definidos en la regla.</p></td>
        <td><em>required</em></td>
      </tr>
      <tr>
        <td><code>changes</code></td>
        <td><code>List[centraal_client_flow.models.schemas.AuditoriaEntry]</code></td>
        <td><p>Lista de entradas de auditoría con los cambios detectados.</p></td>
        <td><em>required</em></td>
      </tr>
  </tbody>
</table>
<p><strong>Returns:</strong></p>
<table>
  <thead>
    <tr>
      <th>Type</th>
      <th>Description</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td><code>List[str]</code></td>
      <td><p>Lista de tópicos que necesitan ser notificados.</p></td>
    </tr>
  </tbody>
</table>
        <details class="quote">
          <summary>Source code in <code>centraal_client_flow/rules/update.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="nf">get_topics_by_changes</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="n">rule_topics</span><span class="p">:</span> <span class="n">Set</span><span class="p">[</span><span class="nb">str</span><span class="p">],</span>
    <span class="n">changes</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="n">AuditoriaEntry</span><span class="p">],</span>
    <span class="n">include_root</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Selecciona los tópicos relevantes basados en los cambios detectados.</span>

<span class="sd">    Parameters:</span>
<span class="sd">        rule_topics: Conjunto de tópicos definidos en la regla.</span>
<span class="sd">        changes: Lista de entradas de auditoría con los cambios detectados.</span>

<span class="sd">    Returns:</span>
<span class="sd">        List[str]: Lista de tópicos que necesitan ser notificados.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">topics_to_notify</span> <span class="o">=</span> <span class="nb">set</span><span class="p">()</span>

    <span class="k">for</span> <span class="n">change</span> <span class="ow">in</span> <span class="n">changes</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">change</span><span class="o">.</span><span class="n">subesquema</span> <span class="ow">in</span> <span class="n">rule_topics</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">include_root</span><span class="p">:</span>
                <span class="n">topics_to_notify</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">change</span><span class="o">.</span><span class="n">subesquema</span><span class="p">)</span>
            <span class="k">elif</span> <span class="n">change</span><span class="o">.</span><span class="n">subesquema</span> <span class="o">!=</span> <span class="s2">&quot;root&quot;</span><span class="p">:</span>
                <span class="n">topics_to_notify</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">change</span><span class="o">.</span><span class="n">subesquema</span><span class="p">)</span>

    <span class="k">return</span> <span class="nb">list</span><span class="p">(</span><span class="n">topics_to_notify</span><span class="p">)</span>
</code></pre></div>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-method">



<h5 id="centraal_client_flow.rules.update.RuleSelector.register_rule" class="doc doc-heading">
<code class="highlight language-python"><span class="n">register_rule</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">rule</span><span class="p">)</span></code>


<a href="#centraal_client_flow.rules.update.RuleSelector.register_rule" class="headerlink" title="Permanent link">&para;</a></h5>

    <div class="doc doc-contents ">

      <p>Registra una nueva regla para su uso futuro en el procesamiento de eventos.</p>

<p><strong>Parameters:</strong></p>
<table>
  <thead>
    <tr>
      <th>Name</th>
      <th>Type</th>
      <th>Description</th>
      <th>Default</th>
    </tr>
  </thead>
  <tbody>
      <tr>
        <td><code>rule</code></td>
        <td><code>Rule</code></td>
        <td><p>La regla que se va a registrar.</p></td>
        <td><em>required</em></td>
      </tr>
  </tbody>
</table>
        <details class="quote">
          <summary>Source code in <code>centraal_client_flow/rules/update.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="nf">register_rule</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">rule</span><span class="p">:</span> <span class="n">Rule</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Registra una nueva regla para su uso futuro en el procesamiento de eventos.</span>

<span class="sd">    Parameters:</span>
<span class="sd">        rule: La regla que se va a registrar.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_validate_rule</span><span class="p">(</span><span class="n">rule</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">rules</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">rule</span><span class="p">)</span>
</code></pre></div>
        </details>
    </div>

  </div>



  <div class="doc doc-object doc-method">



<h5 id="centraal_client_flow.rules.update.RuleSelector.select_rule" class="doc doc-heading">
<code class="highlight language-python"><span class="n">select_rule</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data</span><span class="p">)</span></code>


<a href="#centraal_client_flow.rules.update.RuleSelector.select_rule" class="headerlink" title="Permanent link">&para;</a></h5>

    <div class="doc doc-contents ">

      <p>Selecciona la regla adecuada para los datos proporcionados.</p>

<p><strong>Parameters:</strong></p>
<table>
  <thead>
    <tr>
      <th>Name</th>
      <th>Type</th>
      <th>Description</th>
      <th>Default</th>
    </tr>
  </thead>
  <tbody>
      <tr>
        <td><code>data</code></td>
        <td><code>dict</code></td>
        <td><p>Un diccionario con los datos a validar y procesar.</p></td>
        <td><em>required</em></td>
      </tr>
  </tbody>
</table>
<p><strong>Returns:</strong></p>
<table>
  <thead>
    <tr>
      <th>Type</th>
      <th>Description</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td><code>Tuple[EventoBase, Rule]</code></td>
      <td><p>Los datos validados y la regla seleccionada.</p></td>
    </tr>
  </tbody>
</table>
<p><strong>Exceptions:</strong></p>
<table>
  <thead>
    <tr>
      <th>Type</th>
      <th>Description</th>
    </tr>
  </thead>
  <tbody>
      <tr>
        <td><code>NoHayReglas</code></td>
        <td><p>Si no se encuentra una regla válida para los datos proporcionados.</p></td>
      </tr>
  </tbody>
</table>
        <details class="quote">
          <summary>Source code in <code>centraal_client_flow/rules/update.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">def</span> <span class="nf">select_rule</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">data</span><span class="p">:</span> <span class="nb">dict</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Tuple</span><span class="p">[</span><span class="n">EventoBase</span><span class="p">,</span> <span class="n">Rule</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Selecciona la regla adecuada para los datos proporcionados.</span>

<span class="sd">    Parameters:</span>
<span class="sd">        data: Un diccionario con los datos a validar y procesar.</span>

<span class="sd">    Returns:</span>
<span class="sd">        Tuple[EventoBase, Rule]: Los datos validados y la regla seleccionada.</span>

<span class="sd">    Raises:</span>
<span class="sd">        NoHayReglas: Si no se encuentra una regla válida para los datos proporcionados.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">for</span> <span class="n">rule</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">rules</span><span class="p">:</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">validated_data</span> <span class="o">=</span> <span class="n">rule</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">model_validate</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">validated_data</span><span class="p">,</span> <span class="n">rule</span>
        <span class="k">except</span> <span class="n">ValidationError</span><span class="p">:</span>
            <span class="k">continue</span>
    <span class="k">raise</span> <span class="n">NoHayReglas</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;No se encontró una regla válida para </span><span class="si">{</span><span class="n">data</span><span class="si">}</span><span class="s2">.&quot;</span><span class="p">)</span>
</code></pre></div>
        </details>
    </div>

  </div>





  </div>

    </div>

  </div>



  <div class="doc doc-object doc-class">



<h4 id="centraal_client_flow.rules.update.UpdateProcessor" class="doc doc-heading">
        <code>
UpdateProcessor            (<a title="centraal_client_flow.helpers.logger.LoggerMixin" href="#centraal_client_flow.helpers.logger.LoggerMixin">LoggerMixin</a>, <span title="abc.ABC">ABC</span>)
        </code>



<a href="#centraal_client_flow.rules.update.UpdateProcessor" class="headerlink" title="Permanent link">&para;</a></h4>

    <div class="doc doc-contents ">

      <p>Clase base abstracta para procesadores de eventos.</p>

        <details class="quote">
          <summary>Source code in <code>centraal_client_flow/rules/update.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="k">class</span> <span class="nc">UpdateProcessor</span><span class="p">(</span><span class="n">LoggerMixin</span><span class="p">,</span> <span class="n">ABC</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Clase base abstracta para procesadores de eventos.&quot;&quot;&quot;</span>

    <span class="nd">@abstractmethod</span>
    <span class="k">def</span> <span class="nf">process_message</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">event</span><span class="p">:</span> <span class="n">EventoBase</span><span class="p">,</span> <span class="n">current_registro</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">EntradaEsquemaUnificado</span><span class="p">]</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">EntradaEsquemaUnificado</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Procesa el evento recibido y retorna un modelo actualizado de EntradaEsquemaUnificado.</span>

<span class="sd">        Parameters:</span>
<span class="sd">            event: El evento que contiene la información del cambio, basado en un modelo Pydantic.</span>
<span class="sd">            current_registro: El registro actual que será actualizado.</span>

<span class="sd">        Returns:</span>
<span class="sd">            EntradaEsquemaUnificado: El registro actualizado después de aplicar el evento.</span>
<span class="sd">        &quot;&quot;&quot;</span>
</code></pre></div>
        </details>



  <div class="doc doc-children">









  <div class="doc doc-object doc-method">



<h5 id="centraal_client_flow.rules.update.UpdateProcessor.process_message" class="doc doc-heading">
<code class="highlight language-python"><span class="n">process_message</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">event</span><span class="p">,</span> <span class="n">current_registro</span><span class="p">)</span></code>


<a href="#centraal_client_flow.rules.update.UpdateProcessor.process_message" class="headerlink" title="Permanent link">&para;</a></h5>

    <div class="doc doc-contents ">

      <p>Procesa el evento recibido y retorna un modelo actualizado de EntradaEsquemaUnificado.</p>

<p><strong>Parameters:</strong></p>
<table>
  <thead>
    <tr>
      <th>Name</th>
      <th>Type</th>
      <th>Description</th>
      <th>Default</th>
    </tr>
  </thead>
  <tbody>
      <tr>
        <td><code>event</code></td>
        <td><code>EventoBase</code></td>
        <td><p>El evento que contiene la información del cambio, basado en un modelo Pydantic.</p></td>
        <td><em>required</em></td>
      </tr>
      <tr>
        <td><code>current_registro</code></td>
        <td><code>Optional[centraal_client_flow.models.schemas.EntradaEsquemaUnificado]</code></td>
        <td><p>El registro actual que será actualizado.</p></td>
        <td><em>required</em></td>
      </tr>
  </tbody>
</table>
<p><strong>Returns:</strong></p>
<table>
  <thead>
    <tr>
      <th>Type</th>
      <th>Description</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td><code>EntradaEsquemaUnificado</code></td>
      <td><p>El registro actualizado después de aplicar el evento.</p></td>
    </tr>
  </tbody>
</table>
        <details class="quote">
          <summary>Source code in <code>centraal_client_flow/rules/update.py</code></summary>
          <div class="highlight"><pre><span></span><code><span class="nd">@abstractmethod</span>
<span class="k">def</span> <span class="nf">process_message</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span> <span class="n">event</span><span class="p">:</span> <span class="n">EventoBase</span><span class="p">,</span> <span class="n">current_registro</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">EntradaEsquemaUnificado</span><span class="p">]</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">EntradaEsquemaUnificado</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Procesa el evento recibido y retorna un modelo actualizado de EntradaEsquemaUnificado.</span>

<span class="sd">    Parameters:</span>
<span class="sd">        event: El evento que contiene la información del cambio, basado en un modelo Pydantic.</span>
<span class="sd">        current_registro: El registro actual que será actualizado.</span>

<span class="sd">    Returns:</span>
<span class="sd">        EntradaEsquemaUnificado: El registro actualizado después de aplicar el evento.</span>
<span class="sd">    &quot;&quot;&quot;</span>
</code></pre></div>
        </details>
    </div>

  </div>





  </div>

    </div>

  </div>







  </div>

    </div>

  </div>




  </div>

    </div>

  </div>




  </div>

    </div>

  </div>





                
              </article>
            </div>
          
          
        </div>
        
      </main>
      
        <footer class="md-footer">
  
    
    <nav class="md-footer__inner md-grid" aria-label="Footer" >
      
        
        <a href="../usage/" class="md-footer__link md-footer__link--prev" aria-label="Previous: usage" rel="prev">
          <div class="md-footer__button md-icon">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"/></svg>
          </div>
          <div class="md-footer__title">
            <div class="md-ellipsis">
              <span class="md-footer__direction">
                Previous
              </span>
              usage
            </div>
          </div>
        </a>
      
      
        
        <a href="../contributing/" class="md-footer__link md-footer__link--next" aria-label="Next: contributing" rel="next">
          <div class="md-footer__title">
            <div class="md-ellipsis">
              <span class="md-footer__direction">
                Next
              </span>
              contributing
            </div>
          </div>
          <div class="md-footer__button md-icon">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M4 11v2h12l-5.5 5.5 1.42 1.42L19.84 12l-7.92-7.92L10.5 5.5 16 11H4Z"/></svg>
          </div>
        </a>
      
    </nav>
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
        <div class="md-social">
  
    
    
    <a href="http://www.jieyu.ai" target="_blank" rel="noopener" title="Tweet" class="md-social__link">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><!--! Font Awesome Free 6.2.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc.--><path d="M459.37 151.716c.325 4.548.325 9.097.325 13.645 0 138.72-105.583 298.558-298.558 298.558-59.452 0-114.68-17.219-161.137-47.106 8.447.974 16.568 1.299 25.34 1.299 49.055 0 94.213-16.568 130.274-44.832-46.132-.975-84.792-31.188-98.112-72.772 6.498.974 12.995 1.624 19.818 1.624 9.421 0 18.843-1.3 27.614-3.573-48.081-9.747-84.143-51.98-84.143-102.985v-1.299c13.969 7.797 30.214 12.67 47.431 13.319-28.264-18.843-46.781-51.005-46.781-87.391 0-19.492 5.197-37.36 14.294-52.954 51.655 63.675 129.3 105.258 216.365 109.807-1.624-7.797-2.599-15.918-2.599-24.04 0-57.828 46.782-104.934 104.934-104.934 30.213 0 57.502 12.67 76.67 33.137 23.715-4.548 46.456-13.32 66.599-25.34-7.798 24.366-24.366 44.833-46.132 57.827 21.117-2.273 41.584-8.122 60.426-16.243-14.292 20.791-32.161 39.308-52.628 54.253z"/></svg>
    </a>
  
    
    
    <a href="http://www.jieyu.ai" target="_blank" rel="noopener" title="Facebook" class="md-social__link">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><!--! Font Awesome Free 6.2.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc.--><path d="M504 256C504 119 393 8 256 8S8 119 8 256c0 123.78 90.69 226.38 209.25 245V327.69h-63V256h63v-54.64c0-62.15 37-96.48 93.67-96.48 27.14 0 55.52 4.84 55.52 4.84v61h-31.28c-30.8 0-40.41 19.12-40.41 38.73V256h68.78l-11 71.69h-57.78V501C413.31 482.38 504 379.78 504 256z"/></svg>
    </a>
  
    
    
    <a href="https://github.com/centraal-api/centraal_client_flow" target="_blank" rel="noopener" title="Github" class="md-social__link">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 496 512"><!--! Font Awesome Free 6.2.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2022 Fonticons, Inc.--><path d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6zm-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3zm44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9zM244.8 8C106.1 8 0 113.3 0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8zM97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1zm-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7zm32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1zm-11.4-14.7c-1.6 1-1.6 3.6 0 5.9 1.6 2.3 4.3 3.3 5.6 2.3 1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2z"/></svg>
    </a>
  
    
    
    <a href="mailto:equipo@centraal.studio" target="_blank" rel="noopener" title="" class="md-social__link">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="m20 8-8 5-8-5V6l8 5 8-5m0-2H4c-1.11 0-2 .89-2 2v12a2 2 0 0 0 2 2h16a2 2 0 0 0 2-2V6a2 2 0 0 0-2-2Z"/></svg>
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    <script id="__config" type="application/json">{"base": "..", "features": ["navigation.indexes", "navigation.tabs", "navigation.instant", "navigation.tabs.sticky"], "search": "../assets/javascripts/workers/search.16e2a7d4.min.js", "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.config.lang": "en", "search.config.pipeline": "trimmer, stopWordFilter", "search.config.separator": "[\\s\\-]+", "search.placeholder": "Search", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version.title": "Select version"}, "version": {"provider": "mike"}}</script>
    
    
      <script src="../assets/javascripts/bundle.5a2dcb6a.min.js"></script>
      
    
    
  </body>
</html>